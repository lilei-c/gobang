var Tt=Object.defineProperty;var Vt=(i,t,s)=>t in i?Tt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s;var rt=(i,t,s)=>(Vt(i,typeof t!="symbol"?t+"":t,s),s);import{j as yt,r as mt,a as pt,c as Xt}from"./vendor-cd7d93c1.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function s(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerpolicy&&(o.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?o.credentials="include":e.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(e){if(e.ep)return;e.ep=!0;const o=s(e);fetch(e.href,o)}})();const w=yt.jsx,J=yt.jsxs,g=15,j=g/2>>0,X=(i,t=null)=>Array(i).fill(t),Bt=(i,t=20)=>{let s=+new Date;return(...n)=>{+new Date-s>t&&i(...n),s=+new Date}},zt=i=>t=>Array(t-i).fill(null).map((s,n)=>i+n),at=zt(0),Dt=2**0,At=2**3,bt=2**6,_t=bt*2,Ot=2**9,Ft=2**12,Ct=2**14,$t=2**16,Rt=2**18,Ut={l1:Dt,d2:At,l2:bt,d3:Ot,l3:Ft,d4:Ct,l4:$t,l5:Rt,l2x2:_t},Q=i=>({l1:i&7,d2:(i&56)>>3,l2:(i&960)>>6,d3:(i&7680)>>9,l3:(i&12288)>>12,d4:(i&49152)>>14,l4:(i&196608)>>16,l5:(i&786432)>>18}),p={l1:10,d2:10,d3:200,l2:150,l2x2:300,l3:200,d4:2e3,l4:5e3,l5:1e4,win:1e5};console.warn("todo: 测试 countLine 是否正确");const Ht=(i,t,s)=>n=>{let e=1;for(let o=0;o<n.length;o++){const r=n[o];if(o<4)e<<=1,r===i?e+=1:(r===t||r===s)&&(e=1);else if(o===4)e<<=1,e+=1;else{if(r===t||r===s)break;e<<=1,r===i&&(e+=1)}}return e},Gt=i=>{let t=[],s=2**(i+1);for(;s-- >0;)t.push("0b"+s.toString(2));return t},B=Gt(11),Yt=i=>/010/.test(i)&&i.length>5,qt=i=>/10{0,1}1/.test(i)&&i.length>=5,Kt=i=>[/000110/,/001100/,/011000/,/001010/,/010100/].some(t=>t.test(i)),Zt=i=>/0101010/.test(i),jt=i=>[/111/,/1011/,/1101/,/11001/,/10011/,/10101/].some(t=>t.test(i))&&i.length>=5,Qt=i=>[/010110/,/011010/,/01110/,/1010101/].some(t=>t.test(i)),It=i=>[/11110/,/01111/,/11011/,/11101/,/10111/].some(t=>t.test(i)),Jt=i=>[/011110/,/1011101/,/11011011/,/111010111/].some(t=>t.test(i)),ts=i=>/1{5}/.test(i),O={};B.forEach(i=>O[i]=null);const R=[];B.forEach(i=>Yt(i.slice(3))&&(O[i]="l1")&&(R[+i]=Dt));B.forEach(i=>qt(i.slice(3))&&(O[i]="d2")&&(R[+i]=At));B.forEach(i=>Kt(i.slice(3))&&(O[i]="l2")&&(R[+i]=bt));B.forEach(i=>jt(i.slice(3))&&(O[i]="d3")&&(R[+i]=Ot));B.forEach(i=>Zt(i.slice(3))&&(O[i]="l2x2")&&(R[+i]=_t));B.forEach(i=>Qt(i.slice(3))&&(O[i]="l3")&&(R[+i]=Ft));B.forEach(i=>It(i.slice(3))&&(O[i]="d4")&&(R[+i]=Ct));B.forEach(i=>Jt(i.slice(3))&&(O[i]="l4")&&(R[+i]=$t));B.forEach(i=>ts(i.slice(3))&&(O[i]="l5")&&(R[+i]=Rt));console.log("未构成棋型的组合, 这一部分已经验证",Object.keys(O).filter(i=>!O[i]).map(i=>i.slice(3)));console.warn("todo: 验证以下棋型是否正确");Object.keys(p).forEach(i=>{console.log(i,Object.keys(O).filter(t=>O[t]===i).map(t=>t.slice(3)))});console.log({allModes:B,ninePointMode:R});class ss{constructor({size:t}){this.max=X(t).map(n=>X(t).map(()=>mt.int(0,1073741824))),this.min=X(t).map(n=>X(t).map(()=>mt.int(0,1073741824))),this.code=mt.int(0,1073741824),this.hash={}}go(t,s,n){this.code^=n?this.max[t][s]:this.min[t][s]}get(){return this.hash[this.code]}set(t){this.hash[this.code]=t}resetHash(){this.hash={}}}const z=0,x=1,W=2,dt=3,{l1:vt,d2:wt,l2:kt,l2x2:xt,d3:Lt,l3:St,d4:Nt,l4:Wt,l5:Et}=Ut;class ${constructor({firstHand:t}){this.totalChessPieces=g*g,this.node=X(g).map(s=>X(g,z)),this.initNode(),this.stack=[],this.zobrist=new ss({size:g}),this.maxPointsScore=X(g).map(s=>X(g,[0,0,0,0])),this.minPointsScore=X(g).map(s=>X(g,[0,0,0,0])),this.stats={},this.enableStats=!0,this.enableLog=!1,this.firstHand=t||W,this.genLimit=60,this.seekDepth=4,this.seekKillDepth=19}isWall(t,s){return t<0||t>=g||s<0||s>=g}initNode(){this.node0=X(g,0);const t=new ArrayBuffer(4*15);this.node1=new Int32Array(t);for(let s=0;s<=14;s++)this.node1[s]=0;this.node2=[];for(let s=0;s<g*2-1;s++){let n=0;for(let e=0;e<15;e++){const o=s-e;n<<=2,this.isWall(e,o)&&(n+=3)}this.node2[s]=n}this.node3=[];for(let s=0;s<g*2-1;s++){let n=0;for(let e=0;e<15;e++){const o=14+e-s;n<<=2,this.isWall(e,o)&&(n+=3)}this.node3[s]=n}}put(t,s,n){this.node[t][s]=n,this.zobrist.go(t,s,n===x),this.stack.push([t,s]),this.node0[t]=this.node0[t]|n<<2*(14-s),this.node1[s]=this.node1[s]|n<<2*(14-t),this.node2[t+s]=this.node2[t+s]|n<<2*(14-t),this.node3[14+t-s]=this.node3[14+t-s]|n<<2*(14-t),this.updateFourLineScore(t,s)}rollback(t=1){if(!(this.stack.length<t))for(;t-- >0;){const[s,n]=this.stack.pop();this.zobrist.go(s,n,this.getChess(s,n)===x),this.node[s][n]=z;const e=2*(14-n);this.node0[s]=(this.node0[s]|3<<e)^3<<e;const o=2*(14-s);this.node1[n]=(this.node1[n]|3<<o)^3<<o,this.node2[s+n]=(this.node2[s+n]|3<<o)^3<<o,this.node3[14+s-n]=(this.node3[14+s-n]|3<<o)^3<<o,this.updateFourLineScore(s,n)}}maxGo(){if(this.isFinal)return;this.zobrist.resetHash(),this.initStats();let t;this.stack.length>4&&(console.time("thinking kill"),t=this.minimax(this.seekKillDepth,!0),console.timeEnd("thinking kill")),(t==null?void 0:t.score)>=p.win?console.warn("算杀成功 :)"):(console.time("thinking"),t=this.minimax(this.seekDepth),console.timeEnd("thinking")),console.log({score:t});const{i:s,j:n}=t;return this.put(s,n,x),this.logStats(),console.log("score",this.evaluate(!1,!0)),t}minGo(t,s){if(!this.isFinal)return this.isEmptyPosition(t,s)?(this.put(t,s,W),console.log("score",this.evaluate()),!0):!1}minRepent(){this.stack.length>=2&&this.rollback(2)}isEmptyPosition(t,s){return!this.isWall(t,s)&&this.getChess(t,s)===z}getNearPositions(t){const s=[],[e,o]=t;for(let r=-2;r<=2;r++)for(let h=-2;h<=2;h++)this.isEmptyPosition(r+e,h+o)&&s.push([r+e,h+o]);return s}getAllOptimalNextStep(){if(this.stack.length===0)return[[j,j]];if(this.stack.length===1){if(this.isEmptyPosition(j,j))return[[j,j]];const s=j+(Math.random()>.5?1:-1),n=j+(Math.random()>.5?1:-1);return[[s,n]]}let t=[];for(let s=0;s<g;s++)for(let n=0;n<g;n++)this.getChess(s,n)===z&&this.haveNeighbor(s,n)&&t.push([s,n]);return t}haveNeighbor(t,s){for(let e=-2;e<=2;e++)if(!(e+t<0||e+t>=g))for(let o=-2;o<=2;o++){if(o+s<0||o+s>=g||e===0&&o===0)continue;if(this.getChess(e+t,s+o)!==z)return!0}return!1}getChess(t,s){return this.node0[t]>>2*(14-s)&3}minimax(t,s,n=-1/0,e=1/0,o=!0){if(this.isFinal||t===0)return{score:this.evaluate(s),depth:t};const r=this.orderPoints(this.getAllOptimalNextStep(),o?x:W,s);if(!(r!=null&&r.length))return{score:0};if(o){let h=-1/0,l=r[0];for(const a of r){const[k,v]=a;this.put(k,v,x),this.enableStats&&this.stats.abCut.eva++;let b=this.zobrist.get();if(b===void 0?(b=this.minimax(t-1,s,n,e,!o).score,this.zobrist.set(b),this.enableStats&&this.stats.zobrist.miss++):this.enableStats&&this.stats.zobrist.hit++,this.rollback(),b>h&&(h=b,l=a),n=Math.max(n,h),e<=n){this.enableStats&&this.stats.abCut.cut++;break}}const[u,m]=l;return{score:h,i:u,j:m}}else{let h=1/0,l=r[0];for(const a of r){const[k,v]=a;this.put(k,v,W),this.enableStats&&this.stats.abCut.eva++;let b=this.zobrist.get();if(b===void 0?(b=this.minimax(t-1,s,n,e,!o).score,this.zobrist.set(b),this.enableStats&&this.stats.zobrist.miss++):this.enableStats&&this.stats.zobrist.hit++,this.rollback(),b<h&&(h=b,l=a),e=Math.min(e,h),e<=n){this.enableStats&&this.stats.abCut.cut++;break}}const[u,m]=l;return{score:h,i:u,j:m}}}getChessInFourDirection(t,s,n){let e=[],o=[],r=[],h=[];if(n===void 0||n===0){const l=this.node0[t],u=s>=4?l>>2*(18-s)&3:3,m=s>=3?l>>2*(17-s)&3:3,a=s>=2?l>>2*(16-s)&3:3,k=s>=1?l>>2*(15-s)&3:3,v=l>>2*(14-s)&3,b=s<=13?l>>2*(13-s)&3:3,L=s<=12?l>>2*(12-s)&3:3,D=s<=11?l>>2*(11-s)&3:3,E=s<=10?l>>2*(10-s)&3:3;if(e=[u,m,a,k,v,b,L,D,E],n===0)return e}if(n===void 0||n===1){const l=this.node1[s],u=t>=4?l>>2*(18-t)&3:3,m=t>=3?l>>2*(17-t)&3:3,a=t>=2?l>>2*(16-t)&3:3,k=t>=1?l>>2*(15-t)&3:3,v=l>>2*(14-t)&3,b=t<=13?l>>2*(13-t)&3:3,L=t<=12?l>>2*(12-t)&3:3,D=t<=11?l>>2*(11-t)&3:3,E=t<=10?l>>2*(10-t)&3:3;if(o=[u,m,a,k,v,b,L,D,E],n===1)return o}if(n===void 0||n===2){const l=this.node2[t+s],u=t>=4?l>>2*(18-t)&3:3,m=t>=3?l>>2*(17-t)&3:3,a=t>=2?l>>2*(16-t)&3:3,k=t>=1?l>>2*(15-t)&3:3,v=l>>2*(14-t)&3,b=t<=13?l>>2*(13-t)&3:3,L=t<=12?l>>2*(12-t)&3:3,D=t<=11?l>>2*(11-t)&3:3,E=t<=10?l>>2*(10-t)&3:3;if(r=[u,m,a,k,v,b,L,D,E],n===2)return r}if(n===void 0||n===3){const l=this.node3[14+t-s],u=t>=4?l>>2*(18-t)&3:3,m=t>=3?l>>2*(17-t)&3:3,a=t>=2?l>>2*(16-t)&3:3,k=t>=1?l>>2*(15-t)&3:3,v=l>>2*(14-t)&3,b=t<=13?l>>2*(13-t)&3:3,L=t<=12?l>>2*(12-t)&3:3,D=t<=11?l>>2*(11-t)&3:3,E=t<=10?l>>2*(10-t)&3:3;if(h=[u,m,a,k,v,b,L,D,E],n===3)return h}return[e,o,r,h]}getPositionsInFourDirection(t,s){let n=[],e=[],o=[],r=[];const h=t-4>0?t-4:0,l=t+4<g-1?t+4:g-1,u=s-4>0?s-4:0,m=s+4<g-1?s+4:g-1;for(let a=u;a<=m;a++)n.push([t,a]);for(let a=h;a<=l;a++)e.push([a,s]);for(let a=4;a>0;a--)t-a>=h&&s+a<=m&&o.push([t-a,s+a]);o.push([t,s]);for(let a=1;a<=4;a++)t+a<=l&&s-a>=u&&o.push([t+a,s-a]);for(let a=4;a>0;a--)t-a>=h&&s-a>=u&&r.push([t-a,s-a]);r.push([t,s]);for(let a=1;a<=4;a++)t+a<=l&&s+a<=m&&r.push([t+a,s+a]);return[n,e,o,r]}updateFourLineScore(t,s){const n=this.getPositionsInFourDirection(t,s);for(let e=0;e<4;e++){const o=n[e];for(let r=0;r<o.length;r++){const h=o[r];this.updatePointScore(h,e)}}}updatePointScore(t,s){const[n,e]=t;this.getChess(n,e)!==z?(this.maxPointsScore[n][e]=[0,0,0,0],this.minPointsScore[n][e]=[0,0,0,0]):(this.maxPointsScore[n][e][s]=this.evaPoint(n,e,x,s),this.minPointsScore[n][e][s]=this.evaPoint(n,e,W,s))}evaPoint(t,s,n,e){const o=this.getChessInFourDirection(t,s,e),l=Ht(n===x?x:W,n===x?W:x,dt);let u=0;const m=l(o),a=R[m];return u+=a||0,u}orderPoints(t,s,n){let e=[],o=[],r=[],h=[],l=[],u=[],m=[],a=[],k=[],v=[],b=[],L=[],D=[],E=[],I=[],nt=[],tt=[],T=[],G=[],Y=[],q=[],st=[],f=[],F=[],C=[],A=[],K=[],Z=[];for(let S=0;S<t.length;S++){const d=t[S],[U,H]=d;let N=Q(this.maxPointsScore[U][H][0]);const M=Q(this.maxPointsScore[U][H][1]),P=Q(this.maxPointsScore[U][H][2]),y=Q(this.maxPointsScore[U][H][3]);N.l5+=M.l5+P.l5+y.l5,N.l4+=M.l4+P.l4+y.l4,N.d4+=M.d4+P.d4+y.d4,N.l3+=M.l3+P.l3+y.l3,N.d3+=M.d3+P.d3+y.d3,N.l2+=M.l2+P.l2+y.l2,N.d2+=M.d2+P.d2+y.d2,N.l1+=M.l1+P.l1+y.l1;const{l5:V,l4:ft,d4:ht,l3:it,d3:et,l2:ot,d2:lt,l1:ct}=N;V?e.push(d):ft?r.push(d):it&&ht?f.push(d):it>1?q.push(d):ot>2?K.push(d):it?m.push(d):ot>1?C.push(d):ht?l.push(d):ot?b.push(d):et?k.push(d):lt?D.push(d):ct===4?I.push(d):ct===3?tt.push(d):G.push(d)}for(let S=0;S<t.length;S++){const d=t[S],[U,H]=d;let N=Q(this.minPointsScore[U][H][0]);const M=Q(this.minPointsScore[U][H][1]),P=Q(this.minPointsScore[U][H][2]),y=Q(this.minPointsScore[U][H][3]),V={...N};V.l5+=N.l5+M.l5+P.l5+y.l5,V.l4+=N.l4+M.l4+P.l4+y.l4,V.d4+=N.d4+M.d4+P.d4+y.d4,V.l3+=N.l3+M.l3+P.l3+y.l3,V.d3+=N.d3+M.d3+P.d3+y.d3,V.l2+=N.l2+M.l2+P.l2+y.l2,V.d2+=N.d2+M.d2+P.d2+y.d2,V.l1+=N.l1+M.l1+P.l1+y.l1;const{l5:ft,l4:ht,d4:it,l3:et,d3:ot,l2:lt,d2:ct,l1:gt}=V;ft?o.push(d):ht?h.push(d):et&&it?F.push(d):et>1?st.push(d):lt>2?Z.push(d):et?a.push(d):lt>1?A.push(d):it?u.push(d):lt?L.push(d):ot?v.push(d):ct?E.push(d):gt===4?nt.push(d):gt===3?T.push(d):Y.push(d)}if(s===x){if(n)return e.length?e:o.length?[]:r.length?r:f.length||l.length?f.concat(l):h.length?[]:F.length?[]:q.length&&!u.length&&!F.length?q:m.length?m:[];if(e.length)return e;if(o.length)return o;if(r.length)return r;if(f.length)return f;if(h.length)return h;if(F.length)return F;if(q.length)return q;if(st.length)return st;const S=K.concat(Z).concat(m).concat(a).concat(C).concat(A).concat(l).concat(u).concat(k).concat(v).concat(b).concat(L).concat(I).concat(tt).concat(D).concat(E).concat(G);return S.length<=this.genLimit?S:S.slice(0,this.genLimit)}else{if(o.length)return o;if(e.length)return e;if(h.length)return h;if(F.length)return F;if(r.length)return r;if(f.length)return f;if(st.length)return st;if(q.length)return q;const S=Z.concat(K).concat(a).concat(m).concat(A).concat(C).concat(u).concat(l).concat(v).concat(k).concat(L).concat(b).concat(nt).concat(T).concat(E).concat(D).concat(Y);return S.length<=this.genLimit?S:S.slice(0,this.genLimit)}}evaluate(t,s){const n=this.winner;if(n===x)return p.win;if(n===W)return-p.win;if(t)return 0;let e=0,o=0,r=0,h=0,l=0,u=0,m=0,a=0,k=0,v=0,b=0,L=0,D=0,E=0,I=0,nt=0;const tt=(f,F)=>{if(F<34)return;const C=R[F];if(C)if(f===x)switch(C){case vt:return a++;case wt:return m++;case kt:return u++;case xt:return u+=2;case Lt:return l++;case St:return h++;case Nt:return r++;case Wt:return o++;case Et:return e++;default:return console.error("error")}else switch(C){case vt:return nt++;case wt:return I++;case kt:return E++;case xt:return E+=2;case Lt:return D++;case St:return L++;case Nt:return b++;case Wt:return v++;case Et:return k++;default:return console.error("error")}},T=(f,F,C)=>{let A=1,K=0,Z=!1;for(let S=0;S<15;S++){const d=C&3;if(C>>=2,d===F||d===dt){tt(f,A),A=1,Z=!0;continue}else if(d===z)if(K===0)K++,A<<=1;else{A<<=1,(C&12)===z&&S!==14&&(A<<=1),tt(f,A),A=4,(C&12)===z&&S!==14&&(A<<=1),K=0,Z=!0;continue}else K=0,Z=!1,A<<=1,A+=1}Z||tt(f,A)};for(let f=0;f<this.node0.length;f++)T(x,W,this.node0[f]);for(let f=0;f<this.node1.length;f++)T(x,W,this.node1[f]);for(let f=0;f<this.node2.length;f++)T(x,W,this.node2[f]);for(let f=0;f<this.node3.length;f++)T(x,W,this.node3[f]);for(let f=0;f<this.node0.length;f++)T(W,x,this.node0[f]);for(let f=0;f<this.node1.length;f++)T(W,x,this.node1[f]);for(let f=0;f<this.node2.length;f++)T(W,x,this.node2[f]);for(let f=0;f<this.node3.length;f++)T(W,x,this.node3[f]);s&&(console.log({maxL1:a,maxD2:m,maxL2:u,maxD3:l,maxL3:h,maxD4:r,maxL4:o,maxL5:e}),console.log({minL1:nt,minD2:I,minL2:E,minD3:D,minL3:L,minD4:b,minL4:v,minL5:k}));let G=0,Y=0;if((this.seekDepth&1)===0){if(o||r)return p.l5;if(v||L&b)return-p.l5;h&&(v||(G+=p.l4),h>1&&(G+=p.l3*2))}else{if(v||b)return-p.l5;if(o||h&r)return p.l5;L&&(o||(Y+=p.l4),L>1&&(Y+=p.l3*2))}return u>2&&(G+=p.l2),E>2&&(Y+=p.l2),G=p.l5*e+p.l4*o+p.d4*r+p.l3*h+p.d3*l+p.l2*u+p.d2*m+p.l1*m,Y=p.l5*k+p.l4*v+p.d4*b+p.l3*L+p.d3*D+p.l2*E+p.d2*I+p.l1*I,G-Y*(this.firstHand===W?2:1)}get winner(){if(this.stack.length<7)return null;const[t,s]=this.stack[this.stack.length-1],n=this.getChess(t,s),e=this.getChessInFourDirection(t,s);for(let o=0;o<4;o++){let r=0;const h=e[o];for(let l=0;l<h.length;l++)if(h[l]===n?r++:r=0,r===5)return n}return null}get winnerPositions(){if(!this.winner)return null;const[t,s]=this.stack[this.stack.length-1],n=this.getChess(t,s),e=this.getPositionsInFourDirection(t,s);for(let o=0;o<4;o++){const r=e[o];let h=0,l=[];for(let u=0;u<r.length;u++){const[m,a]=r[u];if(this.getChess(m,a)===n?(h++,l.push([m,a])):(h=0,l=[]),h===5)return l}}return null}get isFinal(){return!!this.winner||this.isBoardFull}get isBoardFull(){return this.stack.length===this.totalChessPieces}get lastChessPosition(){return this.stack.length?this.stack[this.stack.length-1]:null}get isDraw(){return this.isBoardFull&&!this.winner}printNode(){console.log(this.node0.map(t=>t.toString(2))),console.log(this.node1.map(t=>t.toString(2))),console.log(this.node2.map(t=>t.toString(2))),console.log(this.node3.map(t=>t.toString(2)))}initStats(){this.stats={abCut:{all:this.genLimit**this.seekDepth,eva:0,cut:0,toString(){const{all:t,eva:s,cut:n}=this.stats.abCut,e=t-s;return`AB剪枝 最大节点总数:${t} 理论最少评估${t**.5>>0} 实际评估:${s} 剪去:${n}/${e}`}},zobrist:{miss:0,hit:0,toString(){const{hit:t,miss:s}=this.stats.zobrist;return`zobrist 评估节点数:${this.stats.abCut.eva} hit:${t} miss:${s}`}}}}logStats(){Object.keys(this.stats).forEach(t=>{console.log(this.stats[t].toString.call(this))})}}rt($,"MAX",x),rt($,"MIN",W),rt($,"EMPTY",z),rt($,"WALL",dt);var c=function(i,t){this.data=[],this.row=i,this.column=t,this.wins=[],this.count=0,this.maxWin=[],this.minWin=[];for(var s=0;s<i;s++){this.data[s]=[],this.wins[s]=[];for(var n=0;n<t;n++)this.data[s][n]=c.NONE,this.wins[s][n]=[]}for(var s=0;s<i;s++)for(var n=0;n<=t-5;n++){for(var e=0;e<5;e++)this.wins[s][n+e][this.count]=!0;this.count++}for(var s=0;s<t;s++)for(var n=0;n<=i-5;n++){for(var e=0;e<5;e++)this.wins[n+e][s][this.count]=!0;this.count++}for(var s=0;s<=i-5;s++)for(var n=0;n<=t-5;n++){for(var e=0;e<5;e++)this.wins[s+e][n+e][this.count]=!0;this.count++}for(var s=0;s<=i-5;s++)for(var n=t-1;n>=4;n--){for(var e=0;e<5;e++)this.wins[s+e][n-e][this.count]=!0;this.count++}for(var s=0;s<this.count;s++)this.maxWin[s]={max:0,min:0},this.minWin[s]={min:0,max:0};this.stack=[],this.is_ended=!1};c.prototype.toString=function(){return this.data.map(function(i){return i.toString()}).join(`
`)};c.prototype.current=function(){var i=this.stack.length;if(i)return this.stack[i-1]};c.prototype.put=function(i,t,s){if(this.data[i][t]==c.NONE){this.data[i][t]=s,this.stack.push({row:i,column:t,type:s});for(var n=0;n<this.count;n++)this.wins[i][t][n]&&(s==c.MAX?(this.maxWin[n].max++,this.minWin[n].max++):(this.minWin[n].min++,this.maxWin[n].min++));this.stack.length==this.row*this.column&&this.end()}return this};c.prototype.rollback=function(i){var t=[];i=i||1;for(var s=0;s<i;s++){var n=this.stack.pop();if(n){t.push(n);var e=n.row,o=n.column,r=n.type;this.data[e][o]=c.NONE;for(var h=0;h<this.count;h++)this.wins[e][o][h]&&(r==c.MAX?(this.maxWin[h].max--,this.minWin[h].max--):(this.minWin[h].min--,this.maxWin[h].min--))}}return this.is_ended=!1,t};c.prototype.getNearPoints=function(i){for(var t=[],s,n,e=-2;e<=2;e++)s=i.row+e,n=i.column+e,this.isValid(s,n)&&t.push({row:s,column:n}),s=i.row-e,n=i.column+e,this.isValid(s,n)&&t.push({row:s,column:n}),s=i.row,n=i.column-e,this.isValid(s,n)&&t.push({row:s,column:n}),s=i.row-e,n=i.column,this.isValid(s,n)&&t.push({row:s,column:n});return t};c.prototype.isValid=function(i,t){return i>=0&&i<this.row&&t>=0&&t<this.column&&this.data[i][t]==c.NONE};c.prototype.availableSteps=function(){var i=[],t=this.row,s=this.column,n=this.stack.length,e=Math.floor((t-1)/2),o=Math.floor((s-1)/2);if(!n||n==1&&this.data[e][o]==c.NONE)return i.push({row:e,column:o}),i;if(n==1){var r=e+(Math.random()<.5?-1:1),h=o+(Math.random()<.5?-1:1);return i.push({row:r,column:h}),i}else{var l={};return this.stack.forEach(function(u){var m=this.getNearPoints(u);m.forEach(function(a){var k=a.row,v=a.column;l[k+"#"+v]||(i.push(a),l[k+"#"+v]=!0)})}.bind(this)),i}};c.prototype.evaluate=function(){for(var n=e=0,i={5:0,4:0,3:0,2:0,1:0},t={5:0,4:0,3:0,2:0,1:0},s=0;s<this.count;s++){if(this.maxWin[s].max==5&&!this.maxWin[s].min)return c.MAX_VALUE;if(this.minWin[s].min==5&&!this.minWin[s].max)return c.MIN_VALUE;this.maxWin[s].max==4&&!this.maxWin[s].min&&i[4]++,this.minWin[s].min==4&&!this.minWin[s].max&&t[4]++,this.maxWin[s].max==3&&!this.maxWin[s].min&&i[3]++,this.minWin[s].min==3&&!this.minWin[s].max&&t[3]++,this.maxWin[s].max==2&&!this.maxWin[s].min&&i[2]++,this.minWin[s].min==2&&!this.minWin[s].max&&t[2]++,this.maxWin[s].max==1&&!this.maxWin[s].min&&i[1]++,this.minWin[s].min==1&&!this.minWin[s].max&&t[1]++}var n=i[4]*c.FOUR_W+i[3]*c.THREE_W+i[2]*c.TWO_W+i[1]*c.ONE_W,e=t[4]*c.FOUR_W+t[3]*c.THREE_W+t[2]*c.TWO_W+t[1]*c.ONE_W;return n-e};c.prototype.isMaxWin=function(){var i=this.evaluate();return i==c.MAX_VALUE};c.prototype.isMinWin=function(){var i=this.evaluate();return i==c.MIN_VALUE};c.prototype.end=function(){return this.is_ended=!0,this};c.prototype.isEnded=function(){return this.is_ended};c.prototype.max=function(i,t,s){var n,e,o=-1/0;if(t==0)return o=i.evaluate(),{w:o};var r=i.availableSteps();if(r.length){for(var h=0,l=r.length;h<l;h++){var u=r[h];if(i.put(u.row,u.column,c.MAX),i.isMaxWin()){o=c.MAX_VALUE,n=u.row,e=u.column,i.rollback();break}else{var m=c.prototype.min(i,t-1)||{w:i.evaluate()};if(i.rollback(),m.w>o&&(o=m.w,n=u.row,e=u.column),o>=s)break}}return{w:o,row:n,column:e}}};c.prototype.min=function(i,t,s){var n,e,o=1/0;if(t==0)return o=i.evaluate(),{w:o};var r=i.availableSteps();if(r.length){for(var h=0,l=r.length;h<l;h++){var u=r[h];if(i.put(u.row,u.column,c.MIN),i.isMinWin()){o=c.MIN_VALUE,n=u.row,e=u.column,i.rollback();break}else{var m=c.prototype.max(i,t-1,o)||{w:i.evaluate()};if(i.rollback(),m.w<o&&(o=m.w,n=u.row,e=u.column),o<=s)break}}return{w:o,row:n,column:e}}};c.NONE=0;c.MAX=1;c.MIN=2;c.FIVE_TYPE=1;c.FOUR_TYPE=3;c.THREE_TYPE=5;c.TWO_TYPE=7;c.MAX_VALUE=1e5;c.MIN_VALUE=-1e5;c.FOUR_W=5e3;c.THREE_W=1e3;c.TWO_W=200;c.ONE_W=10;const Mt=()=>w("div",{className:"num",children:at(g).map(i=>w("div",{className:"item",children:g-i},i))});const Pt=()=>w("div",{className:"abc",children:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O"].map(i=>w("div",{className:"item",children:i},i))});var ut=new c(g,g);let _=new $({boardLength:g});const is=({position:i,value:t,onClick:s,isLastChess:n,isMarkPoint:e,isWinnerPoint:o})=>{const r=_.stack.findIndex(h=>h[0]===i[0]&&h[1]===i[1]);return J("button",{className:`square ${n&&"lastChess"}`,onClick:s,children:[t!==$.EMPTY&&w("div",{className:["chess",t===_.firstHand?"black":"white",o?"pulse":""].join(" "),children:r+1||null}),e&&w("div",{className:"markPoint"})]})},ns=({squares:i,onClick:t})=>{const s=_.lastChessPosition,n=_.winner?_.winnerPositions:null;return J("div",{className:"boardCenter",children:[w("div",{className:"rowLines",children:at(g).map(e=>w("div",{className:"item"},e))}),w("div",{className:"colLines",children:at(g).map(e=>w("div",{className:"item"},e))}),w("div",{className:"chesses",children:at(g).map(e=>w("div",{className:"boardRow",children:at(g).map(o=>w(is,{position:[e,o],value:i[e][o],isLastChess:s&&s[0]===e&&s[1]===o,isWinnerPoint:n&&n.some(([r,h])=>r===e&&h===o),isMarkPoint:e===3&&o===3||e===3&&o===11||e===7&&o===7||e===11&&o===3||e===11&&o===11,onClick:()=>t(e,o)},o))},e))})]})},es=()=>{const[i,t]=pt.useState(!1),[s,n]=pt.useReducer(a=>a+1,0),{winner:e,isFinal:o,isDraw:r}=_,h=(a,k)=>{if(!i)return console.log({start:i});if(o)return console.log({isFinal:o});let v;if(window.test){console.time("b1");var b=c.prototype.min(ut,2);console.timeEnd("b1"),ut.put(b.row,b.column,c.MIN),v=_.minGo(b.row,b.column)}else v=_.minGo(a,k);v&&(n(),setTimeout(l,0))},l=()=>{const a=_.maxGo();n();const{i:k,j:v}=a;ut.put(k,v,c.MAX)},u=()=>{t(!1)},m=a=>{t(!0),_=new $({firstHand:a}),window.gobang=_,ut=new c(g,g),_.firstHand===$.MAX&&l(),n()};return e&&console.log(`${e===$.MAX?"bot":"human"} 胜出`),J("div",{className:"game",children:[J("div",{className:"gameBoard",children:[w(Mt,{}),J("div",{className:"center",children:[w(Pt,{}),w(ns,{squares:_.node,onClick:Bt(h,50)}),w(Pt,{})]}),w(Mt,{})]}),J("div",{className:"opbtns",children:[i&&w("button",{onClick:u,children:"重来"}),!i&&w("button",{onClick:()=>m($.MAX),children:"开始 - 电脑先"}),!i&&w("button",{onClick:()=>m($.MIN),children:"开始 - 玩家先"}),i&&w("button",{onClick:()=>{_.minRepent(),n()},children:"悔棋"})]}),J("div",{className:"game-info",children:[w("div",{children:o&&"game over"}),w("div",{children:e&&`${e===$.MAX?"少侠请努力":"干得漂亮"}`}),w("div",{children:r&&"和棋~"}),w("ol",{})]})]})},os=es;Xt.createRoot(document.getElementById("root")).render(w(os,{}));
