var Tt=Object.defineProperty;var Vt=(i,t,s)=>t in i?Tt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s;var lt=(i,t,s)=>(Vt(i,typeof t!="symbol"?t+"":t,s),s);import{j as yt,r as ft,a as pt,c as Xt}from"./vendor-cd7d93c1.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function s(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerpolicy&&(o.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?o.credentials="include":e.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(e){if(e.ep)return;e.ep=!0;const o=s(e);fetch(e.href,o)}})();const k=yt.jsx,I=yt.jsxs,Q=0,L=1,y=2,dt=3,g=15,j=g/2>>0,U=(i,t=null)=>Array(i).fill(t),Bt=(i,t=20)=>{let s=+new Date;return(...n)=>{+new Date-s>t&&i(...n),s=+new Date}},zt=i=>t=>Array(t-i).fill(null).map((s,n)=>i+n),rt=zt(0),Dt=2**0,At=2**3,bt=2**6,_t=bt*2,Ot=2**9,Ct=2**12,Ft=2**14,$t=2**16,Rt=2**18,Ut={l1:Dt,d2:At,l2:bt,d3:Ot,l3:Ct,d4:Ft,l4:$t,l5:Rt,l2x2:_t},Z=i=>({l1:i&7,d2:(i&56)>>3,l2:(i&960)>>6,d3:(i&7680)>>9,l3:(i&12288)>>12,d4:(i&49152)>>14,l4:(i&196608)>>16,l5:(i&786432)>>18}),p={l1:10,d2:10,d3:200,l2:150,l2x2:300,l3:200,d4:2e3,l4:5e3,l5:1e4,win:1e5};console.warn("todo: 测试 countLine 是否正确");const Ht=(i,t,s)=>n=>{let e=1;for(let o=0;o<n.length;o++){const r=n[o];if(o<4)e<<=1,r===i?e+=1:(r===t||r===s)&&(e=1);else if(o===4)e<<=1,e+=1;else{if(r===t||r===s)break;e<<=1,r===i&&(e+=1)}}return e},Gt=i=>{let t=[],s=2**(i+1);for(;s-- >0;)t.push("0b"+s.toString(2));return t},X=Gt(11),Yt=i=>/010/.test(i)&&i.length>5,qt=i=>/10{0,1}1/.test(i)&&i.length>=5,Kt=i=>[/000110/,/001100/,/011000/,/001010/,/010100/].some(t=>t.test(i)),jt=i=>/0101010/.test(i),Zt=i=>[/111/,/1011/,/1101/,/11001/,/10011/,/10101/].some(t=>t.test(i))&&i.length>=5,Qt=i=>[/010110/,/011010/,/01110/,/1010101/].some(t=>t.test(i)),It=i=>[/11110/,/01111/,/11011/,/11101/,/10111/].some(t=>t.test(i)),Jt=i=>[/011110/,/1011101/,/11011011/,/111010111/].some(t=>t.test(i)),ts=i=>/1{5}/.test(i),O={};X.forEach(i=>O[i]=null);const R=[];X.forEach(i=>Yt(i.slice(3))&&(O[i]="l1")&&(R[+i]=Dt));X.forEach(i=>qt(i.slice(3))&&(O[i]="d2")&&(R[+i]=At));X.forEach(i=>Kt(i.slice(3))&&(O[i]="l2")&&(R[+i]=bt));X.forEach(i=>Zt(i.slice(3))&&(O[i]="d3")&&(R[+i]=Ot));X.forEach(i=>jt(i.slice(3))&&(O[i]="l2x2")&&(R[+i]=_t));X.forEach(i=>Qt(i.slice(3))&&(O[i]="l3")&&(R[+i]=Ct));X.forEach(i=>It(i.slice(3))&&(O[i]="d4")&&(R[+i]=Ft));X.forEach(i=>Jt(i.slice(3))&&(O[i]="l4")&&(R[+i]=$t));X.forEach(i=>ts(i.slice(3))&&(O[i]="l5")&&(R[+i]=Rt));console.log("未构成棋型的组合, 这一部分已经验证",Object.keys(O).filter(i=>!O[i]).map(i=>i.slice(3)));console.warn("todo: 验证以下棋型是否正确");Object.keys(p).forEach(i=>{console.log(i,Object.keys(O).filter(t=>O[t]===i).map(t=>t.slice(3)))});console.log({allModes:X,serialPointMode:R});class ss{constructor({size:t}){this.max=U(t).map(n=>U(t).map(()=>ft.int(0,1073741824))),this.min=U(t).map(n=>U(t).map(()=>ft.int(0,1073741824))),this.code=ft.int(0,1073741824),this.hash={}}go(t,s,n){this.code^=n?this.max[t][s]:this.min[t][s]}get(){return this.hash[this.code]}set(t){this.hash[this.code]=t}resetHash(){this.hash={}}}const{l1:vt,d2:wt,l2:kt,l2x2:xt,d3:Lt,l3:St,d4:Nt,l4:Wt,l5:Et}=Ut;function mt(i,t){const s=this.winner;if(s===L)return p.win;if(s===y)return-p.win;if(i)return 0;let n=0,e=0,o=0,r=0,h=0,l=0,u=0,m=0,a=0,w=0,v=0,d=0,N=0,W=0,D=0,it=0;const J=(f,C)=>{if(C<34)return;const F=R[C];if(F)if(f===L)switch(F){case vt:return m++;case wt:return u++;case kt:return l++;case xt:return l+=2;case Lt:return h++;case St:return r++;case Nt:return o++;case Wt:return e++;case Et:return n++;default:return console.error("error")}else switch(F){case vt:return it++;case wt:return D++;case kt:return W++;case xt:return W+=2;case Lt:return N++;case St:return d++;case Nt:return v++;case Wt:return w++;case Et:return a++;default:return console.error("error")}},T=(f,C,F)=>{let A=1,q=0,K=!1;for(let x=0;x<15;x++){const b=F&3;if(F>>=2,b===C||b===dt){J(f,A),A=1,K=!0;continue}else if(b===Q)if(q===0)q++,A<<=1;else{A<<=1,(F&12)===Q&&x!==14&&(A<<=1),J(f,A),A=4,(F&12)===Q&&x!==14&&(A<<=1),q=0,K=!0;continue}else q=0,K=!1,A<<=1,A+=1}K||J(f,A)};for(let f=0;f<this.node0.length;f++)T(L,y,this.node0[f]);for(let f=0;f<this.node1.length;f++)T(L,y,this.node1[f]);for(let f=0;f<this.node2.length;f++)T(L,y,this.node2[f]);for(let f=0;f<this.node3.length;f++)T(L,y,this.node3[f]);for(let f=0;f<this.node0.length;f++)T(y,L,this.node0[f]);for(let f=0;f<this.node1.length;f++)T(y,L,this.node1[f]);for(let f=0;f<this.node2.length;f++)T(y,L,this.node2[f]);for(let f=0;f<this.node3.length;f++)T(y,L,this.node3[f]);t&&(console.log({maxL1:m,maxD2:u,maxL2:l,maxD3:h,maxL3:r,maxD4:o,maxL4:e,maxL5:n}),console.log({minL1:it,minD2:D,minL2:W,minD3:N,minL3:d,minD4:v,minL4:w,minL5:a}));let H=0,G=0;if((this.seekDepth&1)===0){if(e||o)return p.l5;if(w||d&v)return-p.l5;r&&(w||(H+=p.l4),r>1&&(H+=p.l3*2))}else{if(w||v)return-p.l5;if(e||r&o)return p.l5;d&&(e||(G+=p.l4),d>1&&(G+=p.l3*2))}return l>2&&(H+=p.l2),W>2&&(G+=p.l2),H=p.l5*n+p.l4*e+p.d4*o+p.l3*r+p.d3*h+p.l2*l+p.d2*u+p.l1*u,G=p.l5*a+p.l4*w+p.d4*v+p.l3*d+p.d3*N+p.l2*W+p.d2*D+p.l1*D,H-G*(this.firstHand===y?2:1)}function is(i,t,s){let n=[],e=[],o=[],r=[],h=[],l=[],u=[],m=[],a=[],w=[],v=[],d=[],N=[],W=[],D=[],it=[],J=[],T=[],H=[],G=[],Y=[],tt=[],f=[],C=[],F=[],A=[],q=[],K=[];for(let x=0;x<i.length;x++){const b=i[x],[B,z]=b;let S=Z(this.maxPointsScore[B][z][0]);const E=Z(this.maxPointsScore[B][z][1]),M=Z(this.maxPointsScore[B][z][2]),P=Z(this.maxPointsScore[B][z][3]);S.l5+=E.l5+M.l5+P.l5,S.l4+=E.l4+M.l4+P.l4,S.d4+=E.d4+M.d4+P.d4,S.l3+=E.l3+M.l3+P.l3,S.d3+=E.d3+M.d3+P.d3,S.l2+=E.l2+M.l2+P.l2,S.d2+=E.d2+M.d2+P.d2,S.l1+=E.l1+M.l1+P.l1;const{l5:V,l4:ut,d4:at,l3:st,d3:nt,l2:et,d2:ot,l1:ht}=S;V?n.push(b):ut?o.push(b):st&&at?f.push(b):st>1?Y.push(b):et>2?q.push(b):st?u.push(b):et>1?F.push(b):at?h.push(b):et?v.push(b):nt?a.push(b):ot?N.push(b):ht===4?D.push(b):ht===3?J.push(b):H.push(b)}for(let x=0;x<i.length;x++){const b=i[x],[B,z]=b;let S=Z(this.minPointsScore[B][z][0]);const E=Z(this.minPointsScore[B][z][1]),M=Z(this.minPointsScore[B][z][2]),P=Z(this.minPointsScore[B][z][3]),V={...S};V.l5+=S.l5+E.l5+M.l5+P.l5,V.l4+=S.l4+E.l4+M.l4+P.l4,V.d4+=S.d4+E.d4+M.d4+P.d4,V.l3+=S.l3+E.l3+M.l3+P.l3,V.d3+=S.d3+E.d3+M.d3+P.d3,V.l2+=S.l2+E.l2+M.l2+P.l2,V.d2+=S.d2+E.d2+M.d2+P.d2,V.l1+=S.l1+E.l1+M.l1+P.l1;const{l5:ut,l4:at,d4:st,l3:nt,d3:et,l2:ot,d2:ht,l1:gt}=V;ut?e.push(b):at?r.push(b):nt&&st?C.push(b):nt>1?tt.push(b):ot>2?K.push(b):nt?m.push(b):ot>1?A.push(b):st?l.push(b):ot?d.push(b):et?w.push(b):ht?W.push(b):gt===4?it.push(b):gt===3?T.push(b):G.push(b)}if(t){if(s)return n.length?n:e.length?[]:o.length?o:f.length||h.length?f.concat(h):r.length?[]:C.length?[]:Y.length&&!l.length&&!C.length?Y:u.length?u:[];if(n.length)return n;if(e.length)return e;if(o.length)return o;if(f.length)return f;if(r.length)return r;if(C.length)return C;if(Y.length)return Y;if(tt.length)return tt;const x=q.concat(K).concat(u).concat(m).concat(F).concat(A).concat(h).concat(l).concat(a).concat(w).concat(v).concat(d).concat(D).concat(J).concat(N).concat(W).concat(H);return x.length<=this.genLimit?x:x.slice(0,this.genLimit)}else{if(e.length)return e;if(n.length)return n;if(r.length)return r;if(C.length)return C;if(o.length)return o;if(f.length)return f;if(tt.length)return tt;if(Y.length)return Y;const x=K.concat(q).concat(m).concat(u).concat(A).concat(F).concat(l).concat(h).concat(w).concat(a).concat(d).concat(v).concat(it).concat(T).concat(W).concat(N).concat(G);return x.length<=this.genLimit?x:x.slice(0,this.genLimit)}}class ${constructor({firstHand:t}){this.totalChessPieces=g*g,this.initNode(),this.stack=[],this.zobrist=new ss({size:g}),this.maxPointsScore=U(g).map(s=>U(g,[0,0,0,0])),this.minPointsScore=U(g).map(s=>U(g,[0,0,0,0])),this.stats={},this.enableStats=!0,this.enableLog=!1,this.firstHand=t||y,this.genLimit=60,this.seekDepth=4,this.seekKillDepth=19}isWall(t,s){return t<0||t>=g||s<0||s>=g}initNode(){this.node0=U(g,0);const t=new ArrayBuffer(4*15);this.node1=new Int32Array(t);for(let s=0;s<=14;s++)this.node1[s]=0;this.node2=[];for(let s=0;s<g*2-1;s++){let n=0;for(let e=0;e<15;e++){const o=s-e;n<<=2,this.isWall(e,o)&&(n+=3)}this.node2[s]=n}this.node3=[];for(let s=0;s<g*2-1;s++){let n=0;for(let e=0;e<15;e++){const o=14+e-s;n<<=2,this.isWall(e,o)&&(n+=3)}this.node3[s]=n}}put(t,s,n){this.zobrist.go(t,s,n===L),this.stack.push([t,s]),this.node0[t]=this.node0[t]|n<<2*(14-s),this.node1[s]=this.node1[s]|n<<2*(14-t),this.node2[t+s]=this.node2[t+s]|n<<2*(14-t),this.node3[14+t-s]=this.node3[14+t-s]|n<<2*(14-t),this.updateFourLineScore(t,s)}rollback(t=1){if(!(this.stack.length<t))for(;t-- >0;){const[s,n]=this.stack.pop();this.zobrist.go(s,n,this.getChess(s,n)===L);const e=2*(14-n);this.node0[s]=(this.node0[s]|3<<e)^3<<e;const o=2*(14-s);this.node1[n]=(this.node1[n]|3<<o)^3<<o,this.node2[s+n]=(this.node2[s+n]|3<<o)^3<<o,this.node3[14+s-n]=(this.node3[14+s-n]|3<<o)^3<<o,this.updateFourLineScore(s,n)}}maxGo(){if(this.isFinal)return;this.zobrist.resetHash(),this.initStats();let t;this.stack.length>4&&(console.time("thinking kill"),t=this.minimax(this.seekKillDepth,!0),console.timeEnd("thinking kill")),(t==null?void 0:t.score)>=p.win?console.warn("算杀成功 :)"):(console.time("thinking"),t=this.minimax(this.seekDepth),console.timeEnd("thinking")),console.log({score:t});const{i:s,j:n}=t;return this.put(s,n,L),this.logStats(),console.log("score",mt.call(this,!1,!0)),t}minGo(t,s){if(!this.isFinal)return this.isEmptyPosition(t,s)?(this.put(t,s,y),console.log("score",mt.call(this)),!0):!1}minRepent(){this.stack.length>=2&&this.rollback(2)}isEmptyPosition(t,s){return!this.isWall(t,s)&&this.getChess(t,s)===Q}getNearPositions(t){const s=[],[e,o]=t;for(let r=-2;r<=2;r++)for(let h=-2;h<=2;h++)this.isEmptyPosition(r+e,h+o)&&s.push([r+e,h+o]);return s}getAllOptimalNextStep(){if(this.stack.length===0)return[[j,j]];if(this.stack.length===1){if(this.isEmptyPosition(j,j))return[[j,j]];const s=j+(Math.random()>.5?1:-1),n=j+(Math.random()>.5?1:-1);return[[s,n]]}let t=[];for(let s=0;s<g;s++)for(let n=0;n<g;n++)this.getChess(s,n)===Q&&this.haveNeighbor(s,n)&&t.push([s,n]);return t}haveNeighbor(t,s){for(let e=-2;e<=2;e++)if(!(e+t<0||e+t>=g))for(let o=-2;o<=2;o++){if(o+s<0||o+s>=g||e===0&&o===0)continue;if(this.getChess(e+t,s+o)!==Q)return!0}return!1}getChess(t,s){return this.node0[t]>>2*(14-s)&3}minimax(t,s,n=-1/0,e=1/0,o=!0){if(this.isFinal||t===0)return{score:mt.call(this,s),depth:t};const r=is.call(this,this.getAllOptimalNextStep(),o,s);if(!(r!=null&&r.length))return{score:0};if(o){let h=-1/0,l=r[0];for(const a of r){const[w,v]=a;this.put(w,v,L),this.enableStats&&this.stats.abCut.eva++;let d=this.zobrist.get();if(d===void 0?(d=this.minimax(t-1,s,n,e,!o).score,this.zobrist.set(d),this.enableStats&&this.stats.zobrist.miss++):this.enableStats&&this.stats.zobrist.hit++,this.rollback(),d>h&&(h=d,l=a),n=Math.max(n,h),e<=n){this.enableStats&&this.stats.abCut.cut++;break}}const[u,m]=l;return{score:h,i:u,j:m}}else{let h=1/0,l=r[0];for(const a of r){const[w,v]=a;this.put(w,v,y),this.enableStats&&this.stats.abCut.eva++;let d=this.zobrist.get();if(d===void 0?(d=this.minimax(t-1,s,n,e,!o).score,this.zobrist.set(d),this.enableStats&&this.stats.zobrist.miss++):this.enableStats&&this.stats.zobrist.hit++,this.rollback(),d<h&&(h=d,l=a),e=Math.min(e,h),e<=n){this.enableStats&&this.stats.abCut.cut++;break}}const[u,m]=l;return{score:h,i:u,j:m}}}getChessInFourDirection(t,s,n){let e=[],o=[],r=[],h=[];if(n===void 0||n===0){const l=this.node0[t],u=s>=4?l>>2*(18-s)&3:3,m=s>=3?l>>2*(17-s)&3:3,a=s>=2?l>>2*(16-s)&3:3,w=s>=1?l>>2*(15-s)&3:3,v=l>>2*(14-s)&3,d=s<=13?l>>2*(13-s)&3:3,N=s<=12?l>>2*(12-s)&3:3,W=s<=11?l>>2*(11-s)&3:3,D=s<=10?l>>2*(10-s)&3:3;if(e=[u,m,a,w,v,d,N,W,D],n===0)return e}if(n===void 0||n===1){const l=this.node1[s],u=t>=4?l>>2*(18-t)&3:3,m=t>=3?l>>2*(17-t)&3:3,a=t>=2?l>>2*(16-t)&3:3,w=t>=1?l>>2*(15-t)&3:3,v=l>>2*(14-t)&3,d=t<=13?l>>2*(13-t)&3:3,N=t<=12?l>>2*(12-t)&3:3,W=t<=11?l>>2*(11-t)&3:3,D=t<=10?l>>2*(10-t)&3:3;if(o=[u,m,a,w,v,d,N,W,D],n===1)return o}if(n===void 0||n===2){const l=this.node2[t+s],u=t>=4?l>>2*(18-t)&3:3,m=t>=3?l>>2*(17-t)&3:3,a=t>=2?l>>2*(16-t)&3:3,w=t>=1?l>>2*(15-t)&3:3,v=l>>2*(14-t)&3,d=t<=13?l>>2*(13-t)&3:3,N=t<=12?l>>2*(12-t)&3:3,W=t<=11?l>>2*(11-t)&3:3,D=t<=10?l>>2*(10-t)&3:3;if(r=[u,m,a,w,v,d,N,W,D],n===2)return r}if(n===void 0||n===3){const l=this.node3[14+t-s],u=t>=4?l>>2*(18-t)&3:3,m=t>=3?l>>2*(17-t)&3:3,a=t>=2?l>>2*(16-t)&3:3,w=t>=1?l>>2*(15-t)&3:3,v=l>>2*(14-t)&3,d=t<=13?l>>2*(13-t)&3:3,N=t<=12?l>>2*(12-t)&3:3,W=t<=11?l>>2*(11-t)&3:3,D=t<=10?l>>2*(10-t)&3:3;if(h=[u,m,a,w,v,d,N,W,D],n===3)return h}return[e,o,r,h]}getPositionsInFourDirection(t,s){let n=[],e=[],o=[],r=[];const h=t-4>0?t-4:0,l=t+4<g-1?t+4:g-1,u=s-4>0?s-4:0,m=s+4<g-1?s+4:g-1;for(let a=u;a<=m;a++)n.push([t,a]);for(let a=h;a<=l;a++)e.push([a,s]);for(let a=4;a>0;a--)t-a>=h&&s+a<=m&&o.push([t-a,s+a]);o.push([t,s]);for(let a=1;a<=4;a++)t+a<=l&&s-a>=u&&o.push([t+a,s-a]);for(let a=4;a>0;a--)t-a>=h&&s-a>=u&&r.push([t-a,s-a]);r.push([t,s]);for(let a=1;a<=4;a++)t+a<=l&&s+a<=m&&r.push([t+a,s+a]);return[n,e,o,r]}updateFourLineScore(t,s){const n=this.getPositionsInFourDirection(t,s);for(let e=0;e<4;e++){const o=n[e];for(let r=0;r<o.length;r++){const h=o[r];this.updatePointScore(h,e)}}}updatePointScore(t,s){const[n,e]=t;this.getChess(n,e)!==Q?(this.maxPointsScore[n][e]=[0,0,0,0],this.minPointsScore[n][e]=[0,0,0,0]):(this.maxPointsScore[n][e][s]=this.evaPoint(n,e,L,s),this.minPointsScore[n][e][s]=this.evaPoint(n,e,y,s))}evaPoint(t,s,n,e){const o=this.getChessInFourDirection(t,s,e),l=Ht(n===L?L:y,n===L?y:L,dt);let u=0;const m=l(o),a=R[m];return u+=a||0,u}get winner(){if(this.stack.length<7)return null;const[t,s]=this.stack[this.stack.length-1],n=this.getChess(t,s),e=this.getChessInFourDirection(t,s);for(let o=0;o<4;o++){let r=0;const h=e[o];for(let l=0;l<h.length;l++)if(h[l]===n?r++:r=0,r===5)return n}return null}get winnerPositions(){if(!this.winner)return null;const[t,s]=this.stack[this.stack.length-1],n=this.getChess(t,s),e=this.getPositionsInFourDirection(t,s);for(let o=0;o<4;o++){const r=e[o];let h=0,l=[];for(let u=0;u<r.length;u++){const[m,a]=r[u];if(this.getChess(m,a)===n?(h++,l.push([m,a])):(h=0,l=[]),h===5)return l}}return null}get isFinal(){return!!this.winner||this.isBoardFull}get isBoardFull(){return this.stack.length===this.totalChessPieces}get lastChessPosition(){return this.stack.length?this.stack[this.stack.length-1]:null}get isDraw(){return this.isBoardFull&&!this.winner}get node(){return this.node0.map(t=>{let s=[];for(let n=0;n<g;n++)s.push((t&3<<2*n)>>2*n);return s.reverse()})}printNode(){console.log(this.node0.map(t=>t.toString(2))),console.log(this.node1.map(t=>t.toString(2))),console.log(this.node2.map(t=>t.toString(2))),console.log(this.node3.map(t=>t.toString(2)))}initStats(){this.stats={abCut:{all:this.genLimit**this.seekDepth,eva:0,cut:0,toString(){const{all:t,eva:s,cut:n}=this.stats.abCut,e=t-s;return`AB剪枝 最大节点总数:${t} 理论最少评估${t**.5>>0} 实际评估:${s} 剪去:${n}/${e}`}},zobrist:{miss:0,hit:0,toString(){const{hit:t,miss:s}=this.stats.zobrist;return`zobrist 评估节点数:${this.stats.abCut.eva} hit:${t} miss:${s}`}}}}logStats(){Object.keys(this.stats).forEach(t=>{console.log(this.stats[t].toString.call(this))})}}lt($,"MAX",L),lt($,"MIN",y),lt($,"EMPTY",Q),lt($,"WALL",dt);var c=function(i,t){this.data=[],this.row=i,this.column=t,this.wins=[],this.count=0,this.maxWin=[],this.minWin=[];for(var s=0;s<i;s++){this.data[s]=[],this.wins[s]=[];for(var n=0;n<t;n++)this.data[s][n]=c.NONE,this.wins[s][n]=[]}for(var s=0;s<i;s++)for(var n=0;n<=t-5;n++){for(var e=0;e<5;e++)this.wins[s][n+e][this.count]=!0;this.count++}for(var s=0;s<t;s++)for(var n=0;n<=i-5;n++){for(var e=0;e<5;e++)this.wins[n+e][s][this.count]=!0;this.count++}for(var s=0;s<=i-5;s++)for(var n=0;n<=t-5;n++){for(var e=0;e<5;e++)this.wins[s+e][n+e][this.count]=!0;this.count++}for(var s=0;s<=i-5;s++)for(var n=t-1;n>=4;n--){for(var e=0;e<5;e++)this.wins[s+e][n-e][this.count]=!0;this.count++}for(var s=0;s<this.count;s++)this.maxWin[s]={max:0,min:0},this.minWin[s]={min:0,max:0};this.stack=[],this.is_ended=!1};c.prototype.toString=function(){return this.data.map(function(i){return i.toString()}).join(`
`)};c.prototype.current=function(){var i=this.stack.length;if(i)return this.stack[i-1]};c.prototype.put=function(i,t,s){if(this.data[i][t]==c.NONE){this.data[i][t]=s,this.stack.push({row:i,column:t,type:s});for(var n=0;n<this.count;n++)this.wins[i][t][n]&&(s==c.MAX?(this.maxWin[n].max++,this.minWin[n].max++):(this.minWin[n].min++,this.maxWin[n].min++));this.stack.length==this.row*this.column&&this.end()}return this};c.prototype.rollback=function(i){var t=[];i=i||1;for(var s=0;s<i;s++){var n=this.stack.pop();if(n){t.push(n);var e=n.row,o=n.column,r=n.type;this.data[e][o]=c.NONE;for(var h=0;h<this.count;h++)this.wins[e][o][h]&&(r==c.MAX?(this.maxWin[h].max--,this.minWin[h].max--):(this.minWin[h].min--,this.maxWin[h].min--))}}return this.is_ended=!1,t};c.prototype.getNearPoints=function(i){for(var t=[],s,n,e=-2;e<=2;e++)s=i.row+e,n=i.column+e,this.isValid(s,n)&&t.push({row:s,column:n}),s=i.row-e,n=i.column+e,this.isValid(s,n)&&t.push({row:s,column:n}),s=i.row,n=i.column-e,this.isValid(s,n)&&t.push({row:s,column:n}),s=i.row-e,n=i.column,this.isValid(s,n)&&t.push({row:s,column:n});return t};c.prototype.isValid=function(i,t){return i>=0&&i<this.row&&t>=0&&t<this.column&&this.data[i][t]==c.NONE};c.prototype.availableSteps=function(){var i=[],t=this.row,s=this.column,n=this.stack.length,e=Math.floor((t-1)/2),o=Math.floor((s-1)/2);if(!n||n==1&&this.data[e][o]==c.NONE)return i.push({row:e,column:o}),i;if(n==1){var r=e+(Math.random()<.5?-1:1),h=o+(Math.random()<.5?-1:1);return i.push({row:r,column:h}),i}else{var l={};return this.stack.forEach(function(u){var m=this.getNearPoints(u);m.forEach(function(a){var w=a.row,v=a.column;l[w+"#"+v]||(i.push(a),l[w+"#"+v]=!0)})}.bind(this)),i}};c.prototype.evaluate=function(){for(var n=e=0,i={5:0,4:0,3:0,2:0,1:0},t={5:0,4:0,3:0,2:0,1:0},s=0;s<this.count;s++){if(this.maxWin[s].max==5&&!this.maxWin[s].min)return c.MAX_VALUE;if(this.minWin[s].min==5&&!this.minWin[s].max)return c.MIN_VALUE;this.maxWin[s].max==4&&!this.maxWin[s].min&&i[4]++,this.minWin[s].min==4&&!this.minWin[s].max&&t[4]++,this.maxWin[s].max==3&&!this.maxWin[s].min&&i[3]++,this.minWin[s].min==3&&!this.minWin[s].max&&t[3]++,this.maxWin[s].max==2&&!this.maxWin[s].min&&i[2]++,this.minWin[s].min==2&&!this.minWin[s].max&&t[2]++,this.maxWin[s].max==1&&!this.maxWin[s].min&&i[1]++,this.minWin[s].min==1&&!this.minWin[s].max&&t[1]++}var n=i[4]*c.FOUR_W+i[3]*c.THREE_W+i[2]*c.TWO_W+i[1]*c.ONE_W,e=t[4]*c.FOUR_W+t[3]*c.THREE_W+t[2]*c.TWO_W+t[1]*c.ONE_W;return n-e};c.prototype.isMaxWin=function(){var i=this.evaluate();return i==c.MAX_VALUE};c.prototype.isMinWin=function(){var i=this.evaluate();return i==c.MIN_VALUE};c.prototype.end=function(){return this.is_ended=!0,this};c.prototype.isEnded=function(){return this.is_ended};c.prototype.max=function(i,t,s){var n,e,o=-1/0;if(t==0)return o=i.evaluate(),{w:o};var r=i.availableSteps();if(r.length){for(var h=0,l=r.length;h<l;h++){var u=r[h];if(i.put(u.row,u.column,c.MAX),i.isMaxWin()){o=c.MAX_VALUE,n=u.row,e=u.column,i.rollback();break}else{var m=c.prototype.min(i,t-1)||{w:i.evaluate()};if(i.rollback(),m.w>o&&(o=m.w,n=u.row,e=u.column),o>=s)break}}return{w:o,row:n,column:e}}};c.prototype.min=function(i,t,s){var n,e,o=1/0;if(t==0)return o=i.evaluate(),{w:o};var r=i.availableSteps();if(r.length){for(var h=0,l=r.length;h<l;h++){var u=r[h];if(i.put(u.row,u.column,c.MIN),i.isMinWin()){o=c.MIN_VALUE,n=u.row,e=u.column,i.rollback();break}else{var m=c.prototype.max(i,t-1,o)||{w:i.evaluate()};if(i.rollback(),m.w<o&&(o=m.w,n=u.row,e=u.column),o<=s)break}}return{w:o,row:n,column:e}}};c.NONE=0;c.MAX=1;c.MIN=2;c.FIVE_TYPE=1;c.FOUR_TYPE=3;c.THREE_TYPE=5;c.TWO_TYPE=7;c.MAX_VALUE=1e5;c.MIN_VALUE=-1e5;c.FOUR_W=5e3;c.THREE_W=1e3;c.TWO_W=200;c.ONE_W=10;const Mt=()=>k("div",{className:"num",children:rt(g).map(i=>k("div",{className:"item",children:g-i},i))});const Pt=()=>k("div",{className:"abc",children:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O"].map(i=>k("div",{className:"item",children:i},i))});var ct=new c(g,g);let _=new $({boardLength:g});const ns=({position:i,value:t,onClick:s,isLastChess:n,isMarkPoint:e,isWinnerPoint:o})=>{const r=_.stack.findIndex(h=>h[0]===i[0]&&h[1]===i[1]);return I("button",{className:`square ${n&&"lastChess"}`,onClick:s,children:[t!==$.EMPTY&&k("div",{className:["chess",t===_.firstHand?"black":"white",o?"pulse":""].join(" "),children:r+1||null}),e&&k("div",{className:"markPoint"})]})},es=({squares:i,onClick:t})=>{const s=_.lastChessPosition,n=_.winner?_.winnerPositions:null;return I("div",{className:"boardCenter",children:[k("div",{className:"rowLines",children:rt(g).map(e=>k("div",{className:"item"},e))}),k("div",{className:"colLines",children:rt(g).map(e=>k("div",{className:"item"},e))}),k("div",{className:"chesses",children:rt(g).map(e=>k("div",{className:"boardRow",children:rt(g).map(o=>k(ns,{position:[e,o],value:i[e][o],isLastChess:s&&s[0]===e&&s[1]===o,isWinnerPoint:n&&n.some(([r,h])=>r===e&&h===o),isMarkPoint:e===3&&o===3||e===3&&o===11||e===7&&o===7||e===11&&o===3||e===11&&o===11,onClick:()=>t(e,o)},o))},e))})]})},os=()=>{const[i,t]=pt.useState(!1),[s,n]=pt.useReducer(a=>a+1,0),{winner:e,isFinal:o,isDraw:r}=_,h=(a,w)=>{if(!i)return console.log({start:i});if(o)return console.log({isFinal:o});let v;if(window.test){console.time("b1");var d=c.prototype.min(ct,2);console.timeEnd("b1"),ct.put(d.row,d.column,c.MIN),v=_.minGo(d.row,d.column)}else v=_.minGo(a,w);v&&(n(),setTimeout(l,0))},l=()=>{const a=_.maxGo();n();const{i:w,j:v}=a;ct.put(w,v,c.MAX)},u=()=>{t(!1)},m=a=>{t(!0),_=new $({firstHand:a}),window.gobang=_,ct=new c(g,g),_.firstHand===$.MAX&&l(),n()};return e&&console.log(`${e===$.MAX?"bot":"human"} 胜出`),I("div",{className:"game",children:[I("div",{className:"gameBoard",children:[k(Mt,{}),I("div",{className:"center",children:[k(Pt,{}),k(es,{squares:_.node,onClick:Bt(h,50)}),k(Pt,{})]}),k(Mt,{})]}),I("div",{className:"opbtns",children:[i&&k("button",{onClick:u,children:"重来"}),!i&&k("button",{onClick:()=>m($.MAX),children:"开始 - 电脑先"}),!i&&k("button",{onClick:()=>m($.MIN),children:"开始 - 玩家先"}),i&&k("button",{onClick:()=>{_.minRepent(),n()},children:"悔棋"})]}),I("div",{className:"game-info",children:[k("div",{children:o&&"game over"}),k("div",{children:e&&`${e===$.MAX?"少侠请努力":"干得漂亮"}`}),k("div",{children:r&&"和棋~"}),k("ol",{})]})]})},ls=os;Xt.createRoot(document.getElementById("root")).render(k(ls,{}));
