var mt=Object.defineProperty;var At=(l,t,s)=>t in l?mt(l,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[t]=s;var j=(l,t,s)=>(At(l,typeof t!="symbol"?t+"":t,s),s);import{j as $,r as gt,a as R,c as pt}from"./vendor-cd7d93c1.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(e){if(e.ep)return;e.ep=!0;const n=s(e);fetch(e.href,n)}})();const J=$.Fragment,m=$.jsx,U=$.jsxs,Y=0,x=1,v=2,G=3,g=15,V=g/2>>0,W=(l,t=void 0,s=!1)=>(typeof t=="object"&&!s&&console.error(`
    val 为"引用类型"时, 请明确传递参数 yesHereIsObjectVal
    另外: 对于"引用类型", arrayN 使用 structuredClone 处理 val, 防止多个变量指向相同引用`),Array(l).fill().map(()=>structuredClone(t))),bt=(l,t=20)=>{let s=+new Date;return(...i)=>{+new Date-s>t&&l(...i),s=+new Date}},kt=l=>t=>Array(t-l).fill(null).map((s,i)=>l+i),X=kt(0),dt={l1:2**0,d2:2**3,l2:2**6,d3:2**9,l3:2**12,d4:2**14,l4:2**16,l5:2**18},Z=l=>({l1:l&7,d2:l>>3&7,l2:l>>6&7,d3:l>>9&7,l3:l>>12&3,d4:l>>14&3,l4:l>>16&3,l5:l>>18&3});console.log("getPointMode");const f={l1:1,d2:2,l2:8,d3:12,l3:30,d4:50,l4:500,l5:1e3,win:1e4};console.log("getPoinScoretMode");const tt=l=>{const{l5:t,l4:s,d4:i,l3:e,d3:n,l2:o,d2:r,l1:h}=l;let d=0;return t&&(d+=f.l5*t),s&&(d+=f.l4*s),i&&(d+=f.d4*i),e&&(d+=f.l3*e),n&&(d+=f.d3*n),o&&(d+=f.l2*o),r&&(d+=f.d2*r),h&&(d+=f.l1*h),d};console.log("calcEvaPointScore");console.warn("todo: 测试 countLine 是否正确");const ut=(l,t,s)=>i=>{let e=1;for(let n=0;n<4;n++){const o=i[n];e<<=1,o===l?e|=1:(o===t||o===s)&&(e=1)}e=e<<1|1;for(let n=5;n<9;n++){const o=i[n];if(o===t||o===s)break;e<<=1,o===l&&(e|=1)}return e};console.log("countLine");const St=l=>Array.from({length:1<<l+1},(t,s)=>`0b${s.toString(2)}`),_=St(12);console.log(_.length);_.forEach(l=>null);const H=[],qt={l1:l=>/010/.test(l)&&l.length>5,d2:l=>/10{0,1}1/.test(l)&&l.length>=5,l2:l=>[/000110/,/001100/,/011000/,/001010/,/010100/].some(t=>t.test(l)),d3:l=>[/111/,/1011/,/1101/,/11001/,/10011/,/10101/].some(t=>t.test(l))&&l.length>=5,l3:l=>[/010110/,/011010/,/01110/,/1010101/].some(t=>t.test(l)),d4:l=>[/11110/,/01111/,/11011/,/11101/,/10111/].some(t=>t.test(l)),l4:l=>[/011110/,/1011101/,/11011011/,/111010111/].some(t=>t.test(l)),l5:l=>/1{5}/.test(l)};for(const[l,t]of Object.entries(qt))_.forEach(s=>{t(s.slice(3))&&(H[+s]=dt[l])});console.log("allModes.forEach");class Mt{constructor({size:t,randFn:s}){s||(s=()=>gt.int(0,2**31)),this.max=W(t).map(i=>W(t).map(s)),this.min=W(t).map(i=>W(t).map(s)),this.code=s(),this.hash={}}go(t,s,i){this.code^=i?this.max[t][s]:this.min[t][s]}get(){return this.hash[this.code]}set(t){this.hash[this.code]=t}resetHash(){this.hash={}}}const{l1:st,d2:et,l2:it,d3:nt,l3:ot,d4:lt,l4:rt,l5:at}=dt;function wt(l,t){const s=this.winner;if(s===x)return f.win;if(s===v)return-f.win;if(l)return 0;let i=0,e=0,n=0,o=0,r=0,h=0,d=0,p=0,a=0,b=0,M=0,L=0,S=0,k=0,u=0,w=0;const E=(c,q)=>{if(q<34)return;const D=this.serialPointMode[q];if(D)if(c===x)switch(D){case st:return p++;case et:return d++;case it:return h++;case nt:return r++;case ot:return o++;case lt:return n++;case rt:return e++;case at:return i++;default:return console.error("error")}else switch(D){case st:return w++;case et:return u++;case it:return k++;case nt:return S++;case ot:return L++;case lt:return M++;case rt:return b++;case at:return a++;default:return console.error("error")}},F=(c,q,D)=>{if(D===0)return;let P=1,B=0,T=!1;for(let O=0;O<15;O++){const K=D&3;if(D>>=2,K===q||K===G){E(c,P),P=1,T=!0;continue}else if(K===Y)if(B===0)B++,P<<=1;else{P<<=1,(D&12)===Y&&O!==14&&(P<<=1),E(c,P),P=4,(D&12)===Y&&O!==14&&(P<<=1),B=0,T=!0;continue}else B=0,T=!1,P=(P<<1)+1}T||E(c,P)};for(let c=0;c<this.node0.length;c++)F(x,v,this.node0[c]);for(let c=0;c<this.node1.length;c++)F(x,v,this.node1[c]);for(let c=0;c<this.node2.length;c++)F(x,v,this.node2[c]);for(let c=0;c<this.node3.length;c++)F(x,v,this.node3[c]);for(let c=0;c<this.node0.length;c++)F(v,x,this.node0[c]);for(let c=0;c<this.node1.length;c++)F(v,x,this.node1[c]);for(let c=0;c<this.node2.length;c++)F(v,x,this.node2[c]);for(let c=0;c<this.node3.length;c++)F(v,x,this.node3[c]);t&&(console.log({maxL1:p,maxD2:d,maxL2:h,maxD3:r,maxL3:o,maxD4:n,maxL4:e,maxL5:i}),console.log({minL1:w,minD2:u,minL2:k,minD3:S,minL3:L,minD4:M,minL4:b,minL5:a}));let I=0,y=0;if((this.seekDepth&1)===0){if(e)return f.l5*2;if(n)return f.l5*3;if(b)return-f.l5;if(M>1||L>1||L&&M)return-f.l5*3;o&&!b&&!M&&(I+=f.l4)}else{if(b||M)return-f.l5;if(e)return f.l5;if(n>1||o>1||o&&n)return-f.l5*2;L&&!e&&!n&&(y+=f.l4)}return I=f.l5*i+f.l4*e+f.d4*n+f.l3*o+f.d3*r+f.l2*h+f.d2*d+f.l1*d,y=f.l5*a+f.l4*b+f.d4*M+f.l3*L+f.d3*S+f.l2*k+f.d2*u+f.l1*u,I*this.attackFactor-y*(this.firstHand===v?this.defenseFactor:1)}function xt(l,t,s){let i=[],e=[],n=[],o=[],r=[],h=[],d=[],p=[],a=[],b=[],M=[],L=[];for(let k=0;k<l.length;k++){const u=l[k],[w,E]=u;let F=0,I=0,y=Z(this.maxPointsScore[w][E][0]);{const C=Z(this.maxPointsScore[w][E][1]),c=Z(this.maxPointsScore[w][E][2]),q=Z(this.maxPointsScore[w][E][3]);y.l5+=C.l5+c.l5+q.l5,y.l4+=C.l4+c.l4+q.l4,y.d4+=C.d4+c.d4+q.d4,y.l3+=C.l3+c.l3+q.l3,y.d3+=C.d3+c.d3+q.d3,y.l2+=C.l2+c.l2+q.l2,y.d2+=C.d2+c.d2+q.d2,y.l1+=C.l1+c.l1+q.l1;const{l5:D,l4:P,d4:B,l3:T}=y;D?i.push(u):P?n.push(u):(B>1&&p.push(u),T&&B&&a.push(u),T>1&&M.push(u),T&&d.push(u),B&&r.push(u)),F=tt(y)}let z=Z(this.minPointsScore[w][E][0]);{const C=Z(this.minPointsScore[w][E][1]),c=Z(this.minPointsScore[w][E][2]),q=Z(this.minPointsScore[w][E][3]);z.l5+=C.l5+c.l5+q.l5,z.l4+=C.l4+c.l4+q.l4,z.d4+=C.d4+c.d4+q.d4,z.l3+=C.l3+c.l3+q.l3,z.d3+=C.d3+c.d3+q.d3,z.l2+=C.l2+c.l2+q.l2,z.d2+=C.d2+c.d2+q.d2,z.l1+=C.l1+c.l1+q.l1;const{l5:D,l4:P,d4:B,l3:T}=z;D?e.push(u):P?o.push(u):(T&&B&&b.push(u),B&&h.push(u)),I=tt(z)}L.push({position:[w,E],score:F*this.attackFactor+I*this.defenseFactor})}let S;if(s)return t?i.length?i:e.length?e:n.length?n:p.length?p:o.length||b.length?a.concat(r):a.concat(M).concat(r).concat(d):i.length?i:n.length||a.length?h.concat(n).concat(a).concat(r):L.sort((k,u)=>u.score-k.score).map(k=>k.position);if(t){if(i.length)return i;if(e.length)return e;if(n.length)return n;if(a.length&&!o.length&&!h.length)return a;if(!r.length&&o.length)return o.concat(h)}else{if(e.length)return e;if(i.length)return i;if(o.length)return o;if(b.length&&!n.length&&!r.length)return b;if(!h.length&&n.length)return n.concat(r)}return S=L.sort((k,u)=>u.score-k.score).map(k=>k.position),S.length<=this.genLimit?S:S.slice(0,this.genLimit)}const Et=ut(x,v,G),Ct=ut(v,x,G);class Q{constructor(t){j(this,"genChilds",xt);j(this,"evaluate",wt);j(this,"serialPointMode",H);this.init({...t})}init({firstHand:t,autoPlay:s,enableStats:i,attackFactor:e,defenseFactor:n}){this.node0=[],this.node1=[],this.node2=[],this.node3=[],this.initNode(),this.stack=[],this.zobrist=new Mt({size:g}),this.maxPointsScore=W(g).map(()=>W(g,[0,0,0,0],!0)),this.minPointsScore=W(g).map(()=>W(g,[0,0,0,0],!0)),this.stats={},this.initStats(),this.enableStats=i!==void 0?i:!0,this.enableLog=!1,this.firstHand=t||v,this.genLimit=20,this.seekDepth=8,this.seekKillDepth=21,this.autoPlay=s||!1,this.attackFactor=e||1,this.defenseFactor=n||1,this.timeLimit=3e3}maxGo(){if(this.isFinal)return;console.log(Object.keys(this.zobrist.hash).length),this.initStats();const t=this.getMaxNextStep(),{i:s,j:i,score:e}=t;return this.put(s,i,x),this.logStats(),console.log({score:this.evaluate(),score2:e}),t}getMaxNextStep(){let t=this.genChilds(this.getAllOptimalNextStep(),!0);if(t=t.map(i=>({i:i[0],j:i[1]})),console.log({points:t}),t.length===1)return t[0];const s=this.seekKill();if(s)return s;this.startTime=+new Date,console.time("thinking");for(let i=2;i<=this.seekDepth&&(this.zobrist.resetHash(),!(+new Date-this.startTime>this.timeLimit));i+=2){for(let e=0;e<t.length;e++){let n=t[e];const{i:o,j:r}=n;this.put(o,r,x);const h=this.minimax(i-1,!1);this.rollback(),h.score!==-1/0&&(n.score=h.score,n.depth=i,n.stack=h.stack)}t=t.sort((e,n)=>n.score-e.score),console.log(i,t)}return console.timeEnd("thinking"),t[0]}seekKill(){if(this.stack.length>4){this.startTime=+new Date,console.time("thinking kill");for(let t=3;t<=this.seekKillDepth&&(this.zobrist.resetHash(),!(+new Date-this.startTime>this.timeLimit));t+=2){const s=this.minimax(t,!0,!0);if((s==null?void 0:s.score)>=f.win)return console.warn("算杀成功 :)",s),this.logStats(),console.timeEnd("thinking kill"),s}console.timeEnd("thinking kill")}}minGo(t,s){if(!this.isFinal)return this.isEmptyPosition(t,s)?(this.put(t,s,v),console.log({score:this.evaluate()}),!0):!1}minimax(t,s=!0,i=!1,e=-1/0,n=1/0){if(this.isFinal||t===0)return{score:this.evaluate(i),depth:t,stack:structuredClone(this.stack)};const o=this.genChilds(this.getAllOptimalNextStep(),s,i);if(s){if(o.length===0)return{score:-.1};let r=-1/0,h=o[0],d;for(const b of o){if(+new Date-this.startTime>this.timeLimit)break;const[M,L]=b;this.put(M,L,x),this.enableStats&&this.stats.abCut.eva++;let S=this.zobrist.get(),k;if(S===void 0){const u=this.minimax(t-1,!s,i,e,n);S=u.score,k=u.stack,this.zobrist.set(S),this.enableStats&&this.stats.zobrist.miss++}else this.enableStats&&this.stats.zobrist.hit++;if(this.rollback(),S>r&&(r=S,h=b,d=k),e=Math.max(e,r),n<=e){this.enableStats&&this.stats.abCut.cut++;break}}const[p,a]=h;return{score:r,i:p,j:a,stack:d}}else{if(o.length===0)return{score:.2};let r=1/0,h=o[0],d;for(const b of o){if(+new Date-this.startTime>this.timeLimit){r=-1/0;break}const[M,L]=b;this.put(M,L,v),this.enableStats&&this.stats.abCut.eva++;let S=this.zobrist.get(),k;if(S===void 0){const u=this.minimax(t-1,!s,i,e,n);S=u.score,k=u.stack,this.zobrist.set(S),this.enableStats&&this.stats.zobrist.miss++}else this.enableStats&&this.stats.zobrist.hit++;if(this.rollback(),S<r&&(r=S,h=b,d=k),n=Math.min(n,r),n<=e){this.enableStats&&this.stats.abCut.cut++;break}}const[p,a]=h;return{score:r,i:p,j:a,stack:d}}}isWall(t,s){return t<0||t>=g||s<0||s>=g}initNode(){this.node0=W(g,0),this.node1=W(g,0),this.node2=[];for(let t=0;t<g*2-1;t++){let s=0;for(let i=0;i<15;i++){const e=t-i;s<<=2,this.isWall(i,e)&&(s+=3)}this.node2[t]=s}this.node3=[];for(let t=0;t<g*2-1;t++){let s=0;for(let i=0;i<15;i++){const e=14+i-t;s<<=2,this.isWall(i,e)&&(s+=3)}this.node3[t]=s}}put(t,s,i){this.zobrist.go(t,s,i===x),this.stack.push([t,s]),this.node0[t]=this.node0[t]|i<<2*(14-s),this.node1[s]=this.node1[s]|i<<2*(14-t),this.node2[t+s]=this.node2[t+s]|i<<2*(14-t),this.node3[14+t-s]=this.node3[14+t-s]|i<<2*(14-t),this.updateFourLineScore(t,s)}rollback(t=1){if(!(this.stack.length<t))for(;t-- >0;){const[s,i]=this.stack.pop();this.zobrist.go(s,i,this.getChess(s,i)===x);const e=2*(14-i);this.node0[s]=(this.node0[s]|3<<e)^3<<e;const n=2*(14-s);this.node1[i]=(this.node1[i]|3<<n)^3<<n,this.node2[s+i]=(this.node2[s+i]|3<<n)^3<<n,this.node3[14+s-i]=(this.node3[14+s-i]|3<<n)^3<<n,this.updateFourLineScore(s,i)}}minRepent(){this.stack.length>=2&&this.rollback(2)}isEmptyPosition(t,s){return!this.isWall(t,s)&&this.getChess(t,s)===Y}getNearPositions(t){const s=[],[e,n]=t;for(let o=-2;o<=2;o++)for(let r=-2;r<=2;r++)this.isEmptyPosition(o+e,r+n)&&s.push([o+e,r+n]);return s}getAllOptimalNextStep(){if(this.stack.length===0)return[[V,V]];if(this.stack.length===1){if(this.isEmptyPosition(V,V))return[[V,V]];const s=V+(Math.random()>.5?1:-1),i=V+(Math.random()>.5?1:-1);return[[s,i]]}let t=[];for(let s=0;s<g;s++)for(let i=0;i<g;i++)this.getChess(s,i)===Y&&this.haveNeighbor(s,i)&&t.push([s,i]);return t}haveNeighbor(t,s){for(let e=-2;e<=2;e++)if(!(e+t<0||e+t>=g))for(let n=-2;n<=2;n++){if(n+s<0||n+s>=g||e===0&&n===0)continue;if(this.getChess(e+t,s+n)!==Y)return!0}return!1}getChess(t,s){return this.node0[t]>>2*(14-s)&3}getChessInFourDirection(t,s,i){if(i===0){const e=this.node0[t],n=s>=4?e>>2*(18-s)&3:3,o=s>=3?e>>2*(17-s)&3:3,r=s>=2?e>>2*(16-s)&3:3,h=s>=1?e>>2*(15-s)&3:3,d=e>>2*(14-s)&3,p=s<=13?e>>2*(13-s)&3:3,a=s<=12?e>>2*(12-s)&3:3,b=s<=11?e>>2*(11-s)&3:3,M=s<=10?e>>2*(10-s)&3:3;return[n,o,r,h,d,p,a,b,M]}else{let e;i===1?e=this.node1[s]:i===2?e=this.node2[t+s]:i===3&&(e=this.node3[14+t-s]);const n=t>=4?e>>2*(18-t)&3:3,o=t>=3?e>>2*(17-t)&3:3,r=t>=2?e>>2*(16-t)&3:3,h=t>=1?e>>2*(15-t)&3:3,d=e>>2*(14-t)&3,p=t<=13?e>>2*(13-t)&3:3,a=t<=12?e>>2*(12-t)&3:3,b=t<=11?e>>2*(11-t)&3:3,M=t<=10?e>>2*(10-t)&3:3;return[n,o,r,h,d,p,a,b,M]}}getPositionsInFourDirection(t,s){let i=[],e=[],n=[],o=[];const r=t-4>0?t-4:0,h=t+4<g-1?t+4:g-1,d=s-4>0?s-4:0,p=s+4<g-1?s+4:g-1;for(let a=d;a<=p;a++)i.push([t,a]);for(let a=r;a<=h;a++)e.push([a,s]);for(let a=4;a>0;a--)t-a>=r&&s+a<=p&&n.push([t-a,s+a]);n.push([t,s]);for(let a=1;a<=4;a++)t+a<=h&&s-a>=d&&n.push([t+a,s-a]);for(let a=4;a>0;a--)t-a>=r&&s-a>=d&&o.push([t-a,s-a]);o.push([t,s]);for(let a=1;a<=4;a++)t+a<=h&&s+a<=p&&o.push([t+a,s+a]);return[i,e,n,o]}updateFourLineScore(t,s){const i=this.getPositionsInFourDirection(t,s);for(let e=0;e<4;e++){const n=i[e];for(let o=0;o<n.length;o++){const r=n[o];this.updatePointScore(r,e)}}}updatePointScore(t,s){const[i,e]=t;if(this.getChess(i,e)!==Y)this.maxPointsScore[i][e]=[0,0,0,0],this.minPointsScore[i][e]=[0,0,0,0];else{const n=this.getChessInFourDirection(i,e,s);this.maxPointsScore[i][e][s]=H[Et(n)]||0,this.minPointsScore[i][e][s]=H[Ct(n)]||0}}saveStack(){console.log(JSON.stringify(this.stack))}restoreStack(t){const s=this.firstHand,i=s===x?v:x;this.rollback(this.stack.length);for(let e=0;e<t.length;e++){const[n,o]=t[e],r=e%2===0?s:i;this.put(n,o,r)}}test(t){console.log(Function(t).call(this))}get winner(){if(this.stack.length<7)return null;const[t,s]=this.stack[this.stack.length-1],i=this.getChess(t,s),e=[this.getChessInFourDirection(t,s,0),this.getChessInFourDirection(t,s,1),this.getChessInFourDirection(t,s,2),this.getChessInFourDirection(t,s,3)];for(let n=0;n<4;n++){let o=0;const r=e[n];for(let h=0;h<r.length;h++)if(r[h]===i?o++:o=0,o===5)return i}return null}get winnerPositions(){if(!this.winner)return null;const[t,s]=this.stack[this.stack.length-1],i=this.getChess(t,s),e=this.getPositionsInFourDirection(t,s);for(let n=0;n<4;n++){const o=e[n];let r=0,h=[];for(let d=0;d<o.length;d++){const[p,a]=o[d];if(this.getChess(p,a)===i?(r++,h.push([p,a])):(r=0,h=[]),r===5)return h}}return null}get isFinal(){return!!this.winner||this.isBoardFull}get isBoardFull(){return this.stack.length===g**2}get lastChessPosition(){return this.stack.length?this.stack[this.stack.length-1]:null}get isDraw(){return this.isBoardFull&&!this.winner}get node(){return this.node0.map(t=>{let s=[];for(let i=0;i<g;i++)s.push((t&3<<2*i)>>2*i);return s.reverse()})}printNode(){console.log(this.node0.map(t=>t.toString(2))),console.log(this.node1.map(t=>t.toString(2))),console.log(this.node2.map(t=>t.toString(2))),console.log(this.node3.map(t=>t.toString(2)))}initStats(){this.stats={abCut:{all:this.genLimit**this.seekDepth,eva:0,cut:0,toString(){const{all:t,eva:s,cut:i}=this.stats.abCut,e=t-s;return`AB剪枝 最大节点总数:${t} 理论最少评估${t**.5>>0} 实际评估:${s} 剪去:${i}/${e}`}},zobrist:{miss:0,hit:0,toString(){const{hit:t,miss:s}=this.stats.zobrist;return`zobrist 评估节点数:${this.stats.abCut.eva} hit:${t} miss:${s}`}}}}logStats(){this.enableStats&&Object.keys(this.stats).forEach(t=>{console.log(this.stats[t].toString.call(this))})}}j(Q,"MAX",x),j(Q,"MIN",v),j(Q,"EMPTY",Y),j(Q,"WALL",G);const ct=()=>m("div",{className:"num",children:X(g).map(l=>m("div",{className:"item",children:l},l))});const ht=()=>m("div",{className:"abc",children:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O"].map((l,t)=>m("div",{className:"item",children:t},l))}),Lt=()=>{const[l,t]=R.useState(0);return R.useEffect(()=>{const s=setInterval(()=>{t(i=>i+.2)},200);return()=>clearInterval(s)},[]),m("div",{className:"",children:l.toFixed(1)})};function ft(){return new Worker("/gobang/dist/assets/worker-a8c95e52.js")}const vt="data:audio/mpeg;base64,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",yt="/gobang/dist/assets/win-716cbc65.mp3",Ft="/gobang/dist/assets/fail-c60229d9.mp3",Pt="/gobang/dist/assets/draw-304f12b1.mp3",Dt={fall:vt,win:yt,fail:Ft,draw:Pt},Nt=({musics:l,onEnded:t})=>m(J,{children:l.map(s=>m("video",{src:Dt[s.value],onEnded:()=>t(s.id),autoPlay:!0,hidden:!0},s.id))});let A,N=new ft;window.test=l=>N.postMessage({type:"test",data:l});const zt=({position:l,value:t,onClick:s,isLastChess:i,isMarkPoint:e,isWinnerPoint:n})=>{const o=A.stack.findIndex(r=>r[0]===l[0]&&r[1]===l[1]);return U("button",{className:`square ${i&&"lastChess"}`,onClick:s,children:[t!==Q.EMPTY&&m("div",{className:["chess",t===A.firstHand?"black":"white",n?"pulse":""].join(" "),children:o+1||null}),e&&m("div",{className:"markPoint"})]})},Bt=({squares:l,onClick:t})=>{const s=A.lastChessPosition,i=A.winner,e=i?A.winnerPositions:null;return U("div",{className:"boardCenter",children:[m("div",{className:"rowLines",children:X(g).map(n=>m("div",{className:"item"},n))}),m("div",{className:"colLines",children:X(g).map(n=>m("div",{className:"item"},n))}),m("div",{className:"chesses",children:X(g).map(n=>m("div",{className:"boardRow",children:X(g).map(o=>m(zt,{position:[n,o],value:l[n][o],isLastChess:s&&s[0]===n&&s[1]===o,isWinnerPoint:e&&e.some(([r,h])=>r===n&&h===o),isMarkPoint:n===3&&o===3||n===3&&o===11||n===7&&o===7||n===11&&o===3||n===11&&o===11,onClick:()=>t(n,o)},o))},n))}),U("div",{className:"gameoverTip",children:[A.isDraw&&m("div",{className:"tip",children:"和棋~"}),i&&m("div",{className:"tip",children:i===A.firstHand?"黑方胜":"白方胜"})]})]})},Ut=()=>{const[l,t]=R.useState(!1),[s,i]=R.useReducer(u=>u+1,0),[e,n]=R.useState(!1),[o,r]=R.useState(!1),[h,d]=R.useReducer((u,w)=>{const{type:E,value:F,id:I}=w;return E==="add"?[...u,{id:+new Date+Math.random(),value:F}]:E==="remove"?u.filter(y=>y.id!==I):[]},[]),p=A==null?void 0:A.isFinal,a=(u,w)=>{if(!l)return console.log({start:l});if(p)return console.log({isFinal:p});if(e)return console.log({thinking:e});if(o)return console.log({autoPlay:o});N.postMessage({type:"minGo",data:[u,w]})},b=()=>{n(!0),N.postMessage({type:"maxGo"})},M=()=>{N.terminate(),N=new ft,N.postMessage({type:"init",data:{}}),t(!1),r(!1)},L=(u,w)=>{t(!0),r(w),N.postMessage({type:"init",data:{firstHand:u,autoPlay:w,seekDepth:4}})},S=()=>{r(!0),N.postMessage({type:"init",data:{firstHand:Q.MAX,autoPlay:!0,seekDepth:4}})},k=()=>{N.postMessage({type:"minRepent"})};return R.useEffect(()=>{N.onmessage=u=>{const{type:w,gobang:E,data:F}=u.data;switch(A=JSON.parse(E),w){case"init":A.firstHand===Q.MAX&&!A.autoPlay?b():i();break;case"minGo":F&&(d({type:"add",value:"fall"}),b());break;case"maxGo":d({type:"add",value:"fall"}),n(!1);break;case"autoPlay":d({type:"add",value:"fall"});break;default:i();break}}},[N]),R.useEffect(()=>{A!=null&&A.isDraw&&d({type:"add",value:"draw"}),A!=null&&A.winner&&d({type:"add",value:A.winner===Q.MAX?"fail":"win"})},[A==null?void 0:A.winner,A==null?void 0:A.isDraw]),R.useEffect(()=>N.postMessage({type:"new Gobang"}),[]),A&&U("div",{className:"game",children:[m(Nt,{musics:h,onEnded:u=>d({type:"remove",id:u})}),U("div",{className:"gameInfo",children:[m(Lt,{}),m("div",{className:""})]}),U("div",{className:"gameBoard",children:[m(ct,{}),U("div",{className:"center",children:[m(ht,{}),m(Bt,{squares:A.node,onClick:bt(a,20)}),m(ht,{})]}),m(ct,{})]}),U("div",{className:"opbtns",children:[o&&m("button",{onClick:M,children:"开始游戏"}),!o&&!l&&U(J,{children:[m("button",{onClick:()=>L(Q.MAX),children:"电脑先手"}),m("button",{onClick:()=>L(Q.MIN),children:"玩家先手"}),m("button",{onClick:S,children:"电脑vs电脑"})]}),l&&U(J,{children:[m("button",{onClick:M,children:"重来"}),m("button",{onClick:k,children:"悔棋"})]})]}),U("div",{className:"game-info",children:[A.winner&&m("div",{children:A.winner===Q.MAX?"少侠请努力":"干得漂亮"}),m("ol",{})]})]})},Qt=Ut;pt.createRoot(document.getElementById("root")).render(m(Qt,{}));
