var mt=Object.defineProperty;var At=(o,t,s)=>t in o?mt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s;var O=(o,t,s)=>(At(o,typeof t!="symbol"?t+"":t,s),s);import{j as _,r as gt,a as j,c as bt}from"./vendor-cd7d93c1.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&e(l)}).observe(document,{childList:!0,subtree:!0});function s(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(i){if(i.ep)return;i.ep=!0;const n=s(i);fetch(i.href,n)}})();const $=_.Fragment,m=_.jsx,Q=_.jsxs,H=0,v=1,x=2,I=3,k=15,Y=k/2>>0,W=(o,t=void 0,s=!1)=>(typeof t=="object"&&!s&&console.error(`
    val 为"引用类型"时, 请明确传递参数 yesHereIsObjectVal
    另外: 对于"引用类型", arrayN 使用 structuredClone 处理 val, 防止多个变量指向相同引用`),Array(o).fill().map(()=>structuredClone(t))),pt=(o,t=20)=>{let s=+new Date;return(...e)=>{+new Date-s>t&&o(...e),s=+new Date}},kt=o=>t=>Array(t-o).fill(null).map((s,e)=>o+e),K=kt(0),ut={l1:2**0,d2:2**3,l2:2**6,l2x2:2**7,d3:2**9,l3:2**12,d4:2**14,l4:2**16,l5:2**18},X=o=>({l1:o&7,d2:(o&56)>>3,l2:(o&960)>>6,d3:(o&7680)>>9,l3:(o&12288)>>12,d4:(o&49152)>>14,l4:(o&196608)>>16,l5:(o&786432)>>18}),f={l1:1,d2:2,d3:3,l2:8,l2x2:16,l3:30,d4:50,l4:500,l5:1e3,win:1e4},tt=o=>{const{l5:t,l4:s,d4:e,l3:i,d3:n,l2:l,d2:c,l1:r}=o;let d=0;return t&&(d+=f.l5*t),s&&(d+=f.l4*s),e&&(d+=f.d4*e),i&&(d+=f.l3*i),n&&(d+=f.d3*n),l&&(d+=f.l2*l),c&&(d+=f.d2*c),r&&(d+=f.l1*r),d};console.warn("todo: 测试 countLine 是否正确");const St=(o,t,s)=>e=>{let i=1;for(let n=0;n<e.length;n++){const l=e[n];if(n<4)i<<=1,l===o?i+=1:(l===t||l===s)&&(i=1);else if(n===4)i<<=1,i+=1;else{if(l===t||l===s)break;i<<=1,l===o&&(i+=1)}}return i},qt=o=>{let t=[],s=2**(o+1);for(;s-- >0;)t.push("0b"+s.toString(2));return t},V=qt(12),wt=o=>/010/.test(o)&&o.length>5,vt=o=>/10{0,1}1/.test(o)&&o.length>=5,Mt=o=>[/000110/,/001100/,/011000/,/001010/,/010100/].some(t=>t.test(o)),Et=o=>/0101010/.test(o),Lt=o=>[/111/,/1011/,/1101/,/11001/,/10011/,/10101/].some(t=>t.test(o))&&o.length>=5,Ct=o=>[/010110/,/011010/,/01110/,/1010101/].some(t=>t.test(o)),xt=o=>[/11110/,/01111/,/11011/,/11101/,/10111/].some(t=>t.test(o)),Ft=o=>[/011110/,/1011101/,/11011011/,/111010111/].some(t=>t.test(o)),yt=o=>/1{5}/.test(o),T=[],{l5:Pt,l4:Dt,d4:Nt,l3:zt,d3:Bt,l2:Ut,l2x2:Qt,d2:Tt,l1:Rt}=ut;V.forEach(o=>wt(o.slice(3))&&"l1"&&(T[+o]=Rt));V.forEach(o=>vt(o.slice(3))&&"d2"&&(T[+o]=Tt));V.forEach(o=>Mt(o.slice(3))&&"l2"&&(T[+o]=Ut));V.forEach(o=>Lt(o.slice(3))&&"d3"&&(T[+o]=Bt));V.forEach(o=>Et(o.slice(3))&&"l2x2"&&(T[+o]=Qt));V.forEach(o=>Ct(o.slice(3))&&"l3"&&(T[+o]=zt));V.forEach(o=>xt(o.slice(3))&&"d4"&&(T[+o]=Nt));V.forEach(o=>Ft(o.slice(3))&&"l4"&&(T[+o]=Dt));V.forEach(o=>yt(o.slice(3))&&"l5"&&(T[+o]=Pt));class Wt{constructor({size:t,randFn:s}){s||(s=()=>gt.int(0,2**31)),this.max=W(t).map(e=>W(t).map(s)),this.min=W(t).map(e=>W(t).map(s)),this.code=s(),this.hash={}}go(t,s,e){this.code^=e?this.max[t][s]:this.min[t][s]}get(){return this.hash[this.code]}set(t){this.hash[this.code]=t}resetHash(){this.hash={}}}const{l1:st,d2:et,l2:it,l2x2:nt,d3:ot,l3:lt,d4:rt,l4:at,l5:ct}=ut;function jt(o,t){const s=this.winner;if(s===v)return f.win;if(s===x)return-f.win;if(o)return 0;let e=0,i=0,n=0,l=0,c=0,r=0,d=0,g=0,a=0,p=0,S=0,q=0,b=0,A=0,u=0,M=0;const L=(h,w)=>{if(t&&console.log("piece",w.toString(2)),w<34)return;const D=T[w];if(D)if(t&&console.warn(D.toString(2)),h===v)switch(D){case st:return g++;case et:return d++;case it:return r++;case nt:return r+=2;case ot:return c++;case lt:return l++;case rt:return n++;case at:return i++;case ct:return e++;default:return console.error("error")}else switch(D){case st:return M++;case et:return u++;case it:return A++;case nt:return A+=2;case ot:return b++;case lt:return q++;case rt:return S++;case at:return p++;case ct:return a++;default:return console.error("error")}},y=(h,w,D)=>{let P=1,B=0,R=!1;for(let G=0;G<15;G++){const J=D&3;if(D>>=2,J===w||J===I){L(h,P),P=1,R=!0;continue}else if(J===H)if(B===0)B++,P<<=1;else{P<<=1,(D&12)===H&&G!==14&&(P<<=1),L(h,P),P=4,(D&12)===H&&G!==14&&(P<<=1),B=0,R=!0;continue}else B=0,R=!1,P<<=1,P+=1}R||L(h,P)};for(let h=0;h<this.node0.length;h++)y(v,x,this.node0[h]);for(let h=0;h<this.node1.length;h++)y(v,x,this.node1[h]);for(let h=0;h<this.node2.length;h++)y(v,x,this.node2[h]);for(let h=0;h<this.node3.length;h++)y(v,x,this.node3[h]);for(let h=0;h<this.node0.length;h++)y(x,v,this.node0[h]);for(let h=0;h<this.node1.length;h++)y(x,v,this.node1[h]);for(let h=0;h<this.node2.length;h++)y(x,v,this.node2[h]);for(let h=0;h<this.node3.length;h++)y(x,v,this.node3[h]);t&&(console.log({maxL1:g,maxD2:d,maxL2:r,maxD3:c,maxL3:l,maxD4:n,maxL4:i,maxL5:e}),console.log({minL1:M,minD2:u,minL2:A,minD3:b,minL3:q,minD4:S,minL4:p,minL5:a}));let Z=0,F=0;if((this.seekDepth&1)===0){if(i)return f.l5*2;if(n)return f.l5*3;if(p)return-f.l5;if(S>1||q>1||q&&S)return-f.l5*3;l&&!p&&!S&&(Z+=f.l4)}else{if(p||S)return-f.l5;if(i)return f.l5;if(n>1||l>1||l&&n)return-f.l5*2;q&&!i&&!n&&(F+=f.l4)}return Z=f.l5*e+f.l4*i+f.d4*n+f.l3*l+f.d3*c+f.l2*r+f.d2*d+f.l1*d,F=f.l5*a+f.l4*p+f.d4*S+f.l3*q+f.d3*b+f.l2*A+f.d2*u+f.l1*u,Z*this.attackFactor-F*(this.firstHand===x?this.defenseFactor:1)}function Vt(o,t,s){let e=[],i=[],n=[],l=[],c=[],r=[],d=[],g=[],a=[],p=[],S=[],q=[];for(let A=0;A<o.length;A++){const u=o[A],[M,L]=u;let y=0,Z=0,F=X(this.maxPointsScore[M][L][0]);{const C=X(this.maxPointsScore[M][L][1]),h=X(this.maxPointsScore[M][L][2]),w=X(this.maxPointsScore[M][L][3]);F.l5+=C.l5+h.l5+w.l5,F.l4+=C.l4+h.l4+w.l4,F.d4+=C.d4+h.d4+w.d4,F.l3+=C.l3+h.l3+w.l3,F.d3+=C.d3+h.d3+w.d3,F.l2+=C.l2+h.l2+w.l2,F.d2+=C.d2+h.d2+w.d2,F.l1+=C.l1+h.l1+w.l1;const{l5:D,l4:P,d4:B,l3:R}=F;D?e.push(u):P?n.push(u):(B>1&&g.push(u),R&&B&&a.push(u),R>1&&S.push(u),R&&d.push(u),B&&c.push(u)),y=tt(F)}let z=X(this.minPointsScore[M][L][0]);{const C=X(this.minPointsScore[M][L][1]),h=X(this.minPointsScore[M][L][2]),w=X(this.minPointsScore[M][L][3]);z.l5+=C.l5+h.l5+w.l5,z.l4+=C.l4+h.l4+w.l4,z.d4+=C.d4+h.d4+w.d4,z.l3+=C.l3+h.l3+w.l3,z.d3+=C.d3+h.d3+w.d3,z.l2+=C.l2+h.l2+w.l2,z.d2+=C.d2+h.d2+w.d2,z.l1+=C.l1+h.l1+w.l1;const{l5:D,l4:P,d4:B,l3:R}=z;D?i.push(u):P?l.push(u):(R&&B&&p.push(u),B&&r.push(u)),Z=tt(z)}q.push({position:[M,L],score:y*this.attackFactor+Z*this.defenseFactor})}let b;if(s)return t?e.length?e:i.length?i:n.length?n:g.length?g:l.length||p.length?a.concat(c):a.concat(S).concat(c).concat(d):e.length?e:n.length||a.length?r.concat(n).concat(a).concat(c):q.sort((A,u)=>u.score-A.score).map(A=>A.position);if(t){if(e.length)return e;if(i.length)return i;if(n.length)return n;if(a.length&&!l.length&&!r.length)return a;if(!c.length&&l.length)return l.concat(r)}else{if(i.length)return i;if(e.length)return e;if(l.length)return l;if(p.length&&!n.length&&!c.length)return p;if(!r.length&&n.length)return n.concat(c)}return b=q.sort((A,u)=>u.score-A.score).map(A=>A.position),b.length<=this.genLimit?b:b.slice(0,this.genLimit)}const Zt={l1:1,d2:2,d3:3,l2:8,l2x2:16,l3:30,d4:50,l4:500,l5:1e3,win:1e4};class N{constructor(t){O(this,"genChilds",Vt);O(this,"evaluate",jt);this.init({...t})}init({firstHand:t,autoPlay:s,enableStats:e,attackFactor:i,defenseFactor:n}){this.node0=[],this.node1=[],this.node2=[],this.node3=[],this.initNode(),this.stack=[],this.zobrist=new Wt({size:k}),this.maxPointsScore=W(k).map(()=>W(k,[0,0,0,0],!0)),this.minPointsScore=W(k).map(()=>W(k,[0,0,0,0],!0)),this.stats={},this.initStats(),this.enableStats=e!==void 0?e:!0,this.enableLog=!1,this.firstHand=t||x,this.genLimit=20,this.seekDepth=8,this.seekKillDepth=21,this.autoPlay=s||!1,this.attackFactor=i||1,this.defenseFactor=n||1,this.timeLimit=3e3}maxGo(){if(this.isFinal)return;console.log(Object.keys(this.zobrist.hash).length),this.initStats();const t=this.getMaxNextStep(),{i:s,j:e,score:i}=t;return this.put(s,e,v),this.logStats(),console.log({score:this.evaluate(),score2:i}),t}getMaxNextStep(){let t=this.genChilds(this.getAllOptimalNextStep(),!0);if(t=t.map(e=>({i:e[0],j:e[1]})),console.log({points:t}),t.length===1)return t[0];const s=this.seekKill();if(s)return s;this.startTime=+new Date,console.time("thinking");for(let e=2;e<=this.seekDepth&&(this.zobrist.resetHash(),!(+new Date-this.startTime>this.timeLimit));e+=2){for(let i=0;i<t.length;i++){let n=t[i];const{i:l,j:c}=n;this.put(l,c,v);const r=this.minimax(e-1,!1);this.rollback(),r.score!==-1/0&&(n.score=r.score,n.depth=e,n.stack=r.stack)}t=t.sort((i,n)=>n.score-i.score),console.log(e,t)}return console.timeEnd("thinking"),t[0]}seekKill(){if(this.stack.length>4){this.startTime=+new Date,console.time("thinking kill");for(let t=3;t<=this.seekKillDepth&&(this.zobrist.resetHash(),!(+new Date-this.startTime>this.timeLimit));t+=2){const s=this.minimax(t,!0,!0);if((s==null?void 0:s.score)>=Zt.win)return console.warn("算杀成功 :)",s),this.logStats(),console.timeEnd("thinking kill"),s}console.timeEnd("thinking kill")}}minGo(t,s){if(!this.isFinal)return this.isEmptyPosition(t,s)?(this.put(t,s,x),console.log({score:this.evaluate()}),!0):!1}minimax(t,s=!0,e=!1,i=-1/0,n=1/0){if(this.isFinal||t===0)return{score:this.evaluate(e),depth:t,stack:structuredClone(this.stack)};const l=this.genChilds(this.getAllOptimalNextStep(),s,e);if(s){if(l.length===0)return{score:-.1};let c=-1/0,r=l[0],d;for(const p of l){if(+new Date-this.startTime>this.timeLimit)break;const[S,q]=p;this.put(S,q,v),this.enableStats&&this.stats.abCut.eva++;let b=this.zobrist.get(),A;if(b===void 0){const u=this.minimax(t-1,!s,e,i,n);b=u.score,A=u.stack,this.zobrist.set(b),this.enableStats&&this.stats.zobrist.miss++}else this.enableStats&&this.stats.zobrist.hit++;if(this.rollback(),b>c&&(c=b,r=p,d=A),i=Math.max(i,c),n<=i){this.enableStats&&this.stats.abCut.cut++;break}}const[g,a]=r;return{score:c,i:g,j:a,stack:d}}else{if(l.length===0)return{score:.2};let c=1/0,r=l[0],d;for(const p of l){if(+new Date-this.startTime>this.timeLimit){c=-1/0;break}const[S,q]=p;this.put(S,q,x),this.enableStats&&this.stats.abCut.eva++;let b=this.zobrist.get(),A;if(b===void 0){const u=this.minimax(t-1,!s,e,i,n);b=u.score,A=u.stack,this.zobrist.set(b),this.enableStats&&this.stats.zobrist.miss++}else this.enableStats&&this.stats.zobrist.hit++;if(this.rollback(),b<c&&(c=b,r=p,d=A),n=Math.min(n,c),n<=i){this.enableStats&&this.stats.abCut.cut++;break}}const[g,a]=r;return{score:c,i:g,j:a,stack:d}}}isWall(t,s){return t<0||t>=k||s<0||s>=k}initNode(){this.node0=W(k,0),this.node1=W(k,0),this.node2=[];for(let t=0;t<k*2-1;t++){let s=0;for(let e=0;e<15;e++){const i=t-e;s<<=2,this.isWall(e,i)&&(s+=3)}this.node2[t]=s}this.node3=[];for(let t=0;t<k*2-1;t++){let s=0;for(let e=0;e<15;e++){const i=14+e-t;s<<=2,this.isWall(e,i)&&(s+=3)}this.node3[t]=s}}initNodeHashAndCode(){}put(t,s,e){this.zobrist.go(t,s,e===v),this.stack.push([t,s]),this.node0[t]=this.node0[t]|e<<2*(14-s),this.node1[s]=this.node1[s]|e<<2*(14-t),this.node2[t+s]=this.node2[t+s]|e<<2*(14-t),this.node3[14+t-s]=this.node3[14+t-s]|e<<2*(14-t),this.updateFourLineScore(t,s)}rollback(t=1){if(!(this.stack.length<t))for(;t-- >0;){const[s,e]=this.stack.pop();this.zobrist.go(s,e,this.getChess(s,e)===v);const i=2*(14-e);this.node0[s]=(this.node0[s]|3<<i)^3<<i;const n=2*(14-s);this.node1[e]=(this.node1[e]|3<<n)^3<<n,this.node2[s+e]=(this.node2[s+e]|3<<n)^3<<n,this.node3[14+s-e]=(this.node3[14+s-e]|3<<n)^3<<n,this.updateFourLineScore(s,e)}}minRepent(){this.stack.length>=2&&this.rollback(2)}isEmptyPosition(t,s){return!this.isWall(t,s)&&this.getChess(t,s)===H}getNearPositions(t){const s=[],[i,n]=t;for(let l=-2;l<=2;l++)for(let c=-2;c<=2;c++)this.isEmptyPosition(l+i,c+n)&&s.push([l+i,c+n]);return s}getAllOptimalNextStep(){if(this.stack.length===0)return[[Y,Y]];if(this.stack.length===1){if(this.isEmptyPosition(Y,Y))return[[Y,Y]];const s=Y+(Math.random()>.5?1:-1),e=Y+(Math.random()>.5?1:-1);return[[s,e]]}let t=[];for(let s=0;s<k;s++)for(let e=0;e<k;e++)this.getChess(s,e)===H&&this.haveNeighbor(s,e)&&t.push([s,e]);return t}haveNeighbor(t,s){for(let i=-2;i<=2;i++)if(!(i+t<0||i+t>=k))for(let n=-2;n<=2;n++){if(n+s<0||n+s>=k||i===0&&n===0)continue;if(this.getChess(i+t,s+n)!==H)return!0}return!1}getChess(t,s){return this.node0[t]>>2*(14-s)&3}getChessInFourDirection(t,s,e){let i=[],n=[],l=[],c=[];if(e===void 0||e===0){const r=this.node0[t],d=s>=4?r>>2*(18-s)&3:3,g=s>=3?r>>2*(17-s)&3:3,a=s>=2?r>>2*(16-s)&3:3,p=s>=1?r>>2*(15-s)&3:3,S=r>>2*(14-s)&3,q=s<=13?r>>2*(13-s)&3:3,b=s<=12?r>>2*(12-s)&3:3,A=s<=11?r>>2*(11-s)&3:3,u=s<=10?r>>2*(10-s)&3:3;if(i=[d,g,a,p,S,q,b,A,u],e===0)return i}if(e===void 0||e===1){const r=this.node1[s],d=t>=4?r>>2*(18-t)&3:3,g=t>=3?r>>2*(17-t)&3:3,a=t>=2?r>>2*(16-t)&3:3,p=t>=1?r>>2*(15-t)&3:3,S=r>>2*(14-t)&3,q=t<=13?r>>2*(13-t)&3:3,b=t<=12?r>>2*(12-t)&3:3,A=t<=11?r>>2*(11-t)&3:3,u=t<=10?r>>2*(10-t)&3:3;if(n=[d,g,a,p,S,q,b,A,u],e===1)return n}if(e===void 0||e===2){const r=this.node2[t+s],d=t>=4?r>>2*(18-t)&3:3,g=t>=3?r>>2*(17-t)&3:3,a=t>=2?r>>2*(16-t)&3:3,p=t>=1?r>>2*(15-t)&3:3,S=r>>2*(14-t)&3,q=t<=13?r>>2*(13-t)&3:3,b=t<=12?r>>2*(12-t)&3:3,A=t<=11?r>>2*(11-t)&3:3,u=t<=10?r>>2*(10-t)&3:3;if(l=[d,g,a,p,S,q,b,A,u],e===2)return l}if(e===void 0||e===3){const r=this.node3[14+t-s],d=t>=4?r>>2*(18-t)&3:3,g=t>=3?r>>2*(17-t)&3:3,a=t>=2?r>>2*(16-t)&3:3,p=t>=1?r>>2*(15-t)&3:3,S=r>>2*(14-t)&3,q=t<=13?r>>2*(13-t)&3:3,b=t<=12?r>>2*(12-t)&3:3,A=t<=11?r>>2*(11-t)&3:3,u=t<=10?r>>2*(10-t)&3:3;if(c=[d,g,a,p,S,q,b,A,u],e===3)return c}return[i,n,l,c]}getPositionsInFourDirection(t,s){let e=[],i=[],n=[],l=[];const c=t-4>0?t-4:0,r=t+4<k-1?t+4:k-1,d=s-4>0?s-4:0,g=s+4<k-1?s+4:k-1;for(let a=d;a<=g;a++)e.push([t,a]);for(let a=c;a<=r;a++)i.push([a,s]);for(let a=4;a>0;a--)t-a>=c&&s+a<=g&&n.push([t-a,s+a]);n.push([t,s]);for(let a=1;a<=4;a++)t+a<=r&&s-a>=d&&n.push([t+a,s-a]);for(let a=4;a>0;a--)t-a>=c&&s-a>=d&&l.push([t-a,s-a]);l.push([t,s]);for(let a=1;a<=4;a++)t+a<=r&&s+a<=g&&l.push([t+a,s+a]);return[e,i,n,l]}updateFourLineScore(t,s){const e=this.getPositionsInFourDirection(t,s);for(let i=0;i<4;i++){const n=e[i];for(let l=0;l<n.length;l++){const c=n[l];this.updatePointScore(c,i)}}}updatePointScore(t,s){const[e,i]=t;this.getChess(e,i)!==H?(this.maxPointsScore[e][i]=[0,0,0,0],this.minPointsScore[e][i]=[0,0,0,0]):(this.maxPointsScore[e][i][s]=this.evaPoint(e,i,v,s),this.minPointsScore[e][i][s]=this.evaPoint(e,i,x,s))}evaPoint(t,s,e,i){const n=this.getChessInFourDirection(t,s,i),r=St(e===v?v:x,e===v?x:v,I);let d=0;const g=r(n),a=T[g];return d+=a||0,d}saveStack(){console.log(JSON.stringify(this.stack))}restoreStack(t){const s=this.firstHand,e=s===v?x:v;this.rollback(this.stack.length);for(let i=0;i<t.length;i++){const[n,l]=t[i];this.put(n,l,i&1?e:s)}}test(t){console.log(Function(t).call(this))}get winner(){if(this.stack.length<7)return null;const[t,s]=this.stack[this.stack.length-1],e=this.getChess(t,s),i=this.getChessInFourDirection(t,s);for(let n=0;n<4;n++){let l=0;const c=i[n];for(let r=0;r<c.length;r++)if(c[r]===e?l++:l=0,l===5)return e}return null}get winnerPositions(){if(!this.winner)return null;const[t,s]=this.stack[this.stack.length-1],e=this.getChess(t,s),i=this.getPositionsInFourDirection(t,s);for(let n=0;n<4;n++){const l=i[n];let c=0,r=[];for(let d=0;d<l.length;d++){const[g,a]=l[d];if(this.getChess(g,a)===e?(c++,r.push([g,a])):(c=0,r=[]),c===5)return r}}return null}get isFinal(){return!!this.winner||this.isBoardFull}get isBoardFull(){return this.stack.length===k**2}get lastChessPosition(){return this.stack.length?this.stack[this.stack.length-1]:null}get isDraw(){return this.isBoardFull&&!this.winner}get node(){return this.node0.map(t=>{let s=[];for(let e=0;e<k;e++)s.push((t&3<<2*e)>>2*e);return s.reverse()})}printNode(){console.log(this.node0.map(t=>t.toString(2))),console.log(this.node1.map(t=>t.toString(2))),console.log(this.node2.map(t=>t.toString(2))),console.log(this.node3.map(t=>t.toString(2)))}initStats(){this.stats={abCut:{all:this.genLimit**this.seekDepth,eva:0,cut:0,toString(){const{all:t,eva:s,cut:e}=this.stats.abCut,i=t-s;return`AB剪枝 最大节点总数:${t} 理论最少评估${t**.5>>0} 实际评估:${s} 剪去:${e}/${i}`}},zobrist:{miss:0,hit:0,toString(){const{hit:t,miss:s}=this.stats.zobrist;return`zobrist 评估节点数:${this.stats.abCut.eva} hit:${t} miss:${s}`}}}}logStats(){this.enableStats&&Object.keys(this.stats).forEach(t=>{console.log(this.stats[t].toString.call(this))})}}O(N,"MAX",v),O(N,"MIN",x),O(N,"EMPTY",H),O(N,"WALL",I);const ht=()=>m("div",{className:"num",children:K(k).map(o=>m("div",{className:"item",children:o},o))});const dt=()=>m("div",{className:"abc",children:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O"].map((o,t)=>m("div",{className:"item",children:t},o))}),Yt=()=>{const[o,t]=j.useState(0);return j.useEffect(()=>{const s=setInterval(()=>{t(e=>e+.2)},200);return()=>clearInterval(s)},[]),m("div",{className:"",children:o.toFixed(1)})};function ft(){return new Worker("/gobang/dist/assets/worker-8dfcae73.js")}const Xt="data:audio/mpeg;base64,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",Ht="/gobang/dist/assets/win-716cbc65.mp3",Ot="/gobang/dist/assets/fail-c60229d9.mp3",Kt="/gobang/dist/assets/draw-304f12b1.mp3",Gt={fall:Xt,win:Ht,fail:Ot,draw:Kt},Jt=({musics:o,onEnded:t})=>m($,{children:o.map(s=>m("video",{src:Gt[s.value],onEnded:()=>t(s.id),autoPlay:!0,hidden:!0},s.id))});let E=new N,U=new ft;window.test=o=>U.postMessage({type:"test",data:o});const $t=({position:o,value:t,onClick:s,isLastChess:e,isMarkPoint:i,isWinnerPoint:n})=>{const l=E.stack.findIndex(c=>c[0]===o[0]&&c[1]===o[1]);return Q("button",{className:`square ${e&&"lastChess"}`,onClick:s,children:[t!==N.EMPTY&&m("div",{className:["chess",t===E.firstHand?"black":"white",n?"pulse":""].join(" "),children:l+1||null}),i&&m("div",{className:"markPoint"})]})},It=({squares:o,onClick:t})=>{const s=E.lastChessPosition,e=E.winner,i=e?E.winnerPositions:null;return Q("div",{className:"boardCenter",children:[m("div",{className:"rowLines",children:K(k).map(n=>m("div",{className:"item"},n))}),m("div",{className:"colLines",children:K(k).map(n=>m("div",{className:"item"},n))}),m("div",{className:"chesses",children:K(k).map(n=>m("div",{className:"boardRow",children:K(k).map(l=>m($t,{position:[n,l],value:o[n][l],isLastChess:s&&s[0]===n&&s[1]===l,isWinnerPoint:i&&i.some(([c,r])=>c===n&&r===l),isMarkPoint:n===3&&l===3||n===3&&l===11||n===7&&l===7||n===11&&l===3||n===11&&l===11,onClick:()=>t(n,l)},l))},n))}),Q("div",{className:"gameoverTip",children:[E.isDraw&&m("div",{className:"tip",children:"和棋~"}),e&&m("div",{className:"tip",children:e===E.firstHand?"黑方胜":"白方胜"})]})]})},_t=()=>{const[o,t]=j.useState(!1),[s,e]=j.useReducer(u=>u+1,0),[i,n]=j.useState(!1),[l,c]=j.useState(!1),[r,d]=j.useReducer((u,M)=>{const{type:L,value:y,id:Z}=M;return L==="add"?[...u,{id:+new Date+Math.random(),value:y}]:L==="remove"?u.filter(F=>F.id!==Z):[]},[]),g=E.isFinal,a=(u,M)=>{if(!o)return console.log({start:o});if(g)return console.log({isFinal:g});if(i)return console.log({thinking:i});if(l)return console.log({autoPlay:l});U.postMessage({type:"minGo",data:[u,M]})},p=()=>{n(!0),U.postMessage({type:"maxGo"})},S=()=>{U.terminate(),U=new ft,U.postMessage({type:"init",data:{}}),t(!1),c(!1)},q=(u,M)=>{t(!0),c(M),U.postMessage({type:"init",data:{firstHand:u,autoPlay:M,seekDepth:4}})},b=()=>{c(!0),U.postMessage({type:"init",data:{firstHand:N.MAX,autoPlay:!0,seekDepth:4}})},A=()=>{U.postMessage({type:"minRepent"})};return j.useEffect(()=>{U.onmessage=u=>{const{type:M,gobang:L,data:y}=u.data;switch(E=JSON.parse(L),M){case"init":E.firstHand===N.MAX&&!E.autoPlay?p():e();break;case"minGo":y&&(d({type:"add",value:"fall"}),p());break;case"maxGo":d({type:"add",value:"fall"}),n(!1);break;case"autoPlay":d({type:"add",value:"fall"});break;default:e();break}}},[U]),j.useEffect(()=>{E.isDraw&&d({type:"add",value:"draw"}),E.winner&&d({type:"add",value:E.winner===N.MAX?"fail":"win"})},[E.winner,E.isDraw]),Q("div",{className:"game",children:[m(Jt,{musics:r,onEnded:u=>d({type:"remove",id:u})}),Q("div",{className:"gameInfo",children:[m(Yt,{}),m("div",{className:""})]}),Q("div",{className:"gameBoard",children:[m(ht,{}),Q("div",{className:"center",children:[m(dt,{}),m(It,{squares:E.node,onClick:pt(a,20)}),m(dt,{})]}),m(ht,{})]}),Q("div",{className:"opbtns",children:[l&&m("button",{onClick:S,children:"开始游戏"}),!l&&!o&&Q($,{children:[m("button",{onClick:()=>q(N.MAX),children:"电脑先手"}),m("button",{onClick:()=>q(N.MIN),children:"玩家先手"}),m("button",{onClick:b,children:"电脑vs电脑"})]}),o&&Q($,{children:[m("button",{onClick:S,children:"重来"}),m("button",{onClick:A,children:"悔棋"})]})]}),Q("div",{className:"game-info",children:[E.winner&&m("div",{children:E.winner===N.MAX?"少侠请努力":"干得漂亮"}),m("ol",{})]})]})},ts=_t;bt.createRoot(document.getElementById("root")).render(m(ts,{}));
