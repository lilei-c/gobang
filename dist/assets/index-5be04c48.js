var ft=Object.defineProperty;var mt=(l,t,s)=>t in l?ft(l,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[t]=s;var R=(l,t,s)=>(mt(l,typeof t!="symbol"?t+"":t,s),s);import{j as H,r as At,a as Q,c as gt}from"./vendor-cd7d93c1.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}})();const K=H.Fragment,u=H.jsx,z=H.jsxs,I=0,N=1,W=2,j=3,m=15,Z=m/2>>0,C=(l,t)=>typeof t=="object"?Array(l).fill().map(()=>structuredClone(t)):Array(l).fill(t),pt=(l,t=20)=>{let s=+new Date;return(...e)=>{+new Date-s>t&&l(...e),s=+new Date}},bt=l=>t=>Array(t-l).fill(null).map((s,e)=>l+e),X=bt(0),ct={l1:2**0,d2:2**3,l2:2**6,d3:2**9,l3:2**12,d4:2**14,l4:2**16,l5:2**18},Y=l=>({l1:l&7,d2:l>>3&7,l2:l>>6&7,d3:l>>9&7,l3:l>>12&3,d4:l>>14&3,l4:l>>16&3,l5:l>>18&3});console.log("getPointMode");const g={l1:1,d2:2,l2:8,d3:12,l3:30,d4:50,l4:500,l5:1e4};console.log("getPoinScoretMode");const $=l=>{const{l5:t,l4:s,d4:e,l3:i,d3:o,l2:n,d2:r,l1:c}=l;let h=0;return t&&(h+=g.l5*t),s&&(h+=g.l4*s),e&&(h+=g.d4*e),i&&(h+=g.l3*i),o&&(h+=g.d3*o),n&&(h+=g.l2*n),r&&(h+=g.d2*r),c&&(h+=g.l1*c),h};console.log("calcEvaPointScore");console.warn("todo: 测试 countLine 是否正确");const ht=(l,t,s)=>e=>{let i=1;for(let o=0;o<4;o++){const n=e[o];i<<=1,n===l?i|=1:(n===t||n===s)&&(i=1)}i=i<<1|1;for(let o=5;o<9;o++){const n=e[o];if(n===t||n===s)break;i<<=1,n===l&&(i|=1)}return i};console.log("countLine");const qt=l=>Array.from({length:1<<l+1},(t,s)=>`0b${s.toString(2)}`),J=qt(12);console.log(J.length);J.forEach(l=>null);const dt=[],St={l1:l=>/010/.test(l)&&l.length>5,d2:l=>/10{0,1}1/.test(l)&&l.length>=5,l2:l=>[/000110/,/001100/,/011000/,/001010/,/010100/].some(t=>t.test(l)),d3:l=>[/111/,/1011/,/1101/,/11001/,/10011/,/10101/].some(t=>t.test(l))&&l.length>=5,l3:l=>[/010110/,/011010/,/01110/,/1010101/].some(t=>t.test(l)),d4:l=>[/11110/,/01111/,/11011/,/11101/,/10111/].some(t=>t.test(l)),l4:l=>[/011110/,/1011101/,/11011011/,/111010111/].some(t=>t.test(l)),l5:l=>/1{5}/.test(l)};for(const[l,t]of Object.entries(St))J.forEach(s=>{t(s.slice(3))&&(dt[+s]=ct[l])});console.log("allModes.forEach");class kt{constructor({size:t,randFn:s}){s||(s=()=>At.int(0,2**31)),this.max=C(t).map(e=>C(t).map(s)),this.min=C(t).map(e=>C(t).map(s)),this.code=s(),this.hash={}}go(t,s,e){this.code^=e?this.max[t][s]:this.min[t][s]}get(){return this.hash[this.code]}set(t){this.hash[this.code]=t}resetHash(){this.hash={}}}const{l1:_,d2:tt,l2:st,d3:et,l3:it,d4:ot,l4:nt,l5:lt}=ct;function Mt(l,t,s){let e=0,i=0,o=0,n=0,r=0,c=0,h=0,p=0,a=0,M=0,x=0,v=0,S=0,b=0,d=0,w=0;const L=(q,k)=>{if(k<34)return;const A=this.serialPointMode[k];if(A)if(q===N)switch(A){case _:return p++;case tt:return h++;case st:return c++;case et:return r++;case it:return n++;case ot:return o++;case nt:return i++;case lt:return e++;default:return console.error("error")}else switch(A){case _:return w++;case tt:return d++;case st:return b++;case et:return S++;case it:return v++;case ot:return x++;case nt:return M++;case lt:return a++;default:return console.error("error")}},T=(q,k,A)=>{if(A===0)return;let y=1,V=0,D=!1;for(let U=0;U<15;U++){const G=A&3;if(A>>=2,G===k||G===j){L(q,y),y=1,D=!0;continue}else if(G===I)if(V===0)V++,y<<=1;else{y<<=1,(A&12)===I&&U!==14&&(y<<=1),L(q,y),y=4,(A&12)===I&&U!==14&&(y<<=1),V=0,D=!0;continue}else V=0,D=!1,y=(y<<1)+1}D||L(q,y)};T(N,W,l[t]),T(W,N,l[t]),s&&(console.log({maxL1:p,maxD2:h,maxL2:c,maxD3:r,maxL3:n,maxD4:o,maxL4:i,maxL5:e}),console.log({minL1:w,minD2:d,minL2:b,minD3:S,minL3:v,minD4:x,minL4:M,minL5:a}));let O=0,E=0;return O=g.l5*e+g.l4*i+g.d4*o+g.l3*n+g.d3*r+g.l2*c+g.d2*h+g.l1*h,E=g.l5*a+g.l4*M+g.d4*x+g.l3*v+g.d3*S+g.l2*b+g.d2*d+g.l1*d,O-E}function wt(){let l=0;for(let t=0;t<4;t++)for(let s=0;s<this.scoreNode[t].length;s++){const e=this.scoreNode[t][s];e&&(l+=e)}return l}function Lt(l,t,s){let e=[],i=[],o=[],n=[],r=[],c=[],h=[],p=[],a=[],M=[],x=[],v=[];for(let b=0;b<l.length;b++){const d=l[b],[w,L]=d;let T=0,O=0,E=Y(this.maxPointsScore[w][L][0]);{const q=Y(this.maxPointsScore[w][L][1]),k=Y(this.maxPointsScore[w][L][2]),A=Y(this.maxPointsScore[w][L][3]);E.l5+=q.l5+k.l5+A.l5,E.l4+=q.l4+k.l4+A.l4,E.d4+=q.d4+k.d4+A.d4,E.l3+=q.l3+k.l3+A.l3,E.d3+=q.d3+k.d3+A.d3,E.l2+=q.l2+k.l2+A.l2,E.d2+=q.d2+k.d2+A.d2,E.l1+=q.l1+k.l1+A.l1;const{l5:y,l4:V,d4:D,l3:U}=E;y?e.push(d):V?o.push(d):(D>1&&p.push(d),U&&D&&a.push(d),U>1&&x.push(d),U&&h.push(d),D&&r.push(d)),T=$(E)}let F=Y(this.minPointsScore[w][L][0]);{const q=Y(this.minPointsScore[w][L][1]),k=Y(this.minPointsScore[w][L][2]),A=Y(this.minPointsScore[w][L][3]);F.l5+=q.l5+k.l5+A.l5,F.l4+=q.l4+k.l4+A.l4,F.d4+=q.d4+k.d4+A.d4,F.l3+=q.l3+k.l3+A.l3,F.d3+=q.d3+k.d3+A.d3,F.l2+=q.l2+k.l2+A.l2,F.d2+=q.d2+k.d2+A.d2,F.l1+=q.l1+k.l1+A.l1;const{l5:y,l4:V,d4:D,l3:U}=F;y?i.push(d):V?n.push(d):(U&&D&&M.push(d),D&&c.push(d)),O=$(F)}v.push({position:[w,L],score:T*this.attackFactor+O*this.defenseFactor})}let S;if(s)return t?e.length?e:i.length?i:o.length?o:p.length?p:n.length||M.length?a.concat(r):a.concat(x).concat(r).concat(h):e.length?e:o.length||a.length?c.concat(o).concat(a).concat(r):v.sort((b,d)=>d.score-b.score).map(b=>b.position);if(t){if(e.length)return e;if(i.length)return i;if(o.length)return o;if(a.length&&!n.length&&!c.length)return a;if(n.length)return r.length?n.concat(r):n}else{if(i.length)return i;if(e.length)return e;if(n.length)return n;if(M.length&&!o.length&&!r.length)return M;if(o.length)return c.length?o.concat(c):o}return S=v.sort((b,d)=>d.score-b.score).map(b=>b.position),S.length<=this.genLimit?S:S.slice(0,this.genLimit)}const xt=ht(N,W,j),Et=ht(W,N,j);class B{constructor(t){R(this,"genChilds",Lt);R(this,"evaluate",wt);R(this,"evaluateOnlyLine",Mt);R(this,"serialPointMode",dt);this.init({...t})}init({firstHand:t,autoPlay:s,enableStats:e,attackFactor:i,defenseFactor:o}){this.node0=[],this.node1=[],this.node2=[],this.node3=[],this.neighborNode=[],this.scoreNode=C(4,[]),this.initNode(),this.stack=[],this.zobrist=new kt({size:m}),this.maxPointsScore=C(m,C(m,[0,0,0,0])),this.minPointsScore=C(m,C(m,[0,0,0,0])),this.stats={},this.initStats(),this.enableStats=e!==void 0?e:!0,this.enableLog=!1,this.firstHand=t||W,this.genLimit=20,this.seekDepth=8,this.seekKillDepth=21,this.autoPlay=s||!1,this.attackFactor=i||1,this.defenseFactor=o||1,this.timeLimit=3e3}maxGo(){if(this.isFinal)return;console.log(Object.keys(this.zobrist.hash).length),this.initStats();const t=this.getMaxNextStep(),{i:s,j:e,score:i}=t;return this.put(s,e,N),this.logStats(),console.log({score:this.evaluate(),score2:i}),t}getMaxNextStep(){let t=this.genChilds(this.getAllOptimalNextStep(),!0);if(t=t.map(e=>({i:e[0],j:e[1]})),console.log({points:t}),t.length===1)return t[0];const s=this.seekKill();if(s)return s;this.startTime=+new Date,console.time("thinking");for(let e=2;e<=this.seekDepth&&(this.zobrist.resetHash(),!(+new Date-this.startTime>this.timeLimit));e+=2){for(let i=0;i<t.length;i++){let o=t[i];const{i:n,j:r}=o;this.put(n,r,N);const c=this.minimax(e-1,!1);this.rollback(),c.score!==-1/0&&(o.score=c.score,o.depth=e,o.stack=c.stack)}t=t.sort((i,o)=>o.score-i.score),console.log(e,t)}return console.timeEnd("thinking"),t[0]}seekKill(){if(this.stack.length>4){this.startTime=+new Date,console.time("thinking kill");for(let t=3;t<=this.seekKillDepth&&(this.zobrist.resetHash(),!(+new Date-this.startTime>this.timeLimit));t+=2){const s=this.minimax(t,!0,!0);if((s==null?void 0:s.score)>g.l5*.5)return console.warn("算杀成功 :)",s),this.logStats(),console.timeEnd("thinking kill"),s}console.timeEnd("thinking kill")}}minGo(t,s){if(!this.isFinal)return this.isEmptyPosition(t,s)?(this.put(t,s,W),console.log({score:this.evaluate()}),!0):!1}minimax(t,s=!0,e=!1,i=-1/0,o=1/0){if(this.isFinal||t===0)return{score:this.evaluate(e),depth:t};const n=this.genChilds(this.getAllOptimalNextStep(),s,e);if(s){if(n.length===0)return{score:-.1};let r=-1/0,c=n[0],h;for(const M of n){if(+new Date-this.startTime>this.timeLimit)break;const[x,v]=M;this.put(x,v,N),this.enableStats&&this.stats.abCut.eva++;let S=this.zobrist.get(),b;if(S===void 0){const d=this.minimax(t-1,!s,e,i,o);S=d.score,b=d.stack,this.zobrist.set(S),this.enableStats&&this.stats.zobrist.miss++}else this.enableStats&&this.stats.zobrist.hit++;if(this.rollback(),S>r&&(r=S,c=M,h=b),i=Math.max(i,r),o<=i){this.enableStats&&this.stats.abCut.cut++;break}}const[p,a]=c;return{score:r,i:p,j:a,stack:h}}else{if(n.length===0)return{score:.2};let r=1/0,c=n[0],h;for(const M of n){if(+new Date-this.startTime>this.timeLimit){r=-1/0;break}const[x,v]=M;this.put(x,v,W),this.enableStats&&this.stats.abCut.eva++;let S=this.zobrist.get(),b;if(S===void 0){const d=this.minimax(t-1,!s,e,i,o);S=d.score,b=d.stack,this.zobrist.set(S),this.enableStats&&this.stats.zobrist.miss++}else this.enableStats&&this.stats.zobrist.hit++;if(this.rollback(),S<r&&(r=S,c=M,h=b),o=Math.min(o,r),o<=i){this.enableStats&&this.stats.abCut.cut++;break}}const[p,a]=c;return{score:r,i:p,j:a,stack:h}}}isWall(t,s){return t<0||t>=m||s<0||s>=m}initNode(){this.node0=C(m,0),this.node1=C(m,0),this.node2=[];for(let t=0;t<m*2-1;t++){let s=0;for(let e=0;e<15;e++){const i=t-e;s<<=2,this.isWall(e,i)&&(s+=3)}this.node2[t]=s}this.node3=[];for(let t=0;t<m*2-1;t++){let s=0;for(let e=0;e<15;e++){const i=14+e-t;s<<=2,this.isWall(e,i)&&(s+=3)}this.node3[t]=s}this.neighborNode=C(m,C(m,0))}put(t,s,e){this.zobrist.go(t,s,e===N),this.stack.push([t,s]),this.node0[t]=this.node0[t]|e<<2*(14-s),this.node1[s]=this.node1[s]|e<<2*(14-t),this.node2[t+s]=this.node2[t+s]|e<<2*(14-t),this.node3[14+t-s]=this.node3[14+t-s]|e<<2*(14-t),this.updateNeighbor(t,s,!0),this.updatePointScore(t,s),this.updateScoreNode(t,s)}rollback(t=1){if(!(this.stack.length<t))for(;t-- >0;){const[s,e]=this.stack.pop();this.zobrist.go(s,e,this.getChess(s,e)===N);const i=2*(14-e);this.node0[s]=(this.node0[s]|3<<i)^3<<i;const o=2*(14-s);this.node1[e]=(this.node1[e]|3<<o)^3<<o,this.node2[s+e]=(this.node2[s+e]|3<<o)^3<<o,this.node3[14+s-e]=(this.node3[14+s-e]|3<<o)^3<<o,this.updateNeighbor(s,e,!1),this.updatePointScore(s,e),this.updateScoreNode(s,e)}}minRepent(){this.stack.length>=2&&this.rollback(2)}isEmptyPosition(t,s){return!this.isWall(t,s)&&this.getChess(t,s)===I}getAllOptimalNextStep(){if(this.stack.length===0)return[[Z,Z]];if(this.stack.length===1){if(this.isEmptyPosition(Z,Z))return[[Z,Z]];const s=Z+(Math.random()>.5?1:-1),e=Z+(Math.random()>.5?1:-1);return[[s,e]]}let t=[];for(let s=0;s<m;s++)for(let e=0;e<m;e++)this.neighborNode[s][e]>0&&t.push([s,e]);return t}updateNeighbor(t,s,e){e?this.neighborNode[t][s]-=64:this.neighborNode[t][s]+=64;const i=2;for(let o=-i;o<=i;o++)if(!(o+t<0||o+t>=m))for(let n=-i;n<=i;n++)n+s<0||n+s>=m||o===0&&n===0||(e?this.neighborNode[o+t][s+n]+=1:this.neighborNode[o+t][s+n]-=1)}updateScoreNode(t,s){this.scoreNode[0][t]=this.evaluateOnlyLine(this.node0,t),this.scoreNode[1][s]=this.evaluateOnlyLine(this.node1,s),this.scoreNode[2][t+s]=this.evaluateOnlyLine(this.node2,t+s),this.scoreNode[3][14+t-s]=this.evaluateOnlyLine(this.node3,14+t-s)}getChess(t,s){return this.node0[t]>>2*(14-s)&3}getChessInFourDirection(t,s,e){if(e===0){const i=this.node0[t],o=s>=4?i>>2*(18-s)&3:3,n=s>=3?i>>2*(17-s)&3:3,r=s>=2?i>>2*(16-s)&3:3,c=s>=1?i>>2*(15-s)&3:3,h=i>>2*(14-s)&3,p=s<=13?i>>2*(13-s)&3:3,a=s<=12?i>>2*(12-s)&3:3,M=s<=11?i>>2*(11-s)&3:3,x=s<=10?i>>2*(10-s)&3:3;return[o,n,r,c,h,p,a,M,x]}else{let i;e===1?i=this.node1[s]:e===2?i=this.node2[t+s]:e===3&&(i=this.node3[14+t-s]);const o=t>=4?i>>2*(18-t)&3:3,n=t>=3?i>>2*(17-t)&3:3,r=t>=2?i>>2*(16-t)&3:3,c=t>=1?i>>2*(15-t)&3:3,h=i>>2*(14-t)&3,p=t<=13?i>>2*(13-t)&3:3,a=t<=12?i>>2*(12-t)&3:3,M=t<=11?i>>2*(11-t)&3:3,x=t<=10?i>>2*(10-t)&3:3;return[o,n,r,c,h,p,a,M,x]}}getPositionsInFourDirection(t,s){let e=[],i=[],o=[],n=[];const r=t-4>0?t-4:0,c=t+4<m-1?t+4:m-1,h=s-4>0?s-4:0,p=s+4<m-1?s+4:m-1;for(let a=h;a<=p;a++)e.push([t,a]);for(let a=r;a<=c;a++)i.push([a,s]);for(let a=4;a>0;a--)t-a>=r&&s+a<=p&&o.push([t-a,s+a]);o.push([t,s]);for(let a=1;a<=4;a++)t+a<=c&&s-a>=h&&o.push([t+a,s-a]);for(let a=4;a>0;a--)t-a>=r&&s-a>=h&&n.push([t-a,s-a]);n.push([t,s]);for(let a=1;a<=4;a++)t+a<=c&&s+a<=p&&n.push([t+a,s+a]);return[e,i,o,n]}updatePointScore(t,s){const e=this.getPositionsInFourDirection(t,s);for(let i=0;i<4;i++){const o=e[i];for(let n=0;n<o.length;n++){const[r,c]=o[n];if(this.getChess(r,c)!==I)this.maxPointsScore[r][c]=[0,0,0,0],this.minPointsScore[r][c]=[0,0,0,0];else{const h=this.getChessInFourDirection(r,c,i);this.maxPointsScore[r][c][i]=this.serialPointMode[xt(h)]||0,this.minPointsScore[r][c][i]=this.serialPointMode[Et(h)]||0}}}}saveStack(){console.log(JSON.stringify(this.stack))}restoreStack(t){const s=this.firstHand,e=s===N?W:N;this.rollback(this.stack.length);for(let i=0;i<t.length;i++){const[o,n]=t[i],r=i%2===0?s:e;this.put(o,n,r)}}test(t){console.log(Function(t).call(this))}get winner(){if(this.stack.length<7)return null;const[t,s]=this.stack[this.stack.length-1],e=this.getChess(t,s),i=[this.getChessInFourDirection(t,s,0),this.getChessInFourDirection(t,s,1),this.getChessInFourDirection(t,s,2),this.getChessInFourDirection(t,s,3)];for(let o=0;o<4;o++){let n=0;const r=i[o];for(let c=0;c<r.length;c++)if(r[c]===e?n++:n=0,n===5)return e}return null}get winnerPositions(){if(!this.winner)return null;const[t,s]=this.stack[this.stack.length-1],e=this.getChess(t,s),i=this.getPositionsInFourDirection(t,s);for(let o=0;o<4;o++){const n=i[o];let r=0,c=[];for(let h=0;h<n.length;h++){const[p,a]=n[h];if(this.getChess(p,a)===e?(r++,c.push([p,a])):(r=0,c=[]),r===5)return c}}return null}get isFinal(){return!!this.winner||this.isBoardFull}get isBoardFull(){return this.stack.length===m**2}get lastChessPosition(){return this.stack.length?this.stack[this.stack.length-1]:null}get isDraw(){return this.isBoardFull&&!this.winner}get node(){return this.node0.map(t=>{let s=[];for(let e=0;e<m;e++)s.push((t&3<<2*e)>>2*e);return s.reverse()})}printNode(){console.log(this.node0.map(t=>t.toString(2))),console.log(this.node1.map(t=>t.toString(2))),console.log(this.node2.map(t=>t.toString(2))),console.log(this.node3.map(t=>t.toString(2)))}initStats(){this.stats={abCut:{all:this.genLimit**this.seekDepth,eva:0,cut:0,toString(){const{all:t,eva:s,cut:e}=this.stats.abCut,i=t-s;return`AB剪枝 最大节点总数:${t} 理论最少评估${t**.5>>0} 实际评估:${s} 剪去:${e}/${i}`}},zobrist:{miss:0,hit:0,toString(){const{hit:t,miss:s}=this.stats.zobrist;return`zobrist 评估节点数:${this.stats.abCut.eva} hit:${t} miss:${s}`}}}}logStats(){this.enableStats&&Object.keys(this.stats).forEach(t=>{console.log(this.stats[t].toString.call(this))})}}R(B,"MAX",N),R(B,"MIN",W),R(B,"EMPTY",I),R(B,"WALL",j);const rt=()=>u("div",{className:"num",children:X(m).map(l=>u("div",{className:"item",children:l},l))});const at=()=>u("div",{className:"abc",children:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O"].map((l,t)=>u("div",{className:"item",children:t},l))}),yt=()=>{const[l,t]=Q.useState(0);return Q.useEffect(()=>{const s=setInterval(()=>{t(e=>e+.2)},200);return()=>clearInterval(s)},[]),u("div",{className:"",children:l.toFixed(1)})};function ut(){return new Worker("/gobang/dist/assets/worker-59ef724b.js")}const vt="data:audio/mpeg;base64,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",Ct="/gobang/dist/assets/win-716cbc65.mp3",Nt="/gobang/dist/assets/fail-c60229d9.mp3",Pt="/gobang/dist/assets/draw-304f12b1.mp3",Ft={fall:vt,win:Ct,fail:Nt,draw:Pt},Dt=({musics:l,onEnded:t})=>u(K,{children:l.map(s=>u("video",{src:Ft[s.value],onEnded:()=>t(s.id),autoPlay:!0,hidden:!0},s.id))});let f,P=new ut;window.test=l=>P.postMessage({type:"test",data:l});const zt=({position:l,value:t,onClick:s,isLastChess:e,isMarkPoint:i,isWinnerPoint:o})=>{const n=f.stack.findIndex(r=>r[0]===l[0]&&r[1]===l[1]);return z("button",{className:`square ${e&&"lastChess"}`,onClick:s,children:[t!==B.EMPTY&&u("div",{className:["chess",t===f.firstHand?"black":"white",o?"pulse":""].join(" "),children:n+1||null}),i&&u("div",{className:"markPoint"})]})},Bt=({squares:l,onClick:t})=>{const s=f.lastChessPosition,e=f.winner,i=e?f.winnerPositions:null;return z("div",{className:"boardCenter",children:[u("div",{className:"rowLines",children:X(m).map(o=>u("div",{className:"item"},o))}),u("div",{className:"colLines",children:X(m).map(o=>u("div",{className:"item"},o))}),u("div",{className:"chesses",children:X(m).map(o=>u("div",{className:"boardRow",children:X(m).map(n=>u(zt,{position:[o,n],value:l[o][n],isLastChess:s&&s[0]===o&&s[1]===n,isWinnerPoint:i&&i.some(([r,c])=>r===o&&c===n),isMarkPoint:o===3&&n===3||o===3&&n===11||o===7&&n===7||o===11&&n===3||o===11&&n===11,onClick:()=>t(o,n)},n))},o))}),z("div",{className:"gameoverTip",children:[f.isDraw&&u("div",{className:"tip",children:"和棋~"}),e&&u("div",{className:"tip",children:e===f.firstHand?"黑方胜":"白方胜"})]})]})},Ut=()=>{const[l,t]=Q.useState(!1),[s,e]=Q.useReducer(d=>d+1,0),[i,o]=Q.useState(!1),[n,r]=Q.useState(!1),[c,h]=Q.useReducer((d,w)=>{const{type:L,value:T,id:O}=w;return L==="add"?[...d,{id:+new Date+Math.random(),value:T}]:L==="remove"?d.filter(E=>E.id!==O):[]},[]),p=f==null?void 0:f.isFinal,a=(d,w)=>{if(!l)return console.log({start:l});if(p)return console.log({isFinal:p});if(i)return console.log({thinking:i});if(n)return console.log({autoPlay:n});P.postMessage({type:"minGo",data:[d,w]})},M=()=>{o(!0),P.postMessage({type:"maxGo"})},x=()=>{P.terminate(),P=new ut,P.postMessage({type:"init",data:{}}),t(!1),r(!1)},v=(d,w)=>{t(!0),r(w),P.postMessage({type:"init",data:{firstHand:d,autoPlay:w,seekDepth:4}})},S=()=>{r(!0),P.postMessage({type:"init",data:{firstHand:B.MAX,autoPlay:!0,seekDepth:4}})},b=()=>{P.postMessage({type:"minRepent"})};return Q.useEffect(()=>{P.onmessage=d=>{const{type:w,gobang:L,data:T}=d.data;switch(f=JSON.parse(L),w){case"init":f.firstHand===B.MAX&&!f.autoPlay?M():e();break;case"minGo":T&&(h({type:"add",value:"fall"}),M());break;case"maxGo":h({type:"add",value:"fall"}),o(!1);break;case"autoPlay":h({type:"add",value:"fall"});break;default:e();break}}},[P]),Q.useEffect(()=>{f!=null&&f.isDraw&&h({type:"add",value:"draw"}),f!=null&&f.winner&&h({type:"add",value:f.winner===B.MAX?"fail":"win"})},[f==null?void 0:f.winner,f==null?void 0:f.isDraw]),Q.useEffect(()=>P.postMessage({type:"new Gobang"}),[]),f&&z("div",{className:"game",children:[u(Dt,{musics:c,onEnded:d=>h({type:"remove",id:d})}),z("div",{className:"gameInfo",children:[u(yt,{}),u("div",{className:""})]}),z("div",{className:"gameBoard",children:[u(rt,{}),z("div",{className:"center",children:[u(at,{}),u(Bt,{squares:f.node,onClick:pt(a,20)}),u(at,{})]}),u(rt,{})]}),z("div",{className:"opbtns",children:[n&&u("button",{onClick:x,children:"开始游戏"}),!n&&!l&&z(K,{children:[u("button",{onClick:()=>v(B.MAX),children:"电脑先手"}),u("button",{onClick:()=>v(B.MIN),children:"玩家先手"}),u("button",{onClick:S,children:"电脑vs电脑"})]}),l&&z(K,{children:[u("button",{onClick:x,children:"重来"}),u("button",{onClick:b,children:"悔棋"})]})]}),z("div",{className:"game-info",children:[f.winner&&u("div",{children:f.winner===B.MAX?"少侠请努力":"干得漂亮"}),u("ol",{})]})]})},Qt=Ut;gt.createRoot(document.getElementById("root")).render(u(Qt,{}));
