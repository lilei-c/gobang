var ft=Object.defineProperty;var mt=(l,t,s)=>t in l?ft(l,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[t]=s;var W=(l,t,s)=>(mt(l,typeof t!="symbol"?t+"":t,s),s);import{j as H,r as At,a as Q,c as gt}from"./vendor-cd7d93c1.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}})();const K=H.Fragment,u=H.jsx,z=H.jsxs,T=0,N=1,V=2,j=3,m=15,Z=m/2>>0,y=(l,t)=>typeof t=="object"?Array(l).fill().map(()=>structuredClone(t)):Array(l).fill(t),pt=(l,t=20)=>{let s=+new Date;return(...e)=>{+new Date-s>t&&l(...e),s=+new Date}},bt=l=>t=>Array(t-l).fill(null).map((s,e)=>l+e),X=bt(0),ct={l1:2**0,d2:2**3,l2:2**6,d3:2**9,l3:2**12,d4:2**14,l4:2**16,l5:2**18},Y=l=>({l1:l&7,d2:l>>3&7,l2:l>>6&7,d3:l>>9&7,l3:l>>12&3,d4:l>>14&3,l4:l>>16&3,l5:l>>18&3});console.log("getPointMode");const p={l1:1,d2:2,l2:8,d3:12,l3:30,d4:50,l4:500,l5:1e4};console.log("getPoinScoretMode");const $=l=>{const{l5:t,l4:s,d4:e,l3:i,d3:o,l2:n,d2:r,l1:h}=l;let c=0;return t&&(c+=p.l5*t),s&&(c+=p.l4*s),e&&(c+=p.d4*e),i&&(c+=p.l3*i),o&&(c+=p.d3*o),n&&(c+=p.l2*n),r&&(c+=p.d2*r),h&&(c+=p.l1*h),c};console.log("calcEvaPointScore");console.warn("todo: 测试 countLine 是否正确");const ht=(l,t,s)=>e=>{let i=1;for(let o=0;o<4;o++){const n=e[o];i<<=1,n===l?i|=1:(n===t||n===s)&&(i=1)}i=i<<1|1;for(let o=5;o<9;o++){const n=e[o];if(n===t||n===s)break;i<<=1,n===l&&(i|=1)}return i};console.log("countLine");const qt=l=>Array.from({length:1<<l+1},(t,s)=>`0b${s.toString(2)}`),J=qt(12);console.log(J.length);J.forEach(l=>null);const dt=[],St={l1:l=>/010/.test(l)&&l.length>5,d2:l=>/10{0,1}1/.test(l)&&l.length>=5,l2:l=>[/000110/,/001100/,/011000/,/001010/,/010100/].some(t=>t.test(l)),d3:l=>[/111/,/1011/,/1101/,/11001/,/10011/,/10101/].some(t=>t.test(l))&&l.length>=5,l3:l=>[/010110/,/011010/,/01110/,/1010101/].some(t=>t.test(l)),d4:l=>[/11110/,/01111/,/11011/,/11101/,/10111/].some(t=>t.test(l)),l4:l=>[/011110/,/1011101/,/11011011/,/111010111/].some(t=>t.test(l)),l5:l=>/1{5}/.test(l)};for(const[l,t]of Object.entries(St))J.forEach(s=>{t(s.slice(3))&&(dt[+s]=ct[l])});console.log("allModes.forEach");class kt{constructor({size:t,randFn:s}){s||(s=()=>At.int(0,2**31)),this.max=y(t).map(e=>y(t).map(s)),this.min=y(t).map(e=>y(t).map(s)),this.code=s(),this.hash={}}go(t,s,e){this.code^=e?this.max[t][s]:this.min[t][s]}get(){return this.hash[this.code]}set(t){this.hash[this.code]=t}resetHash(){this.hash={}}}const{l1:_,d2:tt,l2:st,d3:et,l3:it,d4:ot,l4:nt,l5:lt}=ct;function Mt(l,t,s){let e=0,i=0,o=0,n=0,r=0,h=0,c=0,A=0,a=0,b=0,L=0,v=0,k=0,q=0,d=0,w=0;const x=(S,M)=>{if(M<34)return;const g=this.serialPointMode[M];if(g)if(S===N)switch(g){case _:return A++;case tt:return c++;case st:return h++;case et:return r++;case it:return n++;case ot:return o++;case nt:return i++;case lt:return e++;default:return console.error("error")}else switch(g){case _:return w++;case tt:return d++;case st:return q++;case et:return k++;case it:return v++;case ot:return L++;case nt:return b++;case lt:return a++;default:return console.error("error")}},R=(S,M,g)=>{if(g===0)return;let C=1,O=0,F=!1;for(let U=0;U<15;U++){const G=g&3;if(g>>=2,G===M||G===j){x(S,C),C=1,F=!0;continue}else if(G===T)if(O===0)O++,C<<=1;else{C<<=1,(g&12)===T&&U!==14&&(C<<=1),x(S,C),C=4,(g&12)===T&&U!==14&&(C<<=1),O=0,F=!0;continue}else O=0,F=!1,C=(C<<1)+1}F||x(S,C)};R(N,V,l[t]),R(V,N,l[t]),s&&(console.log({maxL1:A,maxD2:c,maxL2:h,maxD3:r,maxL3:n,maxD4:o,maxL4:i,maxL5:e}),console.log({minL1:w,minD2:d,minL2:q,minD3:k,minL3:v,minD4:L,minL4:b,minL5:a}));let I=0,E=0;return I=p.l5*e+p.l4*i+p.d4*o+p.l3*n+p.d3*r+p.l2*h+p.d2*c+p.l1*c,E=p.l5*a+p.l4*b+p.d4*L+p.l3*v+p.d3*k+p.l2*q+p.d2*d+p.l1*d,I-E}function wt(){let l=0;for(let t=0;t<4;t++)for(let s=0;s<this.scoreNode[t].length;s++){const e=this.scoreNode[t][s];e&&(l+=e)}return l}function Lt(l,t,s){let e=[],i=[],o=[],n=[],r=[],h=[],c=[],A=[],a=[],b=[],L=[],v=[];for(let q=0;q<l.length;q++){const d=l[q],[w,x]=d;let R=0,I=0,E=Y(this.maxPointsScore[w][x][0]);{const S=Y(this.maxPointsScore[w][x][1]),M=Y(this.maxPointsScore[w][x][2]),g=Y(this.maxPointsScore[w][x][3]);E.l5+=S.l5+M.l5+g.l5,E.l4+=S.l4+M.l4+g.l4,E.d4+=S.d4+M.d4+g.d4,E.l3+=S.l3+M.l3+g.l3,E.d3+=S.d3+M.d3+g.d3,E.l2+=S.l2+M.l2+g.l2,E.d2+=S.d2+M.d2+g.d2,E.l1+=S.l1+M.l1+g.l1;const{l5:C,l4:O,d4:F,l3:U}=E;C?e.push(d):O?o.push(d):(F>1&&A.push(d),U&&F&&a.push(d),U>1&&L.push(d),U&&c.push(d),F&&r.push(d)),R=$(E)}let P=Y(this.minPointsScore[w][x][0]);{const S=Y(this.minPointsScore[w][x][1]),M=Y(this.minPointsScore[w][x][2]),g=Y(this.minPointsScore[w][x][3]);P.l5+=S.l5+M.l5+g.l5,P.l4+=S.l4+M.l4+g.l4,P.d4+=S.d4+M.d4+g.d4,P.l3+=S.l3+M.l3+g.l3,P.d3+=S.d3+M.d3+g.d3,P.l2+=S.l2+M.l2+g.l2,P.d2+=S.d2+M.d2+g.d2,P.l1+=S.l1+M.l1+g.l1;const{l5:C,l4:O,d4:F,l3:U}=P;C?i.push(d):O?n.push(d):(U&&F&&b.push(d),F&&h.push(d)),I=$(P)}v.push({position:[w,x],score:R*this.attackFactor+I*this.defenseFactor})}let k;if(s)return t?e.length?e:i.length?i:o.length?o:A.length?A:n.length||b.length?a.concat(r):a.concat(L).concat(r).concat(c):e.length?e:o.length||a.length?h.concat(o).concat(a).concat(r):v.sort((q,d)=>d.score-q.score).map(q=>q.position);if(t){if(e.length)return e;if(i.length)return i;if(o.length)return o;if(a.length&&!n.length&&!h.length)return a;if(n.length)return r.length?n.concat(r):n}else{if(i.length)return i;if(e.length)return e;if(n.length)return n;if(b.length&&!o.length&&!r.length)return b;if(o.length)return h.length?o.concat(h):o}return k=v.sort((q,d)=>d.score-q.score).map(q=>q.position),k.length<=this.genLimit?k:k.slice(0,this.genLimit)}const xt=ht(N,V,j),Et=ht(V,N,j);class B{constructor(t){W(this,"genChilds",Lt);W(this,"evaluate",wt);W(this,"evaluateOnlyLine",Mt);W(this,"serialPointMode",dt);this.init({...t})}init({firstHand:t,autoPlay:s,enableStats:e,attackFactor:i,defenseFactor:o}){this.node0=[],this.node1=[],this.node2=[],this.node3=[],this.neighborNode=[],this.scoreNode=y(4,[]),this.initNode(),this.stack=[],this.zobrist=new kt({size:m}),this.maxPointsScore=y(m,y(m,[0,0,0,0])),this.minPointsScore=y(m,y(m,[0,0,0,0])),this.stats={},this.initStats(),this.enableStats=e!==void 0?e:!0,this.enableLog=!1,this.firstHand=t||V,this.genLimit=20,this.seekDepth=8,this.seekKillDepth=21,this.autoPlay=s||!1,this.attackFactor=i||1,this.defenseFactor=o||1,this.timeLimit=3e3}maxGo(){if(this.isFinal)return;console.log(Object.keys(this.zobrist.hash).length),this.initStats();const t=this.getMaxNextStep(),{i:s,j:e,score:i}=t;return this.put(s,e,N),this.logStats(),console.log({score:this.evaluate(),score2:i}),t}getMaxNextStep(){let t=this.genChilds(this.getAllOptimalNextStep(),!0);if(t=t.map(e=>({i:e[0],j:e[1]})),console.log({points:t}),t.length===1)return t[0];const s=this.seekKill();if(s)return s;this.startTime=+new Date,console.time("thinking");for(let e=2;e<=this.seekDepth&&(this.zobrist.resetHash(),!(+new Date-this.startTime>this.timeLimit));e+=2){for(let i=0;i<t.length;i++){let o=t[i];const{i:n,j:r}=o;this.put(n,r,N);const h=this.minimax(e-1,!1);this.rollback(),h.score!==-1/0&&(o.score=h.score,o.depth=e,o.stack=h.stack)}t=t.sort((i,o)=>o.score-i.score),console.log(e,t)}return console.timeEnd("thinking"),t[0]}seekKill(){if(this.stack.length>4){this.startTime=+new Date,console.time("thinking kill");for(let t=3;t<=this.seekKillDepth&&(this.zobrist.resetHash(),!(+new Date-this.startTime>this.timeLimit));t+=2){const s=this.minimax(t,!0,!0);if((s==null?void 0:s.score)>p.l5*.5)return console.warn("算杀成功 :)",s),console.timeEnd("thinking kill"),s}console.timeEnd("thinking kill")}}minGo(t,s){if(!this.isFinal)return this.isEmptyPosition(t,s)?(this.put(t,s,V),console.log({score:this.evaluate()}),!0):!1}minimax(t,s=!0,e=!1,i=-1/0,o=1/0){if(this.winner)return{score:s?-p.l5:p.l5};if(this.isBoardFull||t===0)return{score:this.evaluate(e),depth:t};const n=this.genChilds(this.getAllOptimalNextStep(),s,e);if(s){if(n.length===0)return{score:-.1};let r=-1/0,h=n[0],c;for(const b of n){if(+new Date-this.startTime>this.timeLimit)break;const[L,v]=b;this.put(L,v,N),this.enableStats&&this.stats.abCut.eva++;let k=this.zobrist.get(),q;if(k===void 0){const d=this.minimax(t-1,!s,e,i,o);k=d.score,q=d.stack,this.zobrist.set(k),this.enableStats&&this.stats.zobrist.miss++}else this.enableStats&&this.stats.zobrist.hit++;if(this.rollback(),k>r&&(r=k,h=b,c=q),i=Math.max(i,r),o<=i){this.enableStats&&this.stats.abCut.cut++;break}}const[A,a]=h;return{score:r,i:A,j:a,stack:c}}else{if(n.length===0)return{score:.2};let r=1/0,h=n[0],c;for(const b of n){if(+new Date-this.startTime>this.timeLimit){r=-1/0;break}const[L,v]=b;this.put(L,v,V),this.enableStats&&this.stats.abCut.eva++;let k=this.zobrist.get(),q;if(k===void 0){const d=this.minimax(t-1,!s,e,i,o);k=d.score,q=d.stack,this.zobrist.set(k),this.enableStats&&this.stats.zobrist.miss++}else this.enableStats&&this.stats.zobrist.hit++;if(this.rollback(),k<r&&(r=k,h=b,c=q),o=Math.min(o,r),o<=i){this.enableStats&&this.stats.abCut.cut++;break}}const[A,a]=h;return{score:r,i:A,j:a,stack:c}}}isWall(t,s){return t<0||t>=m||s<0||s>=m}initNode(){this.node0=y(m,0),this.node1=y(m,0),this.node2=[];for(let t=0;t<m*2-1;t++){let s=0;for(let e=0;e<15;e++){const i=t-e;s<<=2,this.isWall(e,i)&&(s+=3)}this.node2[t]=s}this.node3=[];for(let t=0;t<m*2-1;t++){let s=0;for(let e=0;e<15;e++){const i=14+e-t;s<<=2,this.isWall(e,i)&&(s+=3)}this.node3[t]=s}this.neighborNode=y(m,y(m,0))}put(t,s,e){this.zobrist.go(t,s,e===N),this.stack.push([t,s]),this.node0[t]=this.node0[t]|e<<2*(14-s),this.node1[s]=this.node1[s]|e<<2*(14-t),this.node2[t+s]=this.node2[t+s]|e<<2*(14-t),this.node3[14+t-s]=this.node3[14+t-s]|e<<2*(14-t),this.updateNeighbor(t,s,!0),this.updatePointScore(t,s),this.updateScoreNode(t,s)}rollback(t=1){if(!(this.stack.length<t))for(;t-- >0;){const[s,e]=this.stack.pop();this.zobrist.go(s,e,this.getChess(s,e)===N);const i=2*(14-e);this.node0[s]=(this.node0[s]|3<<i)^3<<i;const o=2*(14-s);this.node1[e]=(this.node1[e]|3<<o)^3<<o,this.node2[s+e]=(this.node2[s+e]|3<<o)^3<<o,this.node3[14+s-e]=(this.node3[14+s-e]|3<<o)^3<<o,this.updateNeighbor(s,e,!1),this.updatePointScore(s,e),this.updateScoreNode(s,e)}}minRepent(){this.stack.length>=2&&this.rollback(2)}isEmptyPosition(t,s){return!this.isWall(t,s)&&this.getChess(t,s)===T}getAllOptimalNextStep(){if(this.stack.length===0)return[[Z,Z]];if(this.stack.length===1){if(this.isEmptyPosition(Z,Z))return[[Z,Z]];const s=Z+(Math.random()>.5?1:-1),e=Z+(Math.random()>.5?1:-1);return[[s,e]]}let t=[];for(let s=0;s<m;s++)for(let e=0;e<m;e++)this.neighborNode[s][e]>0&&t.push([s,e]);return t}updateNeighbor(t,s,e){e?this.neighborNode[t][s]-=64:this.neighborNode[t][s]+=64;const i=2;for(let o=-i;o<=i;o++)if(!(o+t<0||o+t>=m))for(let n=-i;n<=i;n++)n+s<0||n+s>=m||o===0&&n===0||(e?this.neighborNode[o+t][s+n]+=1:this.neighborNode[o+t][s+n]-=1)}updateScoreNode(t,s){this.scoreNode[0][t]=this.evaluateOnlyLine(this.node0,t),this.scoreNode[1][s]=this.evaluateOnlyLine(this.node1,s),this.scoreNode[2][t+s]=this.evaluateOnlyLine(this.node2,t+s),this.scoreNode[3][14+t-s]=this.evaluateOnlyLine(this.node3,14+t-s)}getChess(t,s){return this.node0[t]>>2*(14-s)&3}getChessInFourDirection(t,s,e){if(e===0){const i=this.node0[t],o=s>=4?i>>2*(18-s)&3:3,n=s>=3?i>>2*(17-s)&3:3,r=s>=2?i>>2*(16-s)&3:3,h=s>=1?i>>2*(15-s)&3:3,c=i>>2*(14-s)&3,A=s<=13?i>>2*(13-s)&3:3,a=s<=12?i>>2*(12-s)&3:3,b=s<=11?i>>2*(11-s)&3:3,L=s<=10?i>>2*(10-s)&3:3;return[o,n,r,h,c,A,a,b,L]}else{let i;e===1?i=this.node1[s]:e===2?i=this.node2[t+s]:e===3&&(i=this.node3[14+t-s]);const o=t>=4?i>>2*(18-t)&3:3,n=t>=3?i>>2*(17-t)&3:3,r=t>=2?i>>2*(16-t)&3:3,h=t>=1?i>>2*(15-t)&3:3,c=i>>2*(14-t)&3,A=t<=13?i>>2*(13-t)&3:3,a=t<=12?i>>2*(12-t)&3:3,b=t<=11?i>>2*(11-t)&3:3,L=t<=10?i>>2*(10-t)&3:3;return[o,n,r,h,c,A,a,b,L]}}getPositionsInFourDirection(t,s){let e=[],i=[],o=[],n=[];const r=t-4>0?t-4:0,h=t+4<m-1?t+4:m-1,c=s-4>0?s-4:0,A=s+4<m-1?s+4:m-1;for(let a=c;a<=A;a++)e.push([t,a]);for(let a=r;a<=h;a++)i.push([a,s]);for(let a=4;a>0;a--)t-a>=r&&s+a<=A&&o.push([t-a,s+a]);o.push([t,s]);for(let a=1;a<=4;a++)t+a<=h&&s-a>=c&&o.push([t+a,s-a]);for(let a=4;a>0;a--)t-a>=r&&s-a>=c&&n.push([t-a,s-a]);n.push([t,s]);for(let a=1;a<=4;a++)t+a<=h&&s+a<=A&&n.push([t+a,s+a]);return[e,i,o,n]}updatePointScore(t,s){const e=this.getPositionsInFourDirection(t,s);for(let i=0;i<4;i++){const o=e[i];for(let n=0;n<o.length;n++){const[r,h]=o[n];if(this.getChess(r,h)!==T)this.maxPointsScore[r][h]=[0,0,0,0],this.minPointsScore[r][h]=[0,0,0,0];else{const c=this.getChessInFourDirection(r,h,i);this.maxPointsScore[r][h][i]=this.serialPointMode[xt(c)]||0,this.minPointsScore[r][h][i]=this.serialPointMode[Et(c)]||0}}}}saveStack(){console.log(JSON.stringify(this.stack))}restoreStack(t){const s=this.firstHand,e=s===N?V:N;this.rollback(this.stack.length);for(let i=0;i<t.length;i++){const[o,n]=t[i],r=i%2===0?s:e;this.put(o,n,r)}}get winner(){if(this.stack.length<7)return null;const[t,s]=this.stack[this.stack.length-1],e=this.getChess(t,s),i=[this.getChessInFourDirection(t,s,0),this.getChessInFourDirection(t,s,1),this.getChessInFourDirection(t,s,2),this.getChessInFourDirection(t,s,3)];for(let o=0;o<4;o++){let n=0;const r=i[o];let h;for(let c=0;c<r.length;c++)if(r[c]===e?n++:(n=0,h=r[c]),n===5||n===4&&h===T&&c+1<r.length&&r[c+1]===T)return e}return null}get winnerPositions(){const[t,s]=this.stack[this.stack.length-1],e=this.getChess(t,s),i=this.getPositionsInFourDirection(t,s);for(let o=0;o<4;o++){const n=i[o];let r=0,h=[],c;for(let A=0;A<n.length;A++){const[a,b]=n[A],L=this.getChess(a,b);if(L===e?(r++,h.push([a,b])):(r=0,h=[],c=L),r===5||r===4&&c===T&&A+1<n.length&&this.getChess(n[A+1][0],n[A+1][1])===T)return h}}return null}get isFinal(){return this.winner||this.isBoardFull}get isBoardFull(){return this.stack.length===m**2}get lastChessPosition(){return this.stack.length?this.stack[this.stack.length-1]:null}get isDraw(){return this.isBoardFull&&!this.winner}get node(){return this.node0.map(t=>{let s=[];for(let e=0;e<m;e++)s.push((t&3<<2*e)>>2*e);return s.reverse()})}printNode(){console.log(this.node0.map(t=>t.toString(2))),console.log(this.node1.map(t=>t.toString(2))),console.log(this.node2.map(t=>t.toString(2))),console.log(this.node3.map(t=>t.toString(2)))}initStats(){this.stats={abCut:{all:this.genLimit**this.seekDepth,eva:0,cut:0,toString(){const{all:t,eva:s,cut:e}=this.stats.abCut,i=t-s;return`AB剪枝 最大节点总数:${t} 理论最少评估${t**.5>>0} 实际评估:${s} 剪去:${e}/${i}`}},zobrist:{miss:0,hit:0,toString(){const{hit:t,miss:s}=this.stats.zobrist;return`zobrist 评估节点数:${this.stats.abCut.eva} hit:${t} miss:${s}`}}}}logStats(){this.enableStats&&Object.keys(this.stats).forEach(t=>{console.log(this.stats[t].toString.call(this))})}}W(B,"MAX",N),W(B,"MIN",V),W(B,"EMPTY",T),W(B,"WALL",j);const rt=()=>u("div",{className:"num",children:X(m).map(l=>u("div",{className:"item",children:l},l))});const at=()=>u("div",{className:"abc",children:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O"].map((l,t)=>u("div",{className:"item",children:t},l))}),Ct=()=>{const[l,t]=Q.useState(0);return Q.useEffect(()=>{const s=setInterval(()=>{t(e=>e+1)},1e3);return()=>clearInterval(s)},[]),u("div",{className:"",children:l.toFixed(1)})};function ut(){return new Worker("/gobang/dist/assets/worker-dec720cb.js")}const vt="data:audio/mpeg;base64,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",yt="/gobang/dist/assets/win-716cbc65.mp3",Nt="/gobang/dist/assets/fail-c60229d9.mp3",Pt="/gobang/dist/assets/draw-304f12b1.mp3",Ft={fall:vt,win:yt,fail:Nt,draw:Pt},Dt=({musics:l,onEnded:t})=>u(K,{children:l.map(s=>u("video",{src:Ft[s.value],onEnded:()=>t(s.id),autoPlay:!0,hidden:!0},s.id))});let f,D=new ut;const zt=({position:l,value:t,onClick:s,isLastChess:e,isMarkPoint:i,isWinnerPoint:o})=>{const n=f.stack.findIndex(r=>r[0]===l[0]&&r[1]===l[1]);return z("button",{className:`square ${e&&"lastChess"}`,onClick:s,children:[t!==B.EMPTY&&u("div",{className:["chess",t===f.firstHand?"black":"white",o?"pulse":""].join(" "),children:n+1||null}),i&&u("div",{className:"markPoint"})]})},Bt=({squares:l,onClick:t})=>{const s=f.lastChessPosition,e=f.winner,i=e?f.winnerPositions:null;return z("div",{className:"boardCenter",children:[u("div",{className:"rowLines",children:X(m).map(o=>u("div",{className:"item"},o))}),u("div",{className:"colLines",children:X(m).map(o=>u("div",{className:"item"},o))}),u("div",{className:"chesses",children:X(m).map(o=>u("div",{className:"boardRow",children:X(m).map(n=>u(zt,{position:[o,n],value:l[o][n],isLastChess:s&&s[0]===o&&s[1]===n,isWinnerPoint:i&&i.some(([r,h])=>r===o&&h===n),isMarkPoint:o===3&&n===3||o===3&&n===11||o===7&&n===7||o===11&&n===3||o===11&&n===11,onClick:()=>t(o,n)},n))},o))}),z("div",{className:"gameoverTip",children:[f.isDraw&&u("div",{className:"tip",children:"和棋~"}),e&&u("div",{className:"tip",children:e===f.firstHand?"黑方胜":"白方胜"})]})]})},Ut=()=>{const[l,t]=Q.useState(!1),[s,e]=Q.useReducer(d=>d+1,0),[i,o]=Q.useState(!1),[n,r]=Q.useState(!1),[h,c]=Q.useReducer((d,w)=>{const{type:x,value:R,id:I}=w;return x==="add"?[...d,{id:+new Date+Math.random(),value:R}]:x==="remove"?d.filter(E=>E.id!==I):[]},[]),A=f==null?void 0:f.isFinal,a=(d,w)=>{if(!l)return console.log({start:l});if(A)return console.log({isFinal:A});if(i)return console.log({thinking:i});if(n)return console.log({autoPlay:n});D.postMessage({type:"minGo",data:[d,w]})},b=()=>{o(!0),D.postMessage({type:"maxGo"})},L=()=>{D.terminate(),D=new ut,D.postMessage({type:"init",data:{}}),t(!1),r(!1)},v=(d,w)=>{t(!0),r(w),D.postMessage({type:"init",data:{firstHand:d,autoPlay:w,seekDepth:4}})},k=()=>{r(!0),D.postMessage({type:"init",data:{firstHand:B.MAX,autoPlay:!0,seekDepth:4}})},q=()=>{D.postMessage({type:"minRepent"})};return Q.useEffect(()=>{D.onmessage=d=>{const{type:w,gobang:x,data:R}=d.data;switch(f=JSON.parse(x),w){case"init":f.firstHand===B.MAX&&!f.autoPlay?b():e();break;case"minGo":R&&(c({type:"add",value:"fall"}),b());break;case"maxGo":c({type:"add",value:"fall"}),o(!1);break;case"autoPlay":c({type:"add",value:"fall"});break;default:e();break}}},[D]),Q.useEffect(()=>{f!=null&&f.isDraw&&c({type:"add",value:"draw"}),f!=null&&f.winner&&c({type:"add",value:f.winner===B.MAX?"fail":"win"})},[f==null?void 0:f.winner,f==null?void 0:f.isDraw]),Q.useEffect(()=>D.postMessage({type:"new Gobang"}),[]),f&&z("div",{className:"game",children:[u(Dt,{musics:h,onEnded:d=>c({type:"remove",id:d})}),z("div",{className:"gameInfo",children:[u(Ct,{}),u("div",{className:""})]}),z("div",{className:"gameBoard",children:[u(rt,{}),z("div",{className:"center",children:[u(at,{}),u(Bt,{squares:f.node,onClick:pt(a,20)}),u(at,{})]}),u(rt,{})]}),z("div",{className:"opbtns",children:[n&&u("button",{onClick:L,children:"开始游戏"}),!n&&!l&&z(K,{children:[u("button",{onClick:()=>v(B.MAX),children:"电脑先手"}),u("button",{onClick:()=>v(B.MIN),children:"玩家先手"}),u("button",{onClick:k,children:"电脑vs电脑"})]}),l&&z(K,{children:[u("button",{onClick:L,children:"重来"}),u("button",{onClick:q,children:"悔棋"})]})]}),z("div",{className:"game-info",children:[f.winner&&u("div",{children:f.winner===B.MAX?"少侠请努力":"干得漂亮"}),u("ol",{})]})]})},Qt=Ut;gt.createRoot(document.getElementById("root")).render(u(Qt,{}));
