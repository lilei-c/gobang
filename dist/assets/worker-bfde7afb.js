var Z=Object.defineProperty;var U=(t,e,n)=>e in t?Z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var V=(t,e,n)=>(U(t,typeof e!="symbol"?e+"":e,n),n);(function(){"use strict";const EMPTY=0,MAX=1,MIN=2,WALL=3,boardLength=15,boardCenter=7,l1$1=1,d2$1=8,l2$1=64,l2x2$1=128,d3$1=512,l3$1=4096,d4$1=16384,l4$1=65536,l5$1=262144,chessModeBit={l1:1,d2:8,l2:64,d3:512,l3:4096,d4:16384,l4:65536,l5:262144,l2x2:128},getPointMode=t=>({l1:t&7,d2:(t&56)>>3,l2:(t&960)>>6,d3:(t&7680)>>9,l3:(t&12288)>>12,d4:(t&49152)>>14,l4:(t&196608)>>16,l5:(t&786432)>>18}),Score={l1:10,d2:10,d3:200,l2:150,l2x2:300,l3:200,d4:2e3,l4:5e3,l5:1e4,win:1e5};console.warn("todo: 测试 countLine 是否正确");const countLine=(t,e,n)=>o=>{let i=1;for(let u=0;u<o.length;u++){const d=o[u];if(u<4)i<<=1,d===t?i+=1:(d===e||d===n)&&(i=1);else if(u===4)i<<=1,i+=1;else{if(d===e||d===n)break;i<<=1,d===t&&(i+=1)}}return i},generateAllModes=t=>{let e=[],n=2**(t+1);for(;n-- >0;)e.push("0b"+n.toString(2));return e},allModes=generateAllModes(11),isLive1=t=>/010/.test(t)&&t.length>5,isDead2=t=>/10{0,1}1/.test(t)&&t.length>=5,isLive2=t=>[/000110/,/001100/,/011000/,/001010/,/010100/].some(e=>e.test(t)),isLive2x2=t=>/0101010/.test(t),isDead3=t=>[/111/,/1011/,/1101/,/11001/,/10011/,/10101/].some(e=>e.test(t))&&t.length>=5,isLive3=t=>[/010110/,/011010/,/01110/,/1010101/].some(e=>e.test(t)),isDead4=t=>[/11110/,/01111/,/11011/,/11101/,/10111/].some(e=>e.test(t)),isLive4=t=>[/011110/,/1011101/,/11011011/,/111010111/].some(e=>e.test(t)),is5=t=>/1{5}/.test(t),stat={};allModes.forEach(t=>stat[t]=null);const serialPointMode=[];allModes.forEach(t=>isLive1(t.slice(3))&&(stat[t]="l1")&&(serialPointMode[+t]=1)),allModes.forEach(t=>isDead2(t.slice(3))&&(stat[t]="d2")&&(serialPointMode[+t]=8)),allModes.forEach(t=>isLive2(t.slice(3))&&(stat[t]="l2")&&(serialPointMode[+t]=64)),allModes.forEach(t=>isDead3(t.slice(3))&&(stat[t]="d3")&&(serialPointMode[+t]=512)),allModes.forEach(t=>isLive2x2(t.slice(3))&&(stat[t]="l2x2")&&(serialPointMode[+t]=128)),allModes.forEach(t=>isLive3(t.slice(3))&&(stat[t]="l3")&&(serialPointMode[+t]=4096)),allModes.forEach(t=>isDead4(t.slice(3))&&(stat[t]="d4")&&(serialPointMode[+t]=16384)),allModes.forEach(t=>isLive4(t.slice(3))&&(stat[t]="l4")&&(serialPointMode[+t]=65536)),allModes.forEach(t=>is5(t.slice(3))&&(stat[t]="l5")&&(serialPointMode[+t]=262144)),console.log("未构成棋型的组合, 这一部分已经验证",Object.keys(stat).filter(t=>!stat[t]).map(t=>t.slice(3))),console.warn("todo: 验证以下棋型是否正确"),Object.keys(Score).forEach(t=>{console.log(t,Object.keys(stat).filter(e=>stat[e]===t).map(e=>e.slice(3)))}),console.log({allModes,serialPointMode});const arrayN=(t,e=null)=>Array(t).fill(e),wait=t=>new Promise(e=>setTimeout(e,t));var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getAugmentedNamespace(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function o(){if(this instanceof o){var i=[null];i.push.apply(i,arguments);var u=Function.bind.apply(e,i);return new u}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(o){var i=Object.getOwnPropertyDescriptor(t,o);Object.defineProperty(n,o,i.get?i:{enumerable:!0,get:function(){return t[o]}})}),n}var aleaExports={},alea$1={get exports(){return aleaExports},set exports(t){aleaExports=t}};(function(t){(function(e,n,o){function i(r){var c=this,a=s();c.next=function(){var l=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=l-(c.c=l|0)},c.c=1,c.s0=a(" "),c.s1=a(" "),c.s2=a(" "),c.s0-=a(r),c.s0<0&&(c.s0+=1),c.s1-=a(r),c.s1<0&&(c.s1+=1),c.s2-=a(r),c.s2<0&&(c.s2+=1),a=null}function u(r,c){return c.c=r.c,c.s0=r.s0,c.s1=r.s1,c.s2=r.s2,c}function d(r,c){var a=new i(r),l=c&&c.state,h=a.next;return h.int32=function(){return a.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,l&&(typeof l=="object"&&u(l,a),h.state=function(){return u(a,{})}),h}function s(){var r=4022871197,c=function(a){a=String(a);for(var l=0;l<a.length;l++){r+=a.charCodeAt(l);var h=.02519603282416938*r;r=h>>>0,h-=r,h*=r,r=h>>>0,h-=r,r+=h*4294967296}return(r>>>0)*23283064365386963e-26};return c}n&&n.exports?n.exports=d:o&&o.amd?o(function(){return d}):this.alea=d})(commonjsGlobal,t,!1)})(alea$1);var xor128Exports={},xor128$1={get exports(){return xor128Exports},set exports(t){xor128Exports=t}};(function(t){(function(e,n,o){function i(s){var r=this,c="";r.x=0,r.y=0,r.z=0,r.w=0,r.next=function(){var l=r.x^r.x<<11;return r.x=r.y,r.y=r.z,r.z=r.w,r.w^=r.w>>>19^l^l>>>8},s===(s|0)?r.x=s:c+=s;for(var a=0;a<c.length+64;a++)r.x^=c.charCodeAt(a)|0,r.next()}function u(s,r){return r.x=s.x,r.y=s.y,r.z=s.z,r.w=s.w,r}function d(s,r){var c=new i(s),a=r&&r.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(h+f)/(1<<21);while(g===0);return g},l.int32=c.next,l.quick=l,a&&(typeof a=="object"&&u(a,c),l.state=function(){return u(c,{})}),l}n&&n.exports?n.exports=d:o&&o.amd?o(function(){return d}):this.xor128=d})(commonjsGlobal,t,!1)})(xor128$1);var xorwowExports={},xorwow$1={get exports(){return xorwowExports},set exports(t){xorwowExports=t}};(function(t){(function(e,n,o){function i(s){var r=this,c="";r.next=function(){var l=r.x^r.x>>>2;return r.x=r.y,r.y=r.z,r.z=r.w,r.w=r.v,(r.d=r.d+362437|0)+(r.v=r.v^r.v<<4^(l^l<<1))|0},r.x=0,r.y=0,r.z=0,r.w=0,r.v=0,s===(s|0)?r.x=s:c+=s;for(var a=0;a<c.length+64;a++)r.x^=c.charCodeAt(a)|0,a==c.length&&(r.d=r.x<<10^r.x>>>4),r.next()}function u(s,r){return r.x=s.x,r.y=s.y,r.z=s.z,r.w=s.w,r.v=s.v,r.d=s.d,r}function d(s,r){var c=new i(s),a=r&&r.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(h+f)/(1<<21);while(g===0);return g},l.int32=c.next,l.quick=l,a&&(typeof a=="object"&&u(a,c),l.state=function(){return u(c,{})}),l}n&&n.exports?n.exports=d:o&&o.amd?o(function(){return d}):this.xorwow=d})(commonjsGlobal,t,!1)})(xorwow$1);var xorshift7Exports={},xorshift7$1={get exports(){return xorshift7Exports},set exports(t){xorshift7Exports=t}};(function(t){(function(e,n,o){function i(s){var r=this;r.next=function(){var a=r.x,l=r.i,h,f;return h=a[l],h^=h>>>7,f=h^h<<24,h=a[l+1&7],f^=h^h>>>10,h=a[l+3&7],f^=h^h>>>3,h=a[l+4&7],f^=h^h<<7,h=a[l+7&7],h=h^h<<13,f^=h^h<<9,a[l]=f,r.i=l+1&7,f};function c(a,l){var h,f=[];if(l===(l|0))f[0]=l;else for(l=""+l,h=0;h<l.length;++h)f[h&7]=f[h&7]<<15^l.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],a.x=f,a.i=0,h=256;h>0;--h)a.next()}c(r,s)}function u(s,r){return r.x=s.x.slice(),r.i=s.i,r}function d(s,r){s==null&&(s=+new Date);var c=new i(s),a=r&&r.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(h+f)/(1<<21);while(g===0);return g},l.int32=c.next,l.quick=l,a&&(a.x&&u(a,c),l.state=function(){return u(c,{})}),l}n&&n.exports?n.exports=d:o&&o.amd?o(function(){return d}):this.xorshift7=d})(commonjsGlobal,t,!1)})(xorshift7$1);var xor4096Exports={},xor4096$1={get exports(){return xor4096Exports},set exports(t){xor4096Exports=t}};(function(t){(function(e,n,o){function i(s){var r=this;r.next=function(){var a=r.w,l=r.X,h=r.i,f,g;return r.w=a=a+1640531527|0,g=l[h+34&127],f=l[h=h+1&127],g^=g<<13,f^=f<<17,g^=g>>>15,f^=f>>>12,g=l[h]=g^f,r.i=h,g+(a^a>>>16)|0};function c(a,l){var h,f,g,v,w,k=[],F=128;for(l===(l|0)?(f=l,l=null):(l=l+"\0",f=0,F=Math.max(F,l.length)),g=0,v=-32;v<F;++v)l&&(f^=l.charCodeAt((v+32)%l.length)),v===0&&(w=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,v>=0&&(w=w+1640531527|0,h=k[v&127]^=f+w,g=h==0?g+1:0);for(g>=128&&(k[(l&&l.length||0)&127]=-1),g=127,v=4*128;v>0;--v)f=k[g+34&127],h=k[g=g+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,k[g]=f^h;a.w=w,a.X=k,a.i=g}c(r,s)}function u(s,r){return r.i=s.i,r.w=s.w,r.X=s.X.slice(),r}function d(s,r){s==null&&(s=+new Date);var c=new i(s),a=r&&r.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(h+f)/(1<<21);while(g===0);return g},l.int32=c.next,l.quick=l,a&&(a.X&&u(a,c),l.state=function(){return u(c,{})}),l}n&&n.exports?n.exports=d:o&&o.amd?o(function(){return d}):this.xor4096=d})(commonjsGlobal,t,!1)})(xor4096$1);var tycheiExports={},tychei$1={get exports(){return tycheiExports},set exports(t){tycheiExports=t}};(function(t){(function(e,n,o){function i(s){var r=this,c="";r.next=function(){var l=r.b,h=r.c,f=r.d,g=r.a;return l=l<<25^l>>>7^h,h=h-f|0,f=f<<24^f>>>8^g,g=g-l|0,r.b=l=l<<20^l>>>12^h,r.c=h=h-f|0,r.d=f<<16^h>>>16^g,r.a=g-l|0},r.a=0,r.b=0,r.c=-1640531527,r.d=1367130551,s===Math.floor(s)?(r.a=s/4294967296|0,r.b=s|0):c+=s;for(var a=0;a<c.length+20;a++)r.b^=c.charCodeAt(a)|0,r.next()}function u(s,r){return r.a=s.a,r.b=s.b,r.c=s.c,r.d=s.d,r}function d(s,r){var c=new i(s),a=r&&r.state,l=function(){return(c.next()>>>0)/4294967296};return l.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(h+f)/(1<<21);while(g===0);return g},l.int32=c.next,l.quick=l,a&&(typeof a=="object"&&u(a,c),l.state=function(){return u(c,{})}),l}n&&n.exports?n.exports=d:o&&o.amd?o(function(){return d}):this.tychei=d})(commonjsGlobal,t,!1)})(tychei$1);var seedrandomExports={},seedrandom$1={get exports(){return seedrandomExports},set exports(t){seedrandomExports=t}},__viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze({__proto__:null,default:__viteBrowserExternal}),require$$0=getAugmentedNamespace(__viteBrowserExternal$1);(function(t){(function(e,n,o){var i=256,u=6,d=52,s="random",r=o.pow(i,u),c=o.pow(2,d),a=c*2,l=i-1,h;function f(x,m,E){var M=[];m=m==!0?{entropy:!0}:m||{};var L=k(w(m.entropy?[x,G(n)]:x??F(),3),M),b=new g(M),_=function(){for(var P=b.g(u),S=r,N=0;P<c;)P=(P+N)*i,S*=i,N=b.g(1);for(;P>=a;)P/=2,S/=2,N>>>=1;return(P+N)/S};return _.int32=function(){return b.g(4)|0},_.quick=function(){return b.g(4)/4294967296},_.double=_,k(G(b.S),n),(m.pass||E||function(P,S,N,A){return A&&(A.S&&v(A,b),P.state=function(){return v(b,{})}),N?(o[s]=P,S):P})(_,L,"global"in m?m.global:this==o,m.state)}function g(x){var m,E=x.length,M=this,L=0,b=M.i=M.j=0,_=M.S=[];for(E||(x=[E++]);L<i;)_[L]=L++;for(L=0;L<i;L++)_[L]=_[b=l&b+x[L%E]+(m=_[L])],_[b]=m;(M.g=function(P){for(var S,N=0,A=M.i,y=M.j,p=M.S;P--;)S=p[A=l&A+1],N=N*i+p[l&(p[A]=p[y=l&y+S])+(p[y]=S)];return M.i=A,M.j=y,N})(i)}function v(x,m){return m.i=x.i,m.j=x.j,m.S=x.S.slice(),m}function w(x,m){var E=[],M=typeof x,L;if(m&&M=="object")for(L in x)try{E.push(w(x[L],m-1))}catch{}return E.length?E:M=="string"?x:x+"\0"}function k(x,m){for(var E=x+"",M,L=0;L<E.length;)m[l&L]=l&(M^=m[l&L]*19)+E.charCodeAt(L++);return G(m)}function F(){try{var x;return h&&(x=h.randomBytes)?x=x(i):(x=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(x)),G(x)}catch{var m=e.navigator,E=m&&m.plugins;return[+new Date,e,E,e.screen,G(n)]}}function G(x){return String.fromCharCode.apply(0,x)}if(k(o.random(),n),t.exports){t.exports=f;try{h=require$$0}catch{}}else o["seed"+s]=f})(typeof self<"u"?self:commonjsGlobal,[],Math)})(seedrandom$1);var alea=aleaExports,xor128=xor128Exports,xorwow=xorwowExports,xorshift7=xorshift7Exports,xor4096=xor4096Exports,tychei=tycheiExports,sr=seedrandomExports;sr.alea=alea,sr.xor128=xor128,sr.xorwow=xorwow,sr.xorshift7=xorshift7,sr.xor4096=xor4096,sr.tychei=tychei;var seedrandom=sr;function _defineProperties(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,_toPropertyKey(o.key),o)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,i){return o.__proto__=i,o},_setPrototypeOf(t,e)}function _toPrimitive(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var o=n.call(t,e||"default");if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return typeof e=="symbol"?e:String(e)}var RNG=function(){function t(){}var e=t.prototype;return e._seed=function(o,i){if(o===(o||0))return o;for(var u=""+o,d=0,s=0;s<u.length;++s)d^=u.charCodeAt(s)|0;return d},t}(),RNGFunction=function(t){_inheritsLoose(e,t);function e(o,i){var u;return u=t.call(this)||this,u._rng=void 0,u.seed(o,i),u}var n=e.prototype;return n.next=function(){return this._rng()},n.seed=function(i,u){this._rng=i},n.clone=function(i,u){return new e(this._rng,u)},_createClass(e,[{key:"name",get:function(){return"function"}}]),e}(RNG),RNGFactory=function(){var t=[].slice.call(arguments),e=t,n=e[0],o=n===void 0?"default":n;switch(typeof o){case"object":if(o instanceof RNG)return o;break;case"function":return new RNGFunction(o);case"number":case"string":default:return new RNGFunction(seedrandom.apply(void 0,t))}throw new Error('invalid RNG "'+o+'"')},uniform=function(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=1),function(){return t.next()*(n-e)+e}};function numberValidator(t){return new NumberValidator(t)}var NumberValidator=function(e){var n=this;this.n=void 0,this.isInt=function(){if(Number.isInteger(n.n))return n;throw new Error("Expected number to be an integer, got "+n.n)},this.isPositive=function(){if(n.n>0)return n;throw new Error("Expected number to be positive, got "+n.n)},this.lessThan=function(o){if(n.n<o)return n;throw new Error("Expected number to be less than "+o+", got "+n.n)},this.greaterThanOrEqual=function(o){if(n.n>=o)return n;throw new Error("Expected number to be greater than or equal to "+o+", got "+n.n)},this.greaterThan=function(o){if(n.n>o)return n;throw new Error("Expected number to be greater than "+o+", got "+n.n)},this.n=e},uniformInt=function(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=1),n===void 0&&(n=e===void 0?1:e,e=0),numberValidator(e).isInt(),numberValidator(n).isInt(),function(){return Math.floor(t.next()*(n-e+1)+e)}},uniformBoolean=function(t){return function(){return t.next()>=.5}},normal=function(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=1),function(){var o,i,u;do o=t.next()*2-1,i=t.next()*2-1,u=o*o+i*i;while(!u||u>1);return e+n*i*Math.sqrt(-2*Math.log(u)/u)}},logNormal=function(t,e,n){e===void 0&&(e=0),n===void 0&&(n=1);var o=t.normal(e,n);return function(){return Math.exp(o())}},bernoulli=function(t,e){return e===void 0&&(e=.5),numberValidator(e).greaterThanOrEqual(0).lessThan(1),function(){return Math.floor(t.next()+e)}},binomial=function(t,e,n){return e===void 0&&(e=1),n===void 0&&(n=.5),numberValidator(e).isInt().isPositive(),numberValidator(n).greaterThanOrEqual(0).lessThan(1),function(){for(var o=0,i=0;o++<e;)t.next()<n&&i++;return i}},geometric=function(t,e){e===void 0&&(e=.5),numberValidator(e).greaterThan(0).lessThan(1);var n=1/Math.log(1-e);return function(){return Math.floor(1+Math.log(t.next())*n)}},logFactorialTable=[0,0,.6931471805599453,1.791759469228055,3.1780538303479458,4.787491742782046,6.579251212010101,8.525161361065415,10.60460290274525,12.801827480081469],logFactorial=function(e){return logFactorialTable[e]},logSqrt2PI=.9189385332046727,poisson=function(t,e){if(e===void 0&&(e=1),numberValidator(e).isPositive(),e<10){var n=Math.exp(-e);return function(){for(var r=n,c=0,a=t.next();a>r;)a=a-r,r=e*r/++c;return c}}else{var o=Math.sqrt(e),i=.931+2.53*o,u=-.059+.02483*i,d=1.1239+1.1328/(i-3.4),s=.9277-3.6224/(i-2);return function(){for(;;){var r=void 0,c=t.next();if(c<=.86*s)return r=c/s-.43,Math.floor((2*u/(.5-Math.abs(r))+i)*r+e+.445);c>=s?r=t.next()-.5:(r=c/s-.93,r=(r<0?-.5:.5)-r,c=t.next()*s);var a=.5-Math.abs(r);if(!(a<.013&&c>a)){var l=Math.floor((2*u/a+i)*r+e+.445);if(c=c*d/(u/(a*a)+i),l>=10){var h=(l+.5)*Math.log(e/l)-e-logSqrt2PI+l-(.08333333333333333-(.002777777777777778-1/(1260*l*l))/(l*l))/l;if(Math.log(c*o)<=h)return l}else if(l>=0){var f,g=(f=logFactorial(l))!=null?f:0;if(Math.log(c)<=l*Math.log(e)-e-g)return l}}}}}},exponential=function(t,e){return e===void 0&&(e=1),numberValidator(e).isPositive(),function(){return-Math.log(1-t.next())/e}},irwinHall=function(t,e){return e===void 0&&(e=1),numberValidator(e).isInt().greaterThanOrEqual(0),function(){for(var n=0,o=0;o<e;++o)n+=t.next();return n}},bates=function(t,e){e===void 0&&(e=1),numberValidator(e).isInt().isPositive();var n=t.irwinHall(e);return function(){return n()/e}},pareto=function(t,e){e===void 0&&(e=1),numberValidator(e).greaterThanOrEqual(0);var n=1/e;return function(){return 1/Math.pow(1-t.next(),n)}},RNGMathRandom=function(t){_inheritsLoose(e,t);function e(){return t.apply(this,arguments)||this}var n=e.prototype;return n.next=function(){return Math.random()},n.seed=function(i,u){},n.clone=function(){return new e},_createClass(e,[{key:"name",get:function(){return"default"}}]),e}(RNG),Random=function(){function t(n){var o=this;this._rng=void 0,this._patch=void 0,this._cache={},this.next=function(){return o._rng.next()},this.float=function(i,u){return o.uniform(i,u)()},this.int=function(i,u){return o.uniformInt(i,u)()},this.integer=function(i,u){return o.uniformInt(i,u)()},this.bool=function(){return o.uniformBoolean()()},this.boolean=function(){return o.uniformBoolean()()},this.uniform=function(i,u){return o._memoize("uniform",uniform,i,u)},this.uniformInt=function(i,u){return o._memoize("uniformInt",uniformInt,i,u)},this.uniformBoolean=function(){return o._memoize("uniformBoolean",uniformBoolean)},this.normal=function(i,u){return normal(o,i,u)},this.logNormal=function(i,u){return logNormal(o,i,u)},this.bernoulli=function(i){return bernoulli(o,i)},this.binomial=function(i,u){return binomial(o,i,u)},this.geometric=function(i){return geometric(o,i)},this.poisson=function(i){return poisson(o,i)},this.exponential=function(i){return exponential(o,i)},this.irwinHall=function(i){return irwinHall(o,i)},this.bates=function(i){return bates(o,i)},this.pareto=function(i){return pareto(o,i)},n&&n instanceof RNG?this.use(n):this.use(new RNGMathRandom),this._cache={}}var e=t.prototype;return e.clone=function(){var o=[].slice.call(arguments);return o.length?new t(RNGFactory.apply(void 0,o)):new t(this.rng.clone())},e.use=function(){this._rng=RNGFactory.apply(void 0,[].slice.call(arguments))},e.patch=function(){if(this._patch)throw new Error("Math.random already patched");this._patch=Math.random,Math.random=this.uniform()},e.unpatch=function(){this._patch&&(Math.random=this._patch,delete this._patch)},e.choice=function(o){if(!Array.isArray(o))throw new Error("Random.choice expected input to be an array, got "+typeof o);var i=o==null?void 0:o.length;if(i>0){var u=this.uniformInt(0,i-1)();return o[u]}else return},e._memoize=function(o,i){var u=[].slice.call(arguments,2),d=""+u.join(";"),s=this._cache[o];return(s===void 0||s.key!==d)&&(s={key:d,distribution:i.apply(void 0,[this].concat(u))},this._cache[o]=s),s.distribution},_createClass(t,[{key:"rng",get:function(){return this._rng}}]),t}(),random=new Random;class Zobrist{constructor({size:e}){this.max=arrayN(e).map(o=>arrayN(e).map(()=>random.int(0,1073741824))),this.min=arrayN(e).map(o=>arrayN(e).map(()=>random.int(0,1073741824))),this.code=random.int(0,1073741824),this.hash={}}go(e,n,o){this.code^=o?this.max[e][n]:this.min[e][n]}get(){return this.hash[this.code]}set(e){this.hash[this.code]=e}resetHash(){this.hash={}}}const{l1,d2,l2,l2x2,d3,l3,d4,l4,l5}=chessModeBit;function evaluate(t,e){const n=this.winner;if(n===1)return Score.win;if(n===2)return-Score.win;if(t)return 0;let o=0,i=0,u=0,d=0,s=0,r=0,c=0,a=0,l=0,h=0,f=0,g=0,v=0,w=0,k=0,F=0;const G=(b,_)=>{if(_<34)return;const P=serialPointMode[_];if(P)if(b===1)switch(P){case l1:return a++;case d2:return c++;case l2:return r++;case l2x2:return r+=2;case d3:return s++;case l3:return d++;case d4:return u++;case l4:return i++;case l5:return o++;default:return console.error("error")}else switch(P){case l1:return F++;case d2:return k++;case l2:return w++;case l2x2:return w+=2;case d3:return v++;case l3:return g++;case d4:return f++;case l4:return h++;case l5:return l++;default:return console.error("error")}},x=(b,_,P)=>{let S=1,N=0,A=!1;for(let y=0;y<15;y++){const p=P&3;if(P>>=2,p===_||p===3){G(b,S),S=1,A=!0;continue}else if(p===0)if(N===0)N++,S<<=1;else{S<<=1,!(P&12)&&y!==14&&(S<<=1),G(b,S),S=4,!(P&12)&&y!==14&&(S<<=1),N=0,A=!0;continue}else N=0,A=!1,S<<=1,S+=1}A||G(b,S)};for(let b=0;b<this.node0.length;b++)x(1,2,this.node0[b]);for(let b=0;b<this.node1.length;b++)x(1,2,this.node1[b]);for(let b=0;b<this.node2.length;b++)x(1,2,this.node2[b]);for(let b=0;b<this.node3.length;b++)x(1,2,this.node3[b]);for(let b=0;b<this.node0.length;b++)x(2,1,this.node0[b]);for(let b=0;b<this.node1.length;b++)x(2,1,this.node1[b]);for(let b=0;b<this.node2.length;b++)x(2,1,this.node2[b]);for(let b=0;b<this.node3.length;b++)x(2,1,this.node3[b]);e&&(console.log({maxL1:a,maxD2:c,maxL2:r,maxD3:s,maxL3:d,maxD4:u,maxL4:i,maxL5:o}),console.log({minL1:F,minD2:k,minL2:w,minD3:v,minL3:g,minD4:f,minL4:h,minL5:l}));let m=0,E=0;if((this.seekDepth&1)===0){if(i||u)return Score.l5;if(h||g&f)return-Score.l5;d&&(h||(m+=Score.l4),d>1&&(m+=Score.l3*2))}else{if(h||f)return-Score.l5;if(i||d&u)return Score.l5;g&&(i||(E+=Score.l4),g>1&&(E+=Score.l3*2))}return r>2&&(m+=Score.l2),w>2&&(E+=Score.l2),m=Score.l5*o+Score.l4*i+Score.d4*u+Score.l3*d+Score.d3*s+Score.l2*r+Score.d2*c+Score.l1*c,E=Score.l5*l+Score.l4*h+Score.d4*f+Score.l3*g+Score.d3*v+Score.l2*w+Score.d2*k+Score.l1*k,m*this.attackFactor-E*this.defenseFactor}function genChilds(t,e,n){let o=[],i=[],u=[],d=[],s=[],r=[],c=[],a=[],l=[],h=[],f=[],g=[],v=[],w=[],k=[],F=[],G=[],x=[],m=[],E=[],M=[],L=[],b=[],_=[],P=[],S=[],N=[],A=[];for(let y=0;y<t.length;y++){const p=t[y],[X,T]=p;let $=getPointMode(this.maxPointsScore[X][T][0]);const D=getPointMode(this.maxPointsScore[X][T][1]),C=getPointMode(this.maxPointsScore[X][T][2]),j=getPointMode(this.maxPointsScore[X][T][3]);$.l5+=D.l5+C.l5+j.l5,$.l4+=D.l4+C.l4+j.l4,$.d4+=D.d4+C.d4+j.d4,$.l3+=D.l3+C.l3+j.l3,$.d3+=D.d3+C.d3+j.d3,$.l2+=D.l2+C.l2+j.l2,$.d2+=D.d2+C.d2+j.d2,$.l1+=D.l1+C.l1+j.l1;const{l5:O,l4:Y,d4:W,l3:z,d3:R,l2:B,d2:q,l1:H}=$;O?o.push(p):Y?u.push(p):z&&W?b.push(p):z>1?M.push(p):B>2?N.push(p):z?c.push(p):B>1?P.push(p):W?s.push(p):B?f.push(p):R?l.push(p):q?v.push(p):H===4?k.push(p):H===3?G.push(p):m.push(p)}for(let y=0;y<t.length;y++){const p=t[y],[X,T]=p;let $=getPointMode(this.minPointsScore[X][T][0]);const D=getPointMode(this.minPointsScore[X][T][1]),C=getPointMode(this.minPointsScore[X][T][2]),j=getPointMode(this.minPointsScore[X][T][3]),O={...$};O.l5+=$.l5+D.l5+C.l5+j.l5,O.l4+=$.l4+D.l4+C.l4+j.l4,O.d4+=$.d4+D.d4+C.d4+j.d4,O.l3+=$.l3+D.l3+C.l3+j.l3,O.d3+=$.d3+D.d3+C.d3+j.d3,O.l2+=$.l2+D.l2+C.l2+j.l2,O.d2+=$.d2+D.d2+C.d2+j.d2,O.l1+=$.l1+D.l1+C.l1+j.l1;const{l5:Y,l4:W,d4:z,l3:R,d3:B,l2:q,d2:H,l1:K}=O;Y?i.push(p):W?d.push(p):R&&z?_.push(p):R>1?L.push(p):q>2?A.push(p):R?a.push(p):q>1?S.push(p):z?r.push(p):q?g.push(p):B?h.push(p):H?w.push(p):K===4?F.push(p):K===3?x.push(p):E.push(p)}if(e){if(n)return o.length?o:i.length?[]:u.length?u:b.length||s.length?b.concat(s):d.length||r.length?[]:M.length?M:c.length?c:[];if(o.length)return o;if(i.length)return i;if(u.length)return u;if(d.length)return d;const y=b.concat(_).concat(M).concat(L).concat(N).concat(A).concat(c).concat(a).concat(P).concat(S).concat(s).concat(r).concat(l).concat(h).concat(f).concat(g).concat(k).concat(G).concat(v).concat(w).concat(m);return y.length<=this.genLimit?y:y.slice(0,this.genLimit)}else{if(i.length)return i;if(o.length)return o;if(d.length)return d;if(u.length)return u;const y=_.concat(b).concat(L).concat(M).concat(A).concat(N).concat(a).concat(c).concat(S).concat(P).concat(r).concat(s).concat(h).concat(l).concat(g).concat(f).concat(F).concat(x).concat(w).concat(v).concat(E);return y.sort((p,X)=>p[0]-X[0]),y.length<=this.genLimit?y:y.slice(0,this.genLimit)}}class Gobang{constructor(t){this.init({...t})}init({firstHand:t,seekDepth:e,autoPlay:n,enableStats:o,attackFactor:i,defenseFactor:u}){this.totalChessPieces=15*15,this.initNode(),this.stack=[],this.zobrist=new Zobrist({size:15}),this.maxPointsScore=arrayN(15).map(d=>arrayN(15,[0,0,0,0])),this.minPointsScore=arrayN(15).map(d=>arrayN(15,[0,0,0,0])),this.stats={},this.enableStats=o!==void 0?o:!0,this.enableLog=!1,this.firstHand=t||2,this.genLimit=60,this.seekDepth=e||4,this.seekKillDepth=17,this.autoPlay=n,this.attackFactor=i||1,this.defenseFactor=u||2}isWall(t,e){return t<0||t>=15||e<0||e>=15}initNode(){this.node0=arrayN(15,0);const t=new ArrayBuffer(4*15);this.node1=new Int32Array(t);for(let e=0;e<=14;e++)this.node1[e]=0;this.node2=[];for(let e=0;e<15*2-1;e++){let n=0;for(let o=0;o<15;o++){const i=e-o;n<<=2,this.isWall(o,i)&&(n+=3)}this.node2[e]=n}this.node3=[];for(let e=0;e<15*2-1;e++){let n=0;for(let o=0;o<15;o++){const i=14+o-e;n<<=2,this.isWall(o,i)&&(n+=3)}this.node3[e]=n}}put(t,e,n){this.zobrist.go(t,e,n===1),this.stack.push([t,e]),this.node0[t]=this.node0[t]|n<<2*(14-e),this.node1[e]=this.node1[e]|n<<2*(14-t),this.node2[t+e]=this.node2[t+e]|n<<2*(14-t),this.node3[14+t-e]=this.node3[14+t-e]|n<<2*(14-t),this.updateFourLineScore(t,e)}rollback(t=1){if(!(this.stack.length<t))for(;t-- >0;){const[e,n]=this.stack.pop();this.zobrist.go(e,n,this.getChess(e,n)===1);const o=2*(14-n);this.node0[e]=(this.node0[e]|3<<o)^3<<o;const i=2*(14-e);this.node1[n]=(this.node1[n]|3<<i)^3<<i,this.node2[e+n]=(this.node2[e+n]|3<<i)^3<<i,this.node3[14+e-n]=(this.node3[14+e-n]|3<<i)^3<<i,this.updateFourLineScore(e,n)}}maxGo(){if(this.isFinal)return;this.zobrist.resetHash(),this.initStats();let t;this.stack.length>4&&(console.time("thinking kill"),t=this.minimax(this.seekKillDepth,!0),console.timeEnd("thinking kill")),(t==null?void 0:t.score)>=Score.win?console.warn("算杀成功 :)"):(console.time("thinking"),t=this.minimax(this.seekDepth),console.timeEnd("thinking"));const{i:e,j:n}=t;return this.put(e,n,1),this.logStats(),t}minGo(t,e){if(!this.isFinal)return this.isEmptyPosition(t,e)?(this.put(t,e,2),!0):!1}minRepent(){this.stack.length>=2&&this.rollback(2)}isEmptyPosition(t,e){return!this.isWall(t,e)&&this.getChess(t,e)===0}getNearPositions(t){const e=[],[o,i]=t;for(let u=-2;u<=2;u++)for(let d=-2;d<=2;d++)this.isEmptyPosition(u+o,d+i)&&e.push([u+o,d+i]);return e}getAllOptimalNextStep(){if(this.stack.length===0)return[[7,7]];if(this.stack.length===1){if(this.isEmptyPosition(7,7))return[[7,7]];const e=7+(Math.random()>.5?1:-1),n=7+(Math.random()>.5?1:-1);return[[e,n]]}let t=[];for(let e=0;e<15;e++)for(let n=0;n<15;n++)this.getChess(e,n)===0&&this.haveNeighbor(e,n)&&t.push([e,n]);return t}haveNeighbor(t,e){for(let o=-2;o<=2;o++)if(!(o+t<0||o+t>=15))for(let i=-2;i<=2;i++){if(i+e<0||i+e>=15||o===0&&i===0)continue;if(this.getChess(o+t,e+i)!==0)return!0}return!1}getChess(t,e){return this.node0[t]>>2*(14-e)&3}minimax(t,e,n=-1/0,o=1/0,i=!0){if(this.isFinal||t===0)return{score:evaluate.call(this,e),depth:t};const u=genChilds.call(this,this.getAllOptimalNextStep(),i,e);if(!(u!=null&&u.length))return{score:0};if(i){let d=-1/0,s=u[0];for(const a of u){const[l,h]=a;this.put(l,h,1),this.enableStats&&this.stats.abCut.eva++;let f=this.zobrist.get();if(f===void 0?(f=this.minimax(t-1,e,n,o,!i).score,this.zobrist.set(f),this.enableStats&&this.stats.zobrist.miss++):this.enableStats&&this.stats.zobrist.hit++,this.rollback(),f>d&&(d=f,s=a),n=Math.max(n,d),o<=n){this.enableStats&&this.stats.abCut.cut++;break}}const[r,c]=s;return{score:d,i:r,j:c}}else{let d=1/0,s=u[0];for(const a of u){const[l,h]=a;this.put(l,h,2),this.enableStats&&this.stats.abCut.eva++;let f=this.zobrist.get();if(f===void 0?(f=this.minimax(t-1,e,n,o,!i).score,this.zobrist.set(f),this.enableStats&&this.stats.zobrist.miss++):this.enableStats&&this.stats.zobrist.hit++,this.rollback(),f<d&&(d=f,s=a),o=Math.min(o,d),o<=n){this.enableStats&&this.stats.abCut.cut++;break}}const[r,c]=s;return{score:d,i:r,j:c}}}getChessInFourDirection(t,e,n){let o=[],i=[],u=[],d=[];if(n===void 0||n===0){const s=this.node0[t],r=e>=4?s>>2*(18-e)&3:3,c=e>=3?s>>2*(17-e)&3:3,a=e>=2?s>>2*(16-e)&3:3,l=e>=1?s>>2*(15-e)&3:3,h=s>>2*(14-e)&3,f=e<=13?s>>2*(13-e)&3:3,g=e<=12?s>>2*(12-e)&3:3,v=e<=11?s>>2*(11-e)&3:3,w=e<=10?s>>2*(10-e)&3:3;if(o=[r,c,a,l,h,f,g,v,w],n===0)return o}if(n===void 0||n===1){const s=this.node1[e],r=t>=4?s>>2*(18-t)&3:3,c=t>=3?s>>2*(17-t)&3:3,a=t>=2?s>>2*(16-t)&3:3,l=t>=1?s>>2*(15-t)&3:3,h=s>>2*(14-t)&3,f=t<=13?s>>2*(13-t)&3:3,g=t<=12?s>>2*(12-t)&3:3,v=t<=11?s>>2*(11-t)&3:3,w=t<=10?s>>2*(10-t)&3:3;if(i=[r,c,a,l,h,f,g,v,w],n===1)return i}if(n===void 0||n===2){const s=this.node2[t+e],r=t>=4?s>>2*(18-t)&3:3,c=t>=3?s>>2*(17-t)&3:3,a=t>=2?s>>2*(16-t)&3:3,l=t>=1?s>>2*(15-t)&3:3,h=s>>2*(14-t)&3,f=t<=13?s>>2*(13-t)&3:3,g=t<=12?s>>2*(12-t)&3:3,v=t<=11?s>>2*(11-t)&3:3,w=t<=10?s>>2*(10-t)&3:3;if(u=[r,c,a,l,h,f,g,v,w],n===2)return u}if(n===void 0||n===3){const s=this.node3[14+t-e],r=t>=4?s>>2*(18-t)&3:3,c=t>=3?s>>2*(17-t)&3:3,a=t>=2?s>>2*(16-t)&3:3,l=t>=1?s>>2*(15-t)&3:3,h=s>>2*(14-t)&3,f=t<=13?s>>2*(13-t)&3:3,g=t<=12?s>>2*(12-t)&3:3,v=t<=11?s>>2*(11-t)&3:3,w=t<=10?s>>2*(10-t)&3:3;if(d=[r,c,a,l,h,f,g,v,w],n===3)return d}return[o,i,u,d]}getPositionsInFourDirection(t,e){let n=[],o=[],i=[],u=[];const d=t-4>0?t-4:0,s=t+4<15-1?t+4:15-1,r=e-4>0?e-4:0,c=e+4<15-1?e+4:15-1;for(let a=r;a<=c;a++)n.push([t,a]);for(let a=d;a<=s;a++)o.push([a,e]);for(let a=4;a>0;a--)t-a>=d&&e+a<=c&&i.push([t-a,e+a]);i.push([t,e]);for(let a=1;a<=4;a++)t+a<=s&&e-a>=r&&i.push([t+a,e-a]);for(let a=4;a>0;a--)t-a>=d&&e-a>=r&&u.push([t-a,e-a]);u.push([t,e]);for(let a=1;a<=4;a++)t+a<=s&&e+a<=c&&u.push([t+a,e+a]);return[n,o,i,u]}updateFourLineScore(t,e){const n=this.getPositionsInFourDirection(t,e);for(let o=0;o<4;o++){const i=n[o];for(let u=0;u<i.length;u++){const d=i[u];this.updatePointScore(d,o)}}}updatePointScore(t,e){const[n,o]=t;this.getChess(n,o)!==0?(this.maxPointsScore[n][o]=[0,0,0,0],this.minPointsScore[n][o]=[0,0,0,0]):(this.maxPointsScore[n][o][e]=this.evaPoint(n,o,1,e),this.minPointsScore[n][o][e]=this.evaPoint(n,o,2,e))}evaPoint(t,e,n,o){const i=this.getChessInFourDirection(t,e,o),s=countLine(n===1?1:2,n===1?2:1,3);let r=0;const c=s(i),a=serialPointMode[c];return r+=a||0,r}test(data){eval(data)}get winner(){if(this.stack.length<7)return null;const[t,e]=this.stack[this.stack.length-1],n=this.getChess(t,e),o=this.getChessInFourDirection(t,e);for(let i=0;i<4;i++){let u=0;const d=o[i];for(let s=0;s<d.length;s++)if(d[s]===n?u++:u=0,u===5)return n}return null}get winnerPositions(){if(!this.winner)return null;const[t,e]=this.stack[this.stack.length-1],n=this.getChess(t,e),o=this.getPositionsInFourDirection(t,e);for(let i=0;i<4;i++){const u=o[i];let d=0,s=[];for(let r=0;r<u.length;r++){const[c,a]=u[r];if(this.getChess(c,a)===n?(d++,s.push([c,a])):(d=0,s=[]),d===5)return s}}return null}get isFinal(){return!!this.winner||this.isBoardFull}get isBoardFull(){return this.stack.length===this.totalChessPieces}get lastChessPosition(){return this.stack.length?this.stack[this.stack.length-1]:null}get isDraw(){return this.isBoardFull&&!this.winner}get node(){return this.node0.map(t=>{let e=[];for(let n=0;n<15;n++)e.push((t&3<<2*n)>>2*n);return e.reverse()})}printNode(){console.log(this.node0.map(t=>t.toString(2))),console.log(this.node1.map(t=>t.toString(2))),console.log(this.node2.map(t=>t.toString(2))),console.log(this.node3.map(t=>t.toString(2)))}initStats(){this.stats={abCut:{all:this.genLimit**this.seekDepth,eva:0,cut:0,toString(){const{all:t,eva:e,cut:n}=this.stats.abCut,o=t-e;return`AB剪枝 最大节点总数:${t} 理论最少评估${t**.5>>0} 实际评估:${e} 剪去:${n}/${o}`}},zobrist:{miss:0,hit:0,toString(){const{hit:t,miss:e}=this.stats.zobrist;return`zobrist 评估节点数:${this.stats.abCut.eva} hit:${t} miss:${e}`}}}}logStats(){this.enableStats&&Object.keys(this.stats).forEach(t=>{console.log(this.stats[t].toString.call(this))})}}V(Gobang,"MAX",1),V(Gobang,"MIN",2),V(Gobang,"EMPTY",0),V(Gobang,"WALL",3);const gobang=new Gobang;onmessage=async function(t){const{type:e,data:n}=t.data;let o;switch(e){case"init":gobang.init(n),gobang.autoPlay&&autoPlayWithSelf();break;case"maxGo":o=gobang.maxGo();break;case"minGo":o=gobang.minGo(...n);break;case"minRepent":o=gobang.minRepent();break;case"test":o=gobang.test(n);break}senMessage(e,o)};const senMessage=(t,e)=>postMessage({type:t,data:e,gobang:JSON.stringify({...gobang,node:gobang.node,stack:gobang.stack,firstHand:gobang.firstHand,lastChessPosition:gobang.lastChessPosition,winnerPositions:gobang.winnerPositions,isDraw:gobang.isDraw,winner:gobang.winner,isFinal:gobang.isFinal})}),autoPlayWithSelf=async()=>{const t=new Gobang({firstHand:Gobang.MIN,seekDepth:2,defenseFactor:4});for(t.sss;gobang.autoPlay;){const{i:e,j:n}=gobang.maxGo();t.minGo(e,n),senMessage("autoPlay"),await wait(1e3);const{i:o,j:i}=t.maxGo();gobang.minGo(o,i),senMessage("autoPlay"),await wait(1e3)}}})();
