var D=Object.defineProperty;var B=(t,s,e)=>s in t?D(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e;var N=(t,s,e)=>(B(t,typeof s!="symbol"?s+"":s,e),e);import{j as jsxRuntimeExports,r as random,a as reactExports,c as client}from"./vendor-cd7d93c1.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();const Fragment=jsxRuntimeExports.Fragment,jsx=jsxRuntimeExports.jsx,jsxs=jsxRuntimeExports.jsxs,EMPTY=0,MAX=1,MIN=2,WALL=3,boardLength=15,boardCenter=boardLength/2>>0,arrayN=(t,s=null)=>Array(t).fill(s),debounce=(t,s=20)=>{let e=+new Date;return(...o)=>{+new Date-e>s&&t(...o),e=+new Date}},range=t=>s=>Array(s-t).fill(null).map((e,o)=>t+o),range0=range(0),chessModeBit={l1:2**0,d2:2**3,l2:2**6,l2x2:2**7,d3:2**9,l3:2**12,d4:2**14,l4:2**16,l5:2**18},getPointMode=t=>({l1:t&7,d2:(t&56)>>3,l2:(t&960)>>6,d3:(t&7680)>>9,l3:(t&12288)>>12,d4:(t&49152)>>14,l4:(t&196608)>>16,l5:(t&786432)>>18}),Score={l1:10,d2:10,d3:200,l2:150,l2x2:300,l3:200,d4:2e3,l4:5e3,l5:1e4,win:1e5},calcEvaPointScore=t=>{const{l5:s,l4:e,d4:o,l3:i,d3:n,l2:r,d2:l,l1:d}=t;let h=0;return s&&(h+=Score.l5*s),e&&(h+=Score.l4*e),o&&(h+=Score.d4*o),i&&(h+=Score.l3*i),n&&(h+=Score.d3*n),r&&(h+=Score.l2*r),l&&(h+=Score.d2*l),d&&(h+=Score.l1*d),h};console.warn("todo: 测试 countLine 是否正确");const countLine=(t,s,e)=>o=>{let i=1;for(let n=0;n<o.length;n++){const r=o[n];if(n<4)i<<=1,r===t?i+=1:(r===s||r===e)&&(i=1);else if(n===4)i<<=1,i+=1;else{if(r===s||r===e)break;i<<=1,r===t&&(i+=1)}}return i},generateAllModes=t=>{let s=[],e=2**(t+1);for(;e-- >0;)s.push("0b"+e.toString(2));return s},allModes=generateAllModes(11),isLive1=t=>/010/.test(t)&&t.length>5,isDead2=t=>/10{0,1}1/.test(t)&&t.length>=5,isLive2=t=>[/000110/,/001100/,/011000/,/001010/,/010100/].some(s=>s.test(t)),isLive2x2=t=>/0101010/.test(t),isDead3=t=>[/111/,/1011/,/1101/,/11001/,/10011/,/10101/].some(s=>s.test(t))&&t.length>=5,isLive3=t=>[/010110/,/011010/,/01110/,/1010101/].some(s=>s.test(t)),isDead4=t=>[/11110/,/01111/,/11011/,/11101/,/10111/].some(s=>s.test(t)),isLive4=t=>[/011110/,/1011101/,/11011011/,/111010111/].some(s=>s.test(t)),is5=t=>/1{5}/.test(t),stat={};allModes.forEach(t=>stat[t]=null);const serialPointMode=[],{l5:l5$1,l4:l4$1,d4:d4$1,l3:l3$1,d3:d3$1,l2:l2$1,l2x2:l2x2$1,d2:d2$1,l1:l1$1}=chessModeBit;allModes.forEach(t=>isLive1(t.slice(3))&&(stat[t]="l1")&&(serialPointMode[+t]=l1$1));allModes.forEach(t=>isDead2(t.slice(3))&&(stat[t]="d2")&&(serialPointMode[+t]=d2$1));allModes.forEach(t=>isLive2(t.slice(3))&&(stat[t]="l2")&&(serialPointMode[+t]=l2$1));allModes.forEach(t=>isDead3(t.slice(3))&&(stat[t]="d3")&&(serialPointMode[+t]=d3$1));allModes.forEach(t=>isLive2x2(t.slice(3))&&(stat[t]="l2x2")&&(serialPointMode[+t]=l2x2$1));allModes.forEach(t=>isLive3(t.slice(3))&&(stat[t]="l3")&&(serialPointMode[+t]=l3$1));allModes.forEach(t=>isDead4(t.slice(3))&&(stat[t]="d4")&&(serialPointMode[+t]=d4$1));allModes.forEach(t=>isLive4(t.slice(3))&&(stat[t]="l4")&&(serialPointMode[+t]=l4$1));allModes.forEach(t=>is5(t.slice(3))&&(stat[t]="l5")&&(serialPointMode[+t]=l5$1));console.log("未构成棋型的组合, 这一部分已经验证",Object.keys(stat).filter(t=>!stat[t]).map(t=>t.slice(3)));console.warn("todo: 验证以下棋型是否正确");Object.keys(Score).forEach(t=>{console.log(t,Object.keys(stat).filter(s=>stat[s]===t).map(s=>s.slice(3)))});console.log({allModes,serialPointMode});class Zobrist{constructor({size:s}){this.max=arrayN(s).map(o=>arrayN(s).map(()=>random.int(0,1073741824))),this.min=arrayN(s).map(o=>arrayN(s).map(()=>random.int(0,1073741824))),this.code=random.int(0,1073741824),this.hash={}}go(s,e,o){this.code^=o?this.max[s][e]:this.min[s][e]}get(){return this.hash[this.code]}set(s){this.hash[this.code]=s}resetHash(){this.hash={}}}const{l1,d2,l2,l2x2,d3,l3,d4,l4,l5}=chessModeBit;function evaluate(t,s){const e=this.winner;if(e===MAX)return Score.win;if(e===MIN)return-Score.win;if(t)return 0;let o=0,i=0,n=0,r=0,l=0,d=0,h=0,a=0,b=0,f=0,u=0,m=0,p=0,g=0,A=0,M=0;const v=(c,C)=>{if(C<34)return;const w=serialPointMode[C];if(w)if(c===MAX)switch(w){case l1:return a++;case d2:return h++;case l2:return d++;case l2x2:return d+=2;case d3:return l++;case l3:return r++;case d4:return n++;case l4:return i++;case l5:return o++;default:return console.error("error")}else switch(w){case l1:return M++;case d2:return A++;case l2:return g++;case l2x2:return g+=2;case d3:return p++;case l3:return m++;case d4:return u++;case l4:return f++;case l5:return b++;default:return console.error("error")}},E=(c,C,w)=>{let k=1,P=0,j=!1;for(let F=0;F<15;F++){const y=w&3;if(w>>=2,y===C||y===WALL){v(c,k),k=1,j=!0;continue}else if(y===EMPTY)if(P===0)P++,k<<=1;else{k<<=1,(w&12)===EMPTY&&F!==14&&(k<<=1),v(c,k),k=4,(w&12)===EMPTY&&F!==14&&(k<<=1),P=0,j=!0;continue}else P=0,j=!1,k<<=1,k+=1}j||v(c,k)};for(let c=0;c<this.node0.length;c++)E(MAX,MIN,this.node0[c]);for(let c=0;c<this.node1.length;c++)E(MAX,MIN,this.node1[c]);for(let c=0;c<this.node2.length;c++)E(MAX,MIN,this.node2[c]);for(let c=0;c<this.node3.length;c++)E(MAX,MIN,this.node3[c]);for(let c=0;c<this.node0.length;c++)E(MIN,MAX,this.node0[c]);for(let c=0;c<this.node1.length;c++)E(MIN,MAX,this.node1[c]);for(let c=0;c<this.node2.length;c++)E(MIN,MAX,this.node2[c]);for(let c=0;c<this.node3.length;c++)E(MIN,MAX,this.node3[c]);s&&(console.log({maxL1:a,maxD2:h,maxL2:d,maxD3:l,maxL3:r,maxD4:n,maxL4:i,maxL5:o}),console.log({minL1:M,minD2:A,minL2:g,minD3:p,minL3:m,minD4:u,minL4:f,minL5:b}));let L=0,q=0;if((this.seekDepth&1)===0){if(i||n)return Score.l5;if(f||u>2||m>2||m&u)return-Score.l5;r&&!f&&!u&&(L+=Score.l4)}else{if(f||u)return-Score.l5;if(i)return Score.l5;if(n>2||r>2||r&n)return-Score.l5;m&&!i&&!n&&(q+=Score.l4)}return L=Score.l5*o+Score.l4*i+Score.d4*n+Score.l3*r+Score.d3*l+Score.l2*d+Score.d2*h+Score.l1*h,q=Score.l5*b+Score.l4*f+Score.d4*u+Score.l3*m+Score.d3*p+Score.l2*g+Score.d2*A+Score.l1*A,L*this.attackFactor-q*this.defenseFactor}function genChilds(t,s,e){let o=[],i=[],n=[],r=[],l=[],d=[],h=[],a=[],b=[],f=[],u=[];for(let p=0;p<t.length;p++){const g=t[p],[A,M]=g;let v=0,E=0,L=getPointMode(this.maxPointsScore[A][M][0]);{const S=getPointMode(this.maxPointsScore[A][M][1]),x=getPointMode(this.maxPointsScore[A][M][2]),c=getPointMode(this.maxPointsScore[A][M][3]);L.l5+=S.l5+x.l5+c.l5,L.l4+=S.l4+x.l4+c.l4,L.d4+=S.d4+x.d4+c.d4,L.l3+=S.l3+x.l3+c.l3,L.d3+=S.d3+x.d3+c.d3,L.l2+=S.l2+x.l2+c.l2,L.d2+=S.d2+x.d2+c.d2,L.l1+=S.l1+x.l1+c.l1;const{l5:C,l4:w,d4:k,l3:P}=L;C?o.push(g):w?n.push(g):(P&&k&&b.push(g),P>1&&a.push(g),P&&h.push(g),k&&l.push(g)),v=calcEvaPointScore(L)}let q=getPointMode(this.minPointsScore[A][M][0]);{const S=getPointMode(this.minPointsScore[A][M][1]),x=getPointMode(this.minPointsScore[A][M][2]),c=getPointMode(this.minPointsScore[A][M][3]);q.l5+=S.l5+x.l5+c.l5,q.l4+=S.l4+x.l4+c.l4,q.d4+=S.d4+x.d4+c.d4,q.l3+=S.l3+x.l3+c.l3,q.d3+=S.d3+x.d3+c.d3,q.l2+=S.l2+x.l2+c.l2,q.d2+=S.d2+x.d2+c.d2,q.l1+=S.l1+x.l1+c.l1;const{l5:C,l4:w,d4:k,l3:P}=q;C?i.push(g):w?r.push(g):(P&&k&&f.push(g),k&&d.push(g)),E=calcEvaPointScore(q)}u.push({position:[A,M],score:v*this.attackFactor+E*this.defenseFactor})}let m;if(s){if(e)return o.length?o:i.length?[]:n.length?n:b.length||l.length?b.concat(l):r.length||d.length?[]:a.length?a:h.length?h:[];if(o.length)return o;if(i.length)return i;if(n.length)return n;if(r.length)return r;if(b.length)return b;if(f.length)return f}else{if(i.length)return i;if(o.length)return o;if(r.length)return r;if(n.length)return n;if(f.length)return f;if(b.length)return b}return m=u.sort((p,g)=>g.score-p.score).map(p=>p.position),m.length<=this.genLimit?m:m.slice(0,this.genLimit)}class Gobang{constructor(t){N(this,"genChilds",genChilds);this.init({...t})}init({firstHand:t,seekDepth:s,autoPlay:e,enableStats:o,attackFactor:i,defenseFactor:n}){this.totalChessPieces=boardLength*boardLength,this.initNode(),this.stack=[],this.zobrist=new Zobrist({size:boardLength}),this.maxPointsScore=arrayN(boardLength).map(r=>arrayN(boardLength,[0,0,0,0])),this.minPointsScore=arrayN(boardLength).map(r=>arrayN(boardLength,[0,0,0,0])),this.stats={},this.enableStats=o!==void 0?o:!0,this.enableLog=!1,this.firstHand=t||MIN,this.genLimit=20,this.seekDepth=s||4,this.seekKillDepth=17,this.autoPlay=e||!1,this.attackFactor=i||1,this.defenseFactor=n||2}isWall(t,s){return t<0||t>=boardLength||s<0||s>=boardLength}initNode(){this.node0=arrayN(boardLength,0);const t=new ArrayBuffer(4*15);this.node1=new Int32Array(t);for(let s=0;s<=14;s++)this.node1[s]=0;this.node2=[];for(let s=0;s<boardLength*2-1;s++){let e=0;for(let o=0;o<15;o++){const i=s-o;e<<=2,this.isWall(o,i)&&(e+=3)}this.node2[s]=e}this.node3=[];for(let s=0;s<boardLength*2-1;s++){let e=0;for(let o=0;o<15;o++){const i=14+o-s;e<<=2,this.isWall(o,i)&&(e+=3)}this.node3[s]=e}}put(t,s,e){this.zobrist.go(t,s,e===MAX),this.stack.push([t,s]),this.node0[t]=this.node0[t]|e<<2*(14-s),this.node1[s]=this.node1[s]|e<<2*(14-t),this.node2[t+s]=this.node2[t+s]|e<<2*(14-t),this.node3[14+t-s]=this.node3[14+t-s]|e<<2*(14-t),this.updateFourLineScore(t,s)}rollback(t=1){if(!(this.stack.length<t))for(;t-- >0;){const[s,e]=this.stack.pop();this.zobrist.go(s,e,this.getChess(s,e)===MAX);const o=2*(14-e);this.node0[s]=(this.node0[s]|3<<o)^3<<o;const i=2*(14-s);this.node1[e]=(this.node1[e]|3<<i)^3<<i,this.node2[s+e]=(this.node2[s+e]|3<<i)^3<<i,this.node3[14+s-e]=(this.node3[14+s-e]|3<<i)^3<<i,this.updateFourLineScore(s,e)}}maxGo(){if(this.isFinal)return;this.zobrist.resetHash(),this.initStats();let t;this.stack.length>4&&(console.time("thinking kill"),t=this.minimax(this.seekKillDepth,!0),console.timeEnd("thinking kill")),(t==null?void 0:t.score)>=Score.win?console.warn("算杀成功 :)"):(console.time("thinking"),t=this.minimax(this.seekDepth),console.timeEnd("thinking")),console.log({score:t});const{i:s,j:e}=t;return this.put(s,e,MAX),this.logStats(),t}minGo(t,s){if(!this.isFinal)return this.isEmptyPosition(t,s)?(this.put(t,s,MIN),!0):!1}minRepent(){this.stack.length>=2&&this.rollback(2)}isEmptyPosition(t,s){return!this.isWall(t,s)&&this.getChess(t,s)===EMPTY}getNearPositions(t){const s=[],[o,i]=t;for(let n=-2;n<=2;n++)for(let r=-2;r<=2;r++)this.isEmptyPosition(n+o,r+i)&&s.push([n+o,r+i]);return s}getAllOptimalNextStep(){if(this.stack.length===0)return[[boardCenter,boardCenter]];if(this.stack.length===1){if(this.isEmptyPosition(boardCenter,boardCenter))return[[boardCenter,boardCenter]];const s=boardCenter+(Math.random()>.5?1:-1),e=boardCenter+(Math.random()>.5?1:-1);return[[s,e]]}let t=[];for(let s=0;s<boardLength;s++)for(let e=0;e<boardLength;e++)this.getChess(s,e)===EMPTY&&this.haveNeighbor(s,e)&&t.push([s,e]);return t}haveNeighbor(t,s){for(let o=-2;o<=2;o++)if(!(o+t<0||o+t>=boardLength))for(let i=-2;i<=2;i++){if(i+s<0||i+s>=boardLength||o===0&&i===0)continue;if(this.getChess(o+t,s+i)!==EMPTY)return!0}return!1}getChess(t,s){return this.node0[t]>>2*(14-s)&3}minimax(t,s,e=-1/0,o=1/0,i=!0){if(this.isFinal||t===0)return{score:evaluate.call(this,s),depth:t};const n=this.genChilds(this.getAllOptimalNextStep(),i,s);if(!(n!=null&&n.length))return{score:0};if(i){let r=-1/0,l=n[0];for(const a of n){const[b,f]=a;this.put(b,f,MAX),this.enableStats&&this.stats.abCut.eva++;let u=this.zobrist.get();if(u===void 0?(u=this.minimax(t-1,s,e,o,!i).score,this.zobrist.set(u),this.enableStats&&this.stats.zobrist.miss++):this.enableStats&&this.stats.zobrist.hit++,this.rollback(),u>r&&(r=u,l=a),e=Math.max(e,r),o<=e){this.enableStats&&this.stats.abCut.cut++;break}}const[d,h]=l;return{score:r,i:d,j:h}}else{let r=1/0,l=n[0];for(const a of n){const[b,f]=a;this.put(b,f,MIN),this.enableStats&&this.stats.abCut.eva++;let u=this.zobrist.get();if(u===void 0?(u=this.minimax(t-1,s,e,o,!i).score,this.zobrist.set(u),this.enableStats&&this.stats.zobrist.miss++):this.enableStats&&this.stats.zobrist.hit++,this.rollback(),u<r&&(r=u,l=a),o=Math.min(o,r),o<=e){this.enableStats&&this.stats.abCut.cut++;break}}const[d,h]=l;return{score:r,i:d,j:h}}}getChessInFourDirection(t,s,e){let o=[],i=[],n=[],r=[];if(e===void 0||e===0){const l=this.node0[t],d=s>=4?l>>2*(18-s)&3:3,h=s>=3?l>>2*(17-s)&3:3,a=s>=2?l>>2*(16-s)&3:3,b=s>=1?l>>2*(15-s)&3:3,f=l>>2*(14-s)&3,u=s<=13?l>>2*(13-s)&3:3,m=s<=12?l>>2*(12-s)&3:3,p=s<=11?l>>2*(11-s)&3:3,g=s<=10?l>>2*(10-s)&3:3;if(o=[d,h,a,b,f,u,m,p,g],e===0)return o}if(e===void 0||e===1){const l=this.node1[s],d=t>=4?l>>2*(18-t)&3:3,h=t>=3?l>>2*(17-t)&3:3,a=t>=2?l>>2*(16-t)&3:3,b=t>=1?l>>2*(15-t)&3:3,f=l>>2*(14-t)&3,u=t<=13?l>>2*(13-t)&3:3,m=t<=12?l>>2*(12-t)&3:3,p=t<=11?l>>2*(11-t)&3:3,g=t<=10?l>>2*(10-t)&3:3;if(i=[d,h,a,b,f,u,m,p,g],e===1)return i}if(e===void 0||e===2){const l=this.node2[t+s],d=t>=4?l>>2*(18-t)&3:3,h=t>=3?l>>2*(17-t)&3:3,a=t>=2?l>>2*(16-t)&3:3,b=t>=1?l>>2*(15-t)&3:3,f=l>>2*(14-t)&3,u=t<=13?l>>2*(13-t)&3:3,m=t<=12?l>>2*(12-t)&3:3,p=t<=11?l>>2*(11-t)&3:3,g=t<=10?l>>2*(10-t)&3:3;if(n=[d,h,a,b,f,u,m,p,g],e===2)return n}if(e===void 0||e===3){const l=this.node3[14+t-s],d=t>=4?l>>2*(18-t)&3:3,h=t>=3?l>>2*(17-t)&3:3,a=t>=2?l>>2*(16-t)&3:3,b=t>=1?l>>2*(15-t)&3:3,f=l>>2*(14-t)&3,u=t<=13?l>>2*(13-t)&3:3,m=t<=12?l>>2*(12-t)&3:3,p=t<=11?l>>2*(11-t)&3:3,g=t<=10?l>>2*(10-t)&3:3;if(r=[d,h,a,b,f,u,m,p,g],e===3)return r}return[o,i,n,r]}getPositionsInFourDirection(t,s){let e=[],o=[],i=[],n=[];const r=t-4>0?t-4:0,l=t+4<boardLength-1?t+4:boardLength-1,d=s-4>0?s-4:0,h=s+4<boardLength-1?s+4:boardLength-1;for(let a=d;a<=h;a++)e.push([t,a]);for(let a=r;a<=l;a++)o.push([a,s]);for(let a=4;a>0;a--)t-a>=r&&s+a<=h&&i.push([t-a,s+a]);i.push([t,s]);for(let a=1;a<=4;a++)t+a<=l&&s-a>=d&&i.push([t+a,s-a]);for(let a=4;a>0;a--)t-a>=r&&s-a>=d&&n.push([t-a,s-a]);n.push([t,s]);for(let a=1;a<=4;a++)t+a<=l&&s+a<=h&&n.push([t+a,s+a]);return[e,o,i,n]}updateFourLineScore(t,s){const e=this.getPositionsInFourDirection(t,s);for(let o=0;o<4;o++){const i=e[o];for(let n=0;n<i.length;n++){const r=i[n];this.updatePointScore(r,o)}}}updatePointScore(t,s){const[e,o]=t;this.getChess(e,o)!==EMPTY?(this.maxPointsScore[e][o]=[0,0,0,0],this.minPointsScore[e][o]=[0,0,0,0]):(this.maxPointsScore[e][o][s]=this.evaPoint(e,o,MAX,s),this.minPointsScore[e][o][s]=this.evaPoint(e,o,MIN,s))}evaPoint(t,s,e,o){const i=this.getChessInFourDirection(t,s,o),l=countLine(e===MAX?MAX:MIN,e===MAX?MIN:MAX,WALL);let d=0;const h=l(i),a=serialPointMode[h];return d+=a||0,d}saveStack(){console.log(JSON.stringify(this.stack))}restoreStack(t){let s=this.firstHand,e=s===MAX?MIN:MAX;for(var o=0;o<t.length;o++){const[i,n]=t[o];this.put(i,n,o&1?e:s)}}test(data){console.log(eval(data))}get winner(){if(this.stack.length<7)return null;const[t,s]=this.stack[this.stack.length-1],e=this.getChess(t,s),o=this.getChessInFourDirection(t,s);for(let i=0;i<4;i++){let n=0;const r=o[i];for(let l=0;l<r.length;l++)if(r[l]===e?n++:n=0,n===5)return e}return null}get winnerPositions(){if(!this.winner)return null;const[t,s]=this.stack[this.stack.length-1],e=this.getChess(t,s),o=this.getPositionsInFourDirection(t,s);for(let i=0;i<4;i++){const n=o[i];let r=0,l=[];for(let d=0;d<n.length;d++){const[h,a]=n[d];if(this.getChess(h,a)===e?(r++,l.push([h,a])):(r=0,l=[]),r===5)return l}}return null}get isFinal(){return!!this.winner||this.isBoardFull}get isBoardFull(){return this.stack.length===this.totalChessPieces}get lastChessPosition(){return this.stack.length?this.stack[this.stack.length-1]:null}get isDraw(){return this.isBoardFull&&!this.winner}get node(){return this.node0.map(t=>{let s=[];for(let e=0;e<boardLength;e++)s.push((t&3<<2*e)>>2*e);return s.reverse()})}printNode(){console.log(this.node0.map(t=>t.toString(2))),console.log(this.node1.map(t=>t.toString(2))),console.log(this.node2.map(t=>t.toString(2))),console.log(this.node3.map(t=>t.toString(2)))}initStats(){this.stats={abCut:{all:this.genLimit**this.seekDepth,eva:0,cut:0,toString(){const{all:t,eva:s,cut:e}=this.stats.abCut,o=t-s;return`AB剪枝 最大节点总数:${t} 理论最少评估${t**.5>>0} 实际评估:${s} 剪去:${e}/${o}`}},zobrist:{miss:0,hit:0,toString(){const{hit:t,miss:s}=this.stats.zobrist;return`zobrist 评估节点数:${this.stats.abCut.eva} hit:${t} miss:${s}`}}}}logStats(){this.enableStats&&Object.keys(this.stats).forEach(t=>{console.log(this.stats[t].toString.call(this))})}}N(Gobang,"MAX",MAX),N(Gobang,"MIN",MIN),N(Gobang,"EMPTY",EMPTY),N(Gobang,"WALL",WALL);const App$1="",num="",Num=()=>jsx("div",{className:"num",children:range0(boardLength).map(t=>jsx("div",{className:"item",children:boardLength-t},t))}),abc="",ABC=()=>jsx("div",{className:"abc",children:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O"].map(t=>jsx("div",{className:"item",children:t},t))}),Time=()=>{const[t,s]=reactExports.useState(0);return reactExports.useEffect(()=>{const e=setInterval(()=>{s(o=>o+.2)},200);return()=>clearInterval(e)},[]),jsx("div",{className:"",children:t.toFixed(1)})};function WorkerWrapper(){return new Worker("/gobang/dist/assets/worker-5b7b4e38.js")}const fall="data:audio/mpeg;base64,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",win="/gobang/dist/assets/win-716cbc65.mp3",fail="/gobang/dist/assets/fail-c60229d9.mp3",urls={fall,win,fail},Music=({musics:t,onEnded:s})=>jsx(Fragment,{children:t.map(e=>jsx("video",{src:urls[e.value],onEnded:()=>s(e.id),autoPlay:!0,hidden:!0},e.id))});let gobang=new Gobang,worker=new WorkerWrapper;window.test=t=>worker.postMessage({type:"test",data:t});const Square=({position:t,value:s,onClick:e,isLastChess:o,isMarkPoint:i,isWinnerPoint:n})=>{const r=gobang.stack.findIndex(l=>l[0]===t[0]&&l[1]===t[1]);return jsxs("button",{className:`square ${o&&"lastChess"}`,onClick:e,children:[s!==Gobang.EMPTY&&jsx("div",{className:["chess",s===gobang.firstHand?"black":"white",n?"pulse":""].join(" "),children:r+1||null}),i&&jsx("div",{className:"markPoint"})]})},Board=({squares:t,onClick:s})=>{const e=gobang.lastChessPosition,o=gobang.winner,i=o?gobang.winnerPositions:null;return jsxs("div",{className:"boardCenter",children:[jsx("div",{className:"rowLines",children:range0(boardLength).map(n=>jsx("div",{className:"item"},n))}),jsx("div",{className:"colLines",children:range0(boardLength).map(n=>jsx("div",{className:"item"},n))}),jsx("div",{className:"chesses",children:range0(boardLength).map(n=>jsx("div",{className:"boardRow",children:range0(boardLength).map(r=>jsx(Square,{position:[n,r],value:t[n][r],isLastChess:e&&e[0]===n&&e[1]===r,isWinnerPoint:i&&i.some(([l,d])=>l===n&&d===r),isMarkPoint:n===3&&r===3||n===3&&r===11||n===7&&r===7||n===11&&r===3||n===11&&r===11,onClick:()=>s(n,r)},r))},n))}),jsxs("div",{className:"gameoverTip",children:[gobang.isDraw&&jsx("div",{className:"tip",children:"和棋~"}),o&&jsx("div",{className:"tip",children:o===gobang.firstHand?"黑方胜":"白方胜"})]})]})},Game=()=>{const[t,s]=reactExports.useState(!1),[e,o]=reactExports.useReducer(A=>A+1,0),[i,n]=reactExports.useState(!1),[r,l]=reactExports.useState(!1),[d,h]=reactExports.useReducer((A,M)=>{const{type:v,value:E,id:L}=M;return v==="add"?[...A,{id:+new Date,value:E}]:v==="remove"?A.filter(q=>q.id!==L):[]},[]),a=gobang.isFinal,b=(A,M)=>{if(!t)return console.log({start:t});if(a)return console.log({isFinal:a});if(i)return console.log({thinking:i});if(r)return console.log({autoPlay:r});worker.postMessage({type:"minGo",data:[A,M]})},f=()=>{n(!0),worker.postMessage({type:"maxGo"})},u=()=>{worker.terminate(),worker=new WorkerWrapper,worker.postMessage({type:"init",data:{}}),s(!1),l(!1)},m=(A,M)=>{s(!0),l(M),worker.postMessage({type:"init",data:{firstHand:A,autoPlay:M,seekDepth:4}})},p=()=>{l(!0),worker.postMessage({type:"init",data:{firstHand:Gobang.MAX,autoPlay:!0,seekDepth:2}})},g=()=>{worker.postMessage({type:"minRepent"})};return reactExports.useEffect(()=>{worker.onmessage=A=>{const{type:M,gobang:v,data:E}=A.data;switch(gobang=JSON.parse(v),M){case"init":gobang.firstHand===Gobang.MAX&&!gobang.autoPlay?f():o();break;case"minGo":E&&(h({type:"add",value:"fall"}),f());break;case"maxGo":h({type:"add",value:"fall"}),n(!1);break;case"autoPlay":h({type:"add",value:"fall"});break;default:o();break}}},[worker]),reactExports.useEffect(()=>{gobang.winner&&h({type:"add",value:gobang.winner===Gobang.MAX?"fail":"win"})},[gobang.winner]),jsxs("div",{className:"game",children:[jsx(Music,{musics:d,onEnded:A=>h({type:"remove",value:A})}),jsxs("div",{className:"gameInfo",children:[jsx(Time,{}),jsx("div",{className:""})]}),jsxs("div",{className:"gameBoard",children:[jsx(Num,{}),jsxs("div",{className:"center",children:[jsx(ABC,{}),jsx(Board,{squares:gobang.node,onClick:debounce(b,20)}),jsx(ABC,{})]}),jsx(Num,{})]}),jsxs("div",{className:"opbtns",children:[r&&jsx("button",{onClick:u,children:"开始游戏"}),!r&&!t&&jsxs(Fragment,{children:[jsx("button",{onClick:()=>m(Gobang.MAX),children:"电脑先手"}),jsx("button",{onClick:()=>m(Gobang.MIN),children:"玩家先手"}),jsx("button",{onClick:p,children:"电脑vs电脑"})]}),t&&jsxs(Fragment,{children:[jsx("button",{onClick:u,children:"重来"}),jsx("button",{onClick:g,children:"悔棋"})]})]}),jsxs("div",{className:"game-info",children:[gobang.winner&&jsx("div",{children:gobang.winner===Gobang.MAX?"少侠请努力":"干得漂亮"}),jsx("ol",{})]})]})},App=Game,index="";client.createRoot(document.getElementById("root")).render(jsx(App,{}));
