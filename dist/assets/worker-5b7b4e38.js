var F=Object.defineProperty;var X=(t,n,e)=>n in t?F(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e;var O=(t,n,e)=>(X(t,typeof n!="symbol"?n+"":n,e),e);(function(){"use strict";const EMPTY=0,MAX=1,MIN=2,WALL=3,boardLength=15,boardCenter=7,chessModeBit={l1:1,d2:8,l2:64,l2x2:128,d3:512,l3:4096,d4:16384,l4:65536,l5:262144},getPointMode=t=>({l1:t&7,d2:(t&56)>>3,l2:(t&960)>>6,d3:(t&7680)>>9,l3:(t&12288)>>12,d4:(t&49152)>>14,l4:(t&196608)>>16,l5:(t&786432)>>18}),Score={l1:10,d2:10,d3:200,l2:150,l2x2:300,l3:200,d4:2e3,l4:5e3,l5:1e4,win:1e5},calcEvaPointScore=t=>{const{l5:n,l4:e,d4:o,l3:r,d3:l,l2:f,d2:s,l1:i}=t;let a=0;return n&&(a+=Score.l5*n),e&&(a+=Score.l4*e),o&&(a+=Score.d4*o),r&&(a+=Score.l3*r),l&&(a+=Score.d3*l),f&&(a+=Score.l2*f),s&&(a+=Score.d2*s),i&&(a+=Score.l1*i),a};console.warn("todo: 测试 countLine 是否正确");const countLine=(t,n,e)=>o=>{let r=1;for(let l=0;l<o.length;l++){const f=o[l];if(l<4)r<<=1,f===t?r+=1:(f===n||f===e)&&(r=1);else if(l===4)r<<=1,r+=1;else{if(f===n||f===e)break;r<<=1,f===t&&(r+=1)}}return r},generateAllModes=t=>{let n=[],e=2**(t+1);for(;e-- >0;)n.push("0b"+e.toString(2));return n},allModes=generateAllModes(11),isLive1=t=>/010/.test(t)&&t.length>5,isDead2=t=>/10{0,1}1/.test(t)&&t.length>=5,isLive2=t=>[/000110/,/001100/,/011000/,/001010/,/010100/].some(n=>n.test(t)),isLive2x2=t=>/0101010/.test(t),isDead3=t=>[/111/,/1011/,/1101/,/11001/,/10011/,/10101/].some(n=>n.test(t))&&t.length>=5,isLive3=t=>[/010110/,/011010/,/01110/,/1010101/].some(n=>n.test(t)),isDead4=t=>[/11110/,/01111/,/11011/,/11101/,/10111/].some(n=>n.test(t)),isLive4=t=>[/011110/,/1011101/,/11011011/,/111010111/].some(n=>n.test(t)),is5=t=>/1{5}/.test(t),stat={};allModes.forEach(t=>stat[t]=null);const serialPointMode=[],{l5:l5$1,l4:l4$1,d4:d4$1,l3:l3$1,d3:d3$1,l2:l2$1,l2x2:l2x2$1,d2:d2$1,l1:l1$1}=chessModeBit;allModes.forEach(t=>isLive1(t.slice(3))&&(stat[t]="l1")&&(serialPointMode[+t]=l1$1)),allModes.forEach(t=>isDead2(t.slice(3))&&(stat[t]="d2")&&(serialPointMode[+t]=d2$1)),allModes.forEach(t=>isLive2(t.slice(3))&&(stat[t]="l2")&&(serialPointMode[+t]=l2$1)),allModes.forEach(t=>isDead3(t.slice(3))&&(stat[t]="d3")&&(serialPointMode[+t]=d3$1)),allModes.forEach(t=>isLive2x2(t.slice(3))&&(stat[t]="l2x2")&&(serialPointMode[+t]=l2x2$1)),allModes.forEach(t=>isLive3(t.slice(3))&&(stat[t]="l3")&&(serialPointMode[+t]=l3$1)),allModes.forEach(t=>isDead4(t.slice(3))&&(stat[t]="d4")&&(serialPointMode[+t]=d4$1)),allModes.forEach(t=>isLive4(t.slice(3))&&(stat[t]="l4")&&(serialPointMode[+t]=l4$1)),allModes.forEach(t=>is5(t.slice(3))&&(stat[t]="l5")&&(serialPointMode[+t]=l5$1)),console.log("未构成棋型的组合, 这一部分已经验证",Object.keys(stat).filter(t=>!stat[t]).map(t=>t.slice(3))),console.warn("todo: 验证以下棋型是否正确"),Object.keys(Score).forEach(t=>{console.log(t,Object.keys(stat).filter(n=>stat[n]===t).map(n=>n.slice(3)))}),console.log({allModes,serialPointMode});const arrayN=(t,n=null)=>Array(t).fill(n),wait=t=>new Promise(n=>setTimeout(n,t));var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getAugmentedNamespace(t){if(t.__esModule)return t;var n=t.default;if(typeof n=="function"){var e=function o(){if(this instanceof o){var r=[null];r.push.apply(r,arguments);var l=Function.bind.apply(n,r);return new l}return n.apply(this,arguments)};e.prototype=n.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(t).forEach(function(o){var r=Object.getOwnPropertyDescriptor(t,o);Object.defineProperty(e,o,r.get?r:{enumerable:!0,get:function(){return t[o]}})}),e}var aleaExports={},alea$1={get exports(){return aleaExports},set exports(t){aleaExports=t}};(function(t){(function(n,e,o){function r(i){var a=this,h=s();a.next=function(){var u=2091639*a.s0+a.c*23283064365386963e-26;return a.s0=a.s1,a.s1=a.s2,a.s2=u-(a.c=u|0)},a.c=1,a.s0=h(" "),a.s1=h(" "),a.s2=h(" "),a.s0-=h(i),a.s0<0&&(a.s0+=1),a.s1-=h(i),a.s1<0&&(a.s1+=1),a.s2-=h(i),a.s2<0&&(a.s2+=1),h=null}function l(i,a){return a.c=i.c,a.s0=i.s0,a.s1=i.s1,a.s2=i.s2,a}function f(i,a){var h=new r(i),u=a&&a.state,c=h.next;return c.int32=function(){return h.next()*4294967296|0},c.double=function(){return c()+(c()*2097152|0)*11102230246251565e-32},c.quick=c,u&&(typeof u=="object"&&l(u,h),c.state=function(){return l(h,{})}),c}function s(){var i=4022871197,a=function(h){h=String(h);for(var u=0;u<h.length;u++){i+=h.charCodeAt(u);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return a}e&&e.exports?e.exports=f:o&&o.amd?o(function(){return f}):this.alea=f})(commonjsGlobal,t,!1)})(alea$1);var xor128Exports={},xor128$1={get exports(){return xor128Exports},set exports(t){xor128Exports=t}};(function(t){(function(n,e,o){function r(s){var i=this,a="";i.x=0,i.y=0,i.z=0,i.w=0,i.next=function(){var u=i.x^i.x<<11;return i.x=i.y,i.y=i.z,i.z=i.w,i.w^=i.w>>>19^u^u>>>8},s===(s|0)?i.x=s:a+=s;for(var h=0;h<a.length+64;h++)i.x^=a.charCodeAt(h)|0,i.next()}function l(s,i){return i.x=s.x,i.y=s.y,i.z=s.z,i.w=s.w,i}function f(s,i){var a=new r(s),h=i&&i.state,u=function(){return(a.next()>>>0)/4294967296};return u.double=function(){do var c=a.next()>>>11,d=(a.next()>>>0)/4294967296,b=(c+d)/(1<<21);while(b===0);return b},u.int32=a.next,u.quick=u,h&&(typeof h=="object"&&l(h,a),u.state=function(){return l(a,{})}),u}e&&e.exports?e.exports=f:o&&o.amd?o(function(){return f}):this.xor128=f})(commonjsGlobal,t,!1)})(xor128$1);var xorwowExports={},xorwow$1={get exports(){return xorwowExports},set exports(t){xorwowExports=t}};(function(t){(function(n,e,o){function r(s){var i=this,a="";i.next=function(){var u=i.x^i.x>>>2;return i.x=i.y,i.y=i.z,i.z=i.w,i.w=i.v,(i.d=i.d+362437|0)+(i.v=i.v^i.v<<4^(u^u<<1))|0},i.x=0,i.y=0,i.z=0,i.w=0,i.v=0,s===(s|0)?i.x=s:a+=s;for(var h=0;h<a.length+64;h++)i.x^=a.charCodeAt(h)|0,h==a.length&&(i.d=i.x<<10^i.x>>>4),i.next()}function l(s,i){return i.x=s.x,i.y=s.y,i.z=s.z,i.w=s.w,i.v=s.v,i.d=s.d,i}function f(s,i){var a=new r(s),h=i&&i.state,u=function(){return(a.next()>>>0)/4294967296};return u.double=function(){do var c=a.next()>>>11,d=(a.next()>>>0)/4294967296,b=(c+d)/(1<<21);while(b===0);return b},u.int32=a.next,u.quick=u,h&&(typeof h=="object"&&l(h,a),u.state=function(){return l(a,{})}),u}e&&e.exports?e.exports=f:o&&o.amd?o(function(){return f}):this.xorwow=f})(commonjsGlobal,t,!1)})(xorwow$1);var xorshift7Exports={},xorshift7$1={get exports(){return xorshift7Exports},set exports(t){xorshift7Exports=t}};(function(t){(function(n,e,o){function r(s){var i=this;i.next=function(){var h=i.x,u=i.i,c,d;return c=h[u],c^=c>>>7,d=c^c<<24,c=h[u+1&7],d^=c^c>>>10,c=h[u+3&7],d^=c^c>>>3,c=h[u+4&7],d^=c^c<<7,c=h[u+7&7],c=c^c<<13,d^=c^c<<9,h[u]=d,i.i=u+1&7,d};function a(h,u){var c,d=[];if(u===(u|0))d[0]=u;else for(u=""+u,c=0;c<u.length;++c)d[c&7]=d[c&7]<<15^u.charCodeAt(c)+d[c+1&7]<<13;for(;d.length<8;)d.push(0);for(c=0;c<8&&d[c]===0;++c);for(c==8?d[7]=-1:d[c],h.x=d,h.i=0,c=256;c>0;--c)h.next()}a(i,s)}function l(s,i){return i.x=s.x.slice(),i.i=s.i,i}function f(s,i){s==null&&(s=+new Date);var a=new r(s),h=i&&i.state,u=function(){return(a.next()>>>0)/4294967296};return u.double=function(){do var c=a.next()>>>11,d=(a.next()>>>0)/4294967296,b=(c+d)/(1<<21);while(b===0);return b},u.int32=a.next,u.quick=u,h&&(h.x&&l(h,a),u.state=function(){return l(a,{})}),u}e&&e.exports?e.exports=f:o&&o.amd?o(function(){return f}):this.xorshift7=f})(commonjsGlobal,t,!1)})(xorshift7$1);var xor4096Exports={},xor4096$1={get exports(){return xor4096Exports},set exports(t){xor4096Exports=t}};(function(t){(function(n,e,o){function r(s){var i=this;i.next=function(){var h=i.w,u=i.X,c=i.i,d,b;return i.w=h=h+1640531527|0,b=u[c+34&127],d=u[c=c+1&127],b^=b<<13,d^=d<<17,b^=b>>>15,d^=d>>>12,b=u[c]=b^d,i.i=c,b+(h^h>>>16)|0};function a(h,u){var c,d,b,y,w,E=[],N=128;for(u===(u|0)?(d=u,u=null):(u=u+"\0",d=0,N=Math.max(N,u.length)),b=0,y=-32;y<N;++y)u&&(d^=u.charCodeAt((y+32)%u.length)),y===0&&(w=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,y>=0&&(w=w+1640531527|0,c=E[y&127]^=d+w,b=c==0?b+1:0);for(b>=128&&(E[(u&&u.length||0)&127]=-1),b=127,y=4*128;y>0;--y)d=E[b+34&127],c=E[b=b+1&127],d^=d<<13,c^=c<<17,d^=d>>>15,c^=c>>>12,E[b]=d^c;h.w=w,h.X=E,h.i=b}a(i,s)}function l(s,i){return i.i=s.i,i.w=s.w,i.X=s.X.slice(),i}function f(s,i){s==null&&(s=+new Date);var a=new r(s),h=i&&i.state,u=function(){return(a.next()>>>0)/4294967296};return u.double=function(){do var c=a.next()>>>11,d=(a.next()>>>0)/4294967296,b=(c+d)/(1<<21);while(b===0);return b},u.int32=a.next,u.quick=u,h&&(h.X&&l(h,a),u.state=function(){return l(a,{})}),u}e&&e.exports?e.exports=f:o&&o.amd?o(function(){return f}):this.xor4096=f})(commonjsGlobal,t,!1)})(xor4096$1);var tycheiExports={},tychei$1={get exports(){return tycheiExports},set exports(t){tycheiExports=t}};(function(t){(function(n,e,o){function r(s){var i=this,a="";i.next=function(){var u=i.b,c=i.c,d=i.d,b=i.a;return u=u<<25^u>>>7^c,c=c-d|0,d=d<<24^d>>>8^b,b=b-u|0,i.b=u=u<<20^u>>>12^c,i.c=c=c-d|0,i.d=d<<16^c>>>16^b,i.a=b-u|0},i.a=0,i.b=0,i.c=-1640531527,i.d=1367130551,s===Math.floor(s)?(i.a=s/4294967296|0,i.b=s|0):a+=s;for(var h=0;h<a.length+20;h++)i.b^=a.charCodeAt(h)|0,i.next()}function l(s,i){return i.a=s.a,i.b=s.b,i.c=s.c,i.d=s.d,i}function f(s,i){var a=new r(s),h=i&&i.state,u=function(){return(a.next()>>>0)/4294967296};return u.double=function(){do var c=a.next()>>>11,d=(a.next()>>>0)/4294967296,b=(c+d)/(1<<21);while(b===0);return b},u.int32=a.next,u.quick=u,h&&(typeof h=="object"&&l(h,a),u.state=function(){return l(a,{})}),u}e&&e.exports?e.exports=f:o&&o.amd?o(function(){return f}):this.tychei=f})(commonjsGlobal,t,!1)})(tychei$1);var seedrandomExports={},seedrandom$1={get exports(){return seedrandomExports},set exports(t){seedrandomExports=t}},__viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze({__proto__:null,default:__viteBrowserExternal}),require$$0=getAugmentedNamespace(__viteBrowserExternal$1);(function(t){(function(n,e,o){var r=256,l=6,f=52,s="random",i=o.pow(r,l),a=o.pow(2,f),h=a*2,u=r-1,c;function d(m,v,M){var x=[];v=v==!0?{entropy:!0}:v||{};var p=E(w(v.entropy?[m,k(e)]:m??N(),3),x),g=new b(x),C=function(){for(var P=g.g(l),S=i,_=0;P<a;)P=(P+_)*r,S*=r,_=g.g(1);for(;P>=h;)P/=2,S/=2,_>>>=1;return(P+_)/S};return C.int32=function(){return g.g(4)|0},C.quick=function(){return g.g(4)/4294967296},C.double=C,E(k(g.S),e),(v.pass||M||function(P,S,_,L){return L&&(L.S&&y(L,g),P.state=function(){return y(g,{})}),_?(o[s]=P,S):P})(C,p,"global"in v?v.global:this==o,v.state)}function b(m){var v,M=m.length,x=this,p=0,g=x.i=x.j=0,C=x.S=[];for(M||(m=[M++]);p<r;)C[p]=p++;for(p=0;p<r;p++)C[p]=C[g=u&g+m[p%M]+(v=C[p])],C[g]=v;(x.g=function(P){for(var S,_=0,L=x.i,A=x.j,W=x.S;P--;)S=W[L=u&L+1],_=_*r+W[u&(W[L]=W[A=u&A+S])+(W[A]=S)];return x.i=L,x.j=A,_})(r)}function y(m,v){return v.i=m.i,v.j=m.j,v.S=m.S.slice(),v}function w(m,v){var M=[],x=typeof m,p;if(v&&x=="object")for(p in m)try{M.push(w(m[p],v-1))}catch{}return M.length?M:x=="string"?m:m+"\0"}function E(m,v){for(var M=m+"",x,p=0;p<M.length;)v[u&p]=u&(x^=v[u&p]*19)+M.charCodeAt(p++);return k(v)}function N(){try{var m;return c&&(m=c.randomBytes)?m=m(r):(m=new Uint8Array(r),(n.crypto||n.msCrypto).getRandomValues(m)),k(m)}catch{var v=n.navigator,M=v&&v.plugins;return[+new Date,n,M,n.screen,k(e)]}}function k(m){return String.fromCharCode.apply(0,m)}if(E(o.random(),e),t.exports){t.exports=d;try{c=require$$0}catch{}}else o["seed"+s]=d})(typeof self<"u"?self:commonjsGlobal,[],Math)})(seedrandom$1);var alea=aleaExports,xor128=xor128Exports,xorwow=xorwowExports,xorshift7=xorshift7Exports,xor4096=xor4096Exports,tychei=tycheiExports,sr=seedrandomExports;sr.alea=alea,sr.xor128=xor128,sr.xorwow=xorwow,sr.xorshift7=xorshift7,sr.xor4096=xor4096,sr.tychei=tychei;var seedrandom=sr;function _defineProperties(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,_toPropertyKey(o.key),o)}}function _createClass(t,n,e){return n&&_defineProperties(t.prototype,n),e&&_defineProperties(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function _inheritsLoose(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,_setPrototypeOf(t,n)}function _setPrototypeOf(t,n){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,r){return o.__proto__=r,o},_setPrototypeOf(t,n)}function _toPrimitive(t,n){if(typeof t!="object"||t===null)return t;var e=t[Symbol.toPrimitive];if(e!==void 0){var o=e.call(t,n||"default");if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(t)}function _toPropertyKey(t){var n=_toPrimitive(t,"string");return typeof n=="symbol"?n:String(n)}var RNG=function(){function t(){}var n=t.prototype;return n._seed=function(o,r){if(o===(o||0))return o;for(var l=""+o,f=0,s=0;s<l.length;++s)f^=l.charCodeAt(s)|0;return f},t}(),RNGFunction=function(t){_inheritsLoose(n,t);function n(o,r){var l;return l=t.call(this)||this,l._rng=void 0,l.seed(o,r),l}var e=n.prototype;return e.next=function(){return this._rng()},e.seed=function(r,l){this._rng=r},e.clone=function(r,l){return new n(this._rng,l)},_createClass(n,[{key:"name",get:function(){return"function"}}]),n}(RNG),RNGFactory=function(){var t=[].slice.call(arguments),n=t,e=n[0],o=e===void 0?"default":e;switch(typeof o){case"object":if(o instanceof RNG)return o;break;case"function":return new RNGFunction(o);case"number":case"string":default:return new RNGFunction(seedrandom.apply(void 0,t))}throw new Error('invalid RNG "'+o+'"')},uniform=function(t,n,e){return n===void 0&&(n=0),e===void 0&&(e=1),function(){return t.next()*(e-n)+n}};function numberValidator(t){return new NumberValidator(t)}var NumberValidator=function(n){var e=this;this.n=void 0,this.isInt=function(){if(Number.isInteger(e.n))return e;throw new Error("Expected number to be an integer, got "+e.n)},this.isPositive=function(){if(e.n>0)return e;throw new Error("Expected number to be positive, got "+e.n)},this.lessThan=function(o){if(e.n<o)return e;throw new Error("Expected number to be less than "+o+", got "+e.n)},this.greaterThanOrEqual=function(o){if(e.n>=o)return e;throw new Error("Expected number to be greater than or equal to "+o+", got "+e.n)},this.greaterThan=function(o){if(e.n>o)return e;throw new Error("Expected number to be greater than "+o+", got "+e.n)},this.n=n},uniformInt=function(t,n,e){return n===void 0&&(n=0),e===void 0&&(e=1),e===void 0&&(e=n===void 0?1:n,n=0),numberValidator(n).isInt(),numberValidator(e).isInt(),function(){return Math.floor(t.next()*(e-n+1)+n)}},uniformBoolean=function(t){return function(){return t.next()>=.5}},normal=function(t,n,e){return n===void 0&&(n=0),e===void 0&&(e=1),function(){var o,r,l;do o=t.next()*2-1,r=t.next()*2-1,l=o*o+r*r;while(!l||l>1);return n+e*r*Math.sqrt(-2*Math.log(l)/l)}},logNormal=function(t,n,e){n===void 0&&(n=0),e===void 0&&(e=1);var o=t.normal(n,e);return function(){return Math.exp(o())}},bernoulli=function(t,n){return n===void 0&&(n=.5),numberValidator(n).greaterThanOrEqual(0).lessThan(1),function(){return Math.floor(t.next()+n)}},binomial=function(t,n,e){return n===void 0&&(n=1),e===void 0&&(e=.5),numberValidator(n).isInt().isPositive(),numberValidator(e).greaterThanOrEqual(0).lessThan(1),function(){for(var o=0,r=0;o++<n;)t.next()<e&&r++;return r}},geometric=function(t,n){n===void 0&&(n=.5),numberValidator(n).greaterThan(0).lessThan(1);var e=1/Math.log(1-n);return function(){return Math.floor(1+Math.log(t.next())*e)}},logFactorialTable=[0,0,.6931471805599453,1.791759469228055,3.1780538303479458,4.787491742782046,6.579251212010101,8.525161361065415,10.60460290274525,12.801827480081469],logFactorial=function(n){return logFactorialTable[n]},logSqrt2PI=.9189385332046727,poisson=function(t,n){if(n===void 0&&(n=1),numberValidator(n).isPositive(),n<10){var e=Math.exp(-n);return function(){for(var i=e,a=0,h=t.next();h>i;)h=h-i,i=n*i/++a;return a}}else{var o=Math.sqrt(n),r=.931+2.53*o,l=-.059+.02483*r,f=1.1239+1.1328/(r-3.4),s=.9277-3.6224/(r-2);return function(){for(;;){var i=void 0,a=t.next();if(a<=.86*s)return i=a/s-.43,Math.floor((2*l/(.5-Math.abs(i))+r)*i+n+.445);a>=s?i=t.next()-.5:(i=a/s-.93,i=(i<0?-.5:.5)-i,a=t.next()*s);var h=.5-Math.abs(i);if(!(h<.013&&a>h)){var u=Math.floor((2*l/h+r)*i+n+.445);if(a=a*f/(l/(h*h)+r),u>=10){var c=(u+.5)*Math.log(n/u)-n-logSqrt2PI+u-(.08333333333333333-(.002777777777777778-1/(1260*u*u))/(u*u))/u;if(Math.log(a*o)<=c)return u}else if(u>=0){var d,b=(d=logFactorial(u))!=null?d:0;if(Math.log(a)<=u*Math.log(n)-n-b)return u}}}}}},exponential=function(t,n){return n===void 0&&(n=1),numberValidator(n).isPositive(),function(){return-Math.log(1-t.next())/n}},irwinHall=function(t,n){return n===void 0&&(n=1),numberValidator(n).isInt().greaterThanOrEqual(0),function(){for(var e=0,o=0;o<n;++o)e+=t.next();return e}},bates=function(t,n){n===void 0&&(n=1),numberValidator(n).isInt().isPositive();var e=t.irwinHall(n);return function(){return e()/n}},pareto=function(t,n){n===void 0&&(n=1),numberValidator(n).greaterThanOrEqual(0);var e=1/n;return function(){return 1/Math.pow(1-t.next(),e)}},RNGMathRandom=function(t){_inheritsLoose(n,t);function n(){return t.apply(this,arguments)||this}var e=n.prototype;return e.next=function(){return Math.random()},e.seed=function(r,l){},e.clone=function(){return new n},_createClass(n,[{key:"name",get:function(){return"default"}}]),n}(RNG),Random=function(){function t(e){var o=this;this._rng=void 0,this._patch=void 0,this._cache={},this.next=function(){return o._rng.next()},this.float=function(r,l){return o.uniform(r,l)()},this.int=function(r,l){return o.uniformInt(r,l)()},this.integer=function(r,l){return o.uniformInt(r,l)()},this.bool=function(){return o.uniformBoolean()()},this.boolean=function(){return o.uniformBoolean()()},this.uniform=function(r,l){return o._memoize("uniform",uniform,r,l)},this.uniformInt=function(r,l){return o._memoize("uniformInt",uniformInt,r,l)},this.uniformBoolean=function(){return o._memoize("uniformBoolean",uniformBoolean)},this.normal=function(r,l){return normal(o,r,l)},this.logNormal=function(r,l){return logNormal(o,r,l)},this.bernoulli=function(r){return bernoulli(o,r)},this.binomial=function(r,l){return binomial(o,r,l)},this.geometric=function(r){return geometric(o,r)},this.poisson=function(r){return poisson(o,r)},this.exponential=function(r){return exponential(o,r)},this.irwinHall=function(r){return irwinHall(o,r)},this.bates=function(r){return bates(o,r)},this.pareto=function(r){return pareto(o,r)},e&&e instanceof RNG?this.use(e):this.use(new RNGMathRandom),this._cache={}}var n=t.prototype;return n.clone=function(){var o=[].slice.call(arguments);return o.length?new t(RNGFactory.apply(void 0,o)):new t(this.rng.clone())},n.use=function(){this._rng=RNGFactory.apply(void 0,[].slice.call(arguments))},n.patch=function(){if(this._patch)throw new Error("Math.random already patched");this._patch=Math.random,Math.random=this.uniform()},n.unpatch=function(){this._patch&&(Math.random=this._patch,delete this._patch)},n.choice=function(o){if(!Array.isArray(o))throw new Error("Random.choice expected input to be an array, got "+typeof o);var r=o==null?void 0:o.length;if(r>0){var l=this.uniformInt(0,r-1)();return o[l]}else return},n._memoize=function(o,r){var l=[].slice.call(arguments,2),f=""+l.join(";"),s=this._cache[o];return(s===void 0||s.key!==f)&&(s={key:f,distribution:r.apply(void 0,[this].concat(l))},this._cache[o]=s),s.distribution},_createClass(t,[{key:"rng",get:function(){return this._rng}}]),t}(),random=new Random;class Zobrist{constructor({size:n}){this.max=arrayN(n).map(o=>arrayN(n).map(()=>random.int(0,1073741824))),this.min=arrayN(n).map(o=>arrayN(n).map(()=>random.int(0,1073741824))),this.code=random.int(0,1073741824),this.hash={}}go(n,e,o){this.code^=o?this.max[n][e]:this.min[n][e]}get(){return this.hash[this.code]}set(n){this.hash[this.code]=n}resetHash(){this.hash={}}}const{l1,d2,l2,l2x2,d3,l3,d4,l4,l5}=chessModeBit;function evaluate(t,n){const e=this.winner;if(e===1)return Score.win;if(e===2)return-Score.win;if(t)return 0;let o=0,r=0,l=0,f=0,s=0,i=0,a=0,h=0,u=0,c=0,d=0,b=0,y=0,w=0,E=0,N=0;const k=(g,C)=>{if(C<34)return;const P=serialPointMode[C];if(P)if(g===1)switch(P){case l1:return h++;case d2:return a++;case l2:return i++;case l2x2:return i+=2;case d3:return s++;case l3:return f++;case d4:return l++;case l4:return r++;case l5:return o++;default:return console.error("error")}else switch(P){case l1:return N++;case d2:return E++;case l2:return w++;case l2x2:return w+=2;case d3:return y++;case l3:return b++;case d4:return d++;case l4:return c++;case l5:return u++;default:return console.error("error")}},m=(g,C,P)=>{let S=1,_=0,L=!1;for(let A=0;A<15;A++){const W=P&3;if(P>>=2,W===C||W===3){k(g,S),S=1,L=!0;continue}else if(W===0)if(_===0)_++,S<<=1;else{S<<=1,!(P&12)&&A!==14&&(S<<=1),k(g,S),S=4,!(P&12)&&A!==14&&(S<<=1),_=0,L=!0;continue}else _=0,L=!1,S<<=1,S+=1}L||k(g,S)};for(let g=0;g<this.node0.length;g++)m(1,2,this.node0[g]);for(let g=0;g<this.node1.length;g++)m(1,2,this.node1[g]);for(let g=0;g<this.node2.length;g++)m(1,2,this.node2[g]);for(let g=0;g<this.node3.length;g++)m(1,2,this.node3[g]);for(let g=0;g<this.node0.length;g++)m(2,1,this.node0[g]);for(let g=0;g<this.node1.length;g++)m(2,1,this.node1[g]);for(let g=0;g<this.node2.length;g++)m(2,1,this.node2[g]);for(let g=0;g<this.node3.length;g++)m(2,1,this.node3[g]);n&&(console.log({maxL1:h,maxD2:a,maxL2:i,maxD3:s,maxL3:f,maxD4:l,maxL4:r,maxL5:o}),console.log({minL1:N,minD2:E,minL2:w,minD3:y,minL3:b,minD4:d,minL4:c,minL5:u}));let v=0,M=0;if((this.seekDepth&1)===0){if(r||l)return Score.l5;if(c||d>2||b>2||b&d)return-Score.l5;f&&!c&&!d&&(v+=Score.l4)}else{if(c||d)return-Score.l5;if(r)return Score.l5;if(l>2||f>2||f&l)return-Score.l5;b&&!r&&!l&&(M+=Score.l4)}return v=Score.l5*o+Score.l4*r+Score.d4*l+Score.l3*f+Score.d3*s+Score.l2*i+Score.d2*a+Score.l1*a,M=Score.l5*u+Score.l4*c+Score.d4*d+Score.l3*b+Score.d3*y+Score.l2*w+Score.d2*E+Score.l1*E,v*this.attackFactor-M*this.defenseFactor}function genChilds(t,n,e){let o=[],r=[],l=[],f=[],s=[],i=[],a=[],h=[],u=[],c=[],d=[];for(let y=0;y<t.length;y++){const w=t[y],[E,N]=w;let k=0,m=0,v=getPointMode(this.maxPointsScore[E][N][0]);{const x=getPointMode(this.maxPointsScore[E][N][1]),p=getPointMode(this.maxPointsScore[E][N][2]),g=getPointMode(this.maxPointsScore[E][N][3]);v.l5+=x.l5+p.l5+g.l5,v.l4+=x.l4+p.l4+g.l4,v.d4+=x.d4+p.d4+g.d4,v.l3+=x.l3+p.l3+g.l3,v.d3+=x.d3+p.d3+g.d3,v.l2+=x.l2+p.l2+g.l2,v.d2+=x.d2+p.d2+g.d2,v.l1+=x.l1+p.l1+g.l1;const{l5:C,l4:P,d4:S,l3:_}=v;C?o.push(w):P?l.push(w):(_&&S&&u.push(w),_>1&&h.push(w),_&&a.push(w),S&&s.push(w)),k=calcEvaPointScore(v)}let M=getPointMode(this.minPointsScore[E][N][0]);{const x=getPointMode(this.minPointsScore[E][N][1]),p=getPointMode(this.minPointsScore[E][N][2]),g=getPointMode(this.minPointsScore[E][N][3]);M.l5+=x.l5+p.l5+g.l5,M.l4+=x.l4+p.l4+g.l4,M.d4+=x.d4+p.d4+g.d4,M.l3+=x.l3+p.l3+g.l3,M.d3+=x.d3+p.d3+g.d3,M.l2+=x.l2+p.l2+g.l2,M.d2+=x.d2+p.d2+g.d2,M.l1+=x.l1+p.l1+g.l1;const{l5:C,l4:P,d4:S,l3:_}=M;C?r.push(w):P?f.push(w):(_&&S&&c.push(w),S&&i.push(w)),m=calcEvaPointScore(M)}d.push({position:[E,N],score:k*this.attackFactor+m*this.defenseFactor})}let b;if(n){if(e)return o.length?o:r.length?[]:l.length?l:u.length||s.length?u.concat(s):f.length||i.length?[]:h.length?h:a.length?a:[];if(o.length)return o;if(r.length)return r;if(l.length)return l;if(f.length)return f;if(u.length)return u;if(c.length)return c}else{if(r.length)return r;if(o.length)return o;if(f.length)return f;if(l.length)return l;if(c.length)return c;if(u.length)return u}return b=d.sort((y,w)=>w.score-y.score).map(y=>y.position),b.length<=this.genLimit?b:b.slice(0,this.genLimit)}class Gobang{constructor(t){O(this,"genChilds",genChilds);this.init({...t})}init({firstHand:t,seekDepth:n,autoPlay:e,enableStats:o,attackFactor:r,defenseFactor:l}){this.totalChessPieces=15*15,this.initNode(),this.stack=[],this.zobrist=new Zobrist({size:15}),this.maxPointsScore=arrayN(15).map(f=>arrayN(15,[0,0,0,0])),this.minPointsScore=arrayN(15).map(f=>arrayN(15,[0,0,0,0])),this.stats={},this.enableStats=o!==void 0?o:!0,this.enableLog=!1,this.firstHand=t||2,this.genLimit=20,this.seekDepth=n||4,this.seekKillDepth=17,this.autoPlay=e||!1,this.attackFactor=r||1,this.defenseFactor=l||2}isWall(t,n){return t<0||t>=15||n<0||n>=15}initNode(){this.node0=arrayN(15,0);const t=new ArrayBuffer(4*15);this.node1=new Int32Array(t);for(let n=0;n<=14;n++)this.node1[n]=0;this.node2=[];for(let n=0;n<15*2-1;n++){let e=0;for(let o=0;o<15;o++){const r=n-o;e<<=2,this.isWall(o,r)&&(e+=3)}this.node2[n]=e}this.node3=[];for(let n=0;n<15*2-1;n++){let e=0;for(let o=0;o<15;o++){const r=14+o-n;e<<=2,this.isWall(o,r)&&(e+=3)}this.node3[n]=e}}put(t,n,e){this.zobrist.go(t,n,e===1),this.stack.push([t,n]),this.node0[t]=this.node0[t]|e<<2*(14-n),this.node1[n]=this.node1[n]|e<<2*(14-t),this.node2[t+n]=this.node2[t+n]|e<<2*(14-t),this.node3[14+t-n]=this.node3[14+t-n]|e<<2*(14-t),this.updateFourLineScore(t,n)}rollback(t=1){if(!(this.stack.length<t))for(;t-- >0;){const[n,e]=this.stack.pop();this.zobrist.go(n,e,this.getChess(n,e)===1);const o=2*(14-e);this.node0[n]=(this.node0[n]|3<<o)^3<<o;const r=2*(14-n);this.node1[e]=(this.node1[e]|3<<r)^3<<r,this.node2[n+e]=(this.node2[n+e]|3<<r)^3<<r,this.node3[14+n-e]=(this.node3[14+n-e]|3<<r)^3<<r,this.updateFourLineScore(n,e)}}maxGo(){if(this.isFinal)return;this.zobrist.resetHash(),this.initStats();let t;this.stack.length>4&&(console.time("thinking kill"),t=this.minimax(this.seekKillDepth,!0),console.timeEnd("thinking kill")),(t==null?void 0:t.score)>=Score.win?console.warn("算杀成功 :)"):(console.time("thinking"),t=this.minimax(this.seekDepth),console.timeEnd("thinking")),console.log({score:t});const{i:n,j:e}=t;return this.put(n,e,1),this.logStats(),t}minGo(t,n){if(!this.isFinal)return this.isEmptyPosition(t,n)?(this.put(t,n,2),!0):!1}minRepent(){this.stack.length>=2&&this.rollback(2)}isEmptyPosition(t,n){return!this.isWall(t,n)&&this.getChess(t,n)===0}getNearPositions(t){const n=[],[o,r]=t;for(let l=-2;l<=2;l++)for(let f=-2;f<=2;f++)this.isEmptyPosition(l+o,f+r)&&n.push([l+o,f+r]);return n}getAllOptimalNextStep(){if(this.stack.length===0)return[[7,7]];if(this.stack.length===1){if(this.isEmptyPosition(7,7))return[[7,7]];const n=7+(Math.random()>.5?1:-1),e=7+(Math.random()>.5?1:-1);return[[n,e]]}let t=[];for(let n=0;n<15;n++)for(let e=0;e<15;e++)this.getChess(n,e)===0&&this.haveNeighbor(n,e)&&t.push([n,e]);return t}haveNeighbor(t,n){for(let o=-2;o<=2;o++)if(!(o+t<0||o+t>=15))for(let r=-2;r<=2;r++){if(r+n<0||r+n>=15||o===0&&r===0)continue;if(this.getChess(o+t,n+r)!==0)return!0}return!1}getChess(t,n){return this.node0[t]>>2*(14-n)&3}minimax(t,n,e=-1/0,o=1/0,r=!0){if(this.isFinal||t===0)return{score:evaluate.call(this,n),depth:t};const l=this.genChilds(this.getAllOptimalNextStep(),r,n);if(!(l!=null&&l.length))return{score:0};if(r){let f=-1/0,s=l[0];for(const h of l){const[u,c]=h;this.put(u,c,1),this.enableStats&&this.stats.abCut.eva++;let d=this.zobrist.get();if(d===void 0?(d=this.minimax(t-1,n,e,o,!r).score,this.zobrist.set(d),this.enableStats&&this.stats.zobrist.miss++):this.enableStats&&this.stats.zobrist.hit++,this.rollback(),d>f&&(f=d,s=h),e=Math.max(e,f),o<=e){this.enableStats&&this.stats.abCut.cut++;break}}const[i,a]=s;return{score:f,i,j:a}}else{let f=1/0,s=l[0];for(const h of l){const[u,c]=h;this.put(u,c,2),this.enableStats&&this.stats.abCut.eva++;let d=this.zobrist.get();if(d===void 0?(d=this.minimax(t-1,n,e,o,!r).score,this.zobrist.set(d),this.enableStats&&this.stats.zobrist.miss++):this.enableStats&&this.stats.zobrist.hit++,this.rollback(),d<f&&(f=d,s=h),o=Math.min(o,f),o<=e){this.enableStats&&this.stats.abCut.cut++;break}}const[i,a]=s;return{score:f,i,j:a}}}getChessInFourDirection(t,n,e){let o=[],r=[],l=[],f=[];if(e===void 0||e===0){const s=this.node0[t],i=n>=4?s>>2*(18-n)&3:3,a=n>=3?s>>2*(17-n)&3:3,h=n>=2?s>>2*(16-n)&3:3,u=n>=1?s>>2*(15-n)&3:3,c=s>>2*(14-n)&3,d=n<=13?s>>2*(13-n)&3:3,b=n<=12?s>>2*(12-n)&3:3,y=n<=11?s>>2*(11-n)&3:3,w=n<=10?s>>2*(10-n)&3:3;if(o=[i,a,h,u,c,d,b,y,w],e===0)return o}if(e===void 0||e===1){const s=this.node1[n],i=t>=4?s>>2*(18-t)&3:3,a=t>=3?s>>2*(17-t)&3:3,h=t>=2?s>>2*(16-t)&3:3,u=t>=1?s>>2*(15-t)&3:3,c=s>>2*(14-t)&3,d=t<=13?s>>2*(13-t)&3:3,b=t<=12?s>>2*(12-t)&3:3,y=t<=11?s>>2*(11-t)&3:3,w=t<=10?s>>2*(10-t)&3:3;if(r=[i,a,h,u,c,d,b,y,w],e===1)return r}if(e===void 0||e===2){const s=this.node2[t+n],i=t>=4?s>>2*(18-t)&3:3,a=t>=3?s>>2*(17-t)&3:3,h=t>=2?s>>2*(16-t)&3:3,u=t>=1?s>>2*(15-t)&3:3,c=s>>2*(14-t)&3,d=t<=13?s>>2*(13-t)&3:3,b=t<=12?s>>2*(12-t)&3:3,y=t<=11?s>>2*(11-t)&3:3,w=t<=10?s>>2*(10-t)&3:3;if(l=[i,a,h,u,c,d,b,y,w],e===2)return l}if(e===void 0||e===3){const s=this.node3[14+t-n],i=t>=4?s>>2*(18-t)&3:3,a=t>=3?s>>2*(17-t)&3:3,h=t>=2?s>>2*(16-t)&3:3,u=t>=1?s>>2*(15-t)&3:3,c=s>>2*(14-t)&3,d=t<=13?s>>2*(13-t)&3:3,b=t<=12?s>>2*(12-t)&3:3,y=t<=11?s>>2*(11-t)&3:3,w=t<=10?s>>2*(10-t)&3:3;if(f=[i,a,h,u,c,d,b,y,w],e===3)return f}return[o,r,l,f]}getPositionsInFourDirection(t,n){let e=[],o=[],r=[],l=[];const f=t-4>0?t-4:0,s=t+4<15-1?t+4:15-1,i=n-4>0?n-4:0,a=n+4<15-1?n+4:15-1;for(let h=i;h<=a;h++)e.push([t,h]);for(let h=f;h<=s;h++)o.push([h,n]);for(let h=4;h>0;h--)t-h>=f&&n+h<=a&&r.push([t-h,n+h]);r.push([t,n]);for(let h=1;h<=4;h++)t+h<=s&&n-h>=i&&r.push([t+h,n-h]);for(let h=4;h>0;h--)t-h>=f&&n-h>=i&&l.push([t-h,n-h]);l.push([t,n]);for(let h=1;h<=4;h++)t+h<=s&&n+h<=a&&l.push([t+h,n+h]);return[e,o,r,l]}updateFourLineScore(t,n){const e=this.getPositionsInFourDirection(t,n);for(let o=0;o<4;o++){const r=e[o];for(let l=0;l<r.length;l++){const f=r[l];this.updatePointScore(f,o)}}}updatePointScore(t,n){const[e,o]=t;this.getChess(e,o)!==0?(this.maxPointsScore[e][o]=[0,0,0,0],this.minPointsScore[e][o]=[0,0,0,0]):(this.maxPointsScore[e][o][n]=this.evaPoint(e,o,1,n),this.minPointsScore[e][o][n]=this.evaPoint(e,o,2,n))}evaPoint(t,n,e,o){const r=this.getChessInFourDirection(t,n,o),s=countLine(e===1?1:2,e===1?2:1,3);let i=0;const a=s(r),h=serialPointMode[a];return i+=h||0,i}saveStack(){console.log(JSON.stringify(this.stack))}restoreStack(t){let n=this.firstHand,e=n===1?2:1;for(var o=0;o<t.length;o++){const[r,l]=t[o];this.put(r,l,o&1?e:n)}}test(data){console.log(eval(data))}get winner(){if(this.stack.length<7)return null;const[t,n]=this.stack[this.stack.length-1],e=this.getChess(t,n),o=this.getChessInFourDirection(t,n);for(let r=0;r<4;r++){let l=0;const f=o[r];for(let s=0;s<f.length;s++)if(f[s]===e?l++:l=0,l===5)return e}return null}get winnerPositions(){if(!this.winner)return null;const[t,n]=this.stack[this.stack.length-1],e=this.getChess(t,n),o=this.getPositionsInFourDirection(t,n);for(let r=0;r<4;r++){const l=o[r];let f=0,s=[];for(let i=0;i<l.length;i++){const[a,h]=l[i];if(this.getChess(a,h)===e?(f++,s.push([a,h])):(f=0,s=[]),f===5)return s}}return null}get isFinal(){return!!this.winner||this.isBoardFull}get isBoardFull(){return this.stack.length===this.totalChessPieces}get lastChessPosition(){return this.stack.length?this.stack[this.stack.length-1]:null}get isDraw(){return this.isBoardFull&&!this.winner}get node(){return this.node0.map(t=>{let n=[];for(let e=0;e<15;e++)n.push((t&3<<2*e)>>2*e);return n.reverse()})}printNode(){console.log(this.node0.map(t=>t.toString(2))),console.log(this.node1.map(t=>t.toString(2))),console.log(this.node2.map(t=>t.toString(2))),console.log(this.node3.map(t=>t.toString(2)))}initStats(){this.stats={abCut:{all:this.genLimit**this.seekDepth,eva:0,cut:0,toString(){const{all:t,eva:n,cut:e}=this.stats.abCut,o=t-n;return`AB剪枝 最大节点总数:${t} 理论最少评估${t**.5>>0} 实际评估:${n} 剪去:${e}/${o}`}},zobrist:{miss:0,hit:0,toString(){const{hit:t,miss:n}=this.stats.zobrist;return`zobrist 评估节点数:${this.stats.abCut.eva} hit:${t} miss:${n}`}}}}logStats(){this.enableStats&&Object.keys(this.stats).forEach(t=>{console.log(this.stats[t].toString.call(this))})}}O(Gobang,"MAX",1),O(Gobang,"MIN",2),O(Gobang,"EMPTY",0),O(Gobang,"WALL",3);var Chessboard=function(t,n){this.data=[],this.row=t,this.column=n,this.wins=[],this.count=0,this.maxWin=[],this.minWin=[];for(var e=0;e<t;e++){this.data[e]=[],this.wins[e]=[];for(var o=0;o<n;o++)this.data[e][o]=Chessboard.NONE,this.wins[e][o]=[]}for(var e=0;e<t;e++)for(var o=0;o<=n-5;o++){for(var r=0;r<5;r++)this.wins[e][o+r][this.count]=!0;this.count++}for(var e=0;e<n;e++)for(var o=0;o<=t-5;o++){for(var r=0;r<5;r++)this.wins[o+r][e][this.count]=!0;this.count++}for(var e=0;e<=t-5;e++)for(var o=0;o<=n-5;o++){for(var r=0;r<5;r++)this.wins[e+r][o+r][this.count]=!0;this.count++}for(var e=0;e<=t-5;e++)for(var o=n-1;o>=4;o--){for(var r=0;r<5;r++)this.wins[e+r][o-r][this.count]=!0;this.count++}for(var e=0;e<this.count;e++)this.maxWin[e]={max:0,min:0},this.minWin[e]={min:0,max:0};this.stack=[],this.is_ended=!1};Chessboard.prototype.toString=function(){return this.data.map(function(t){return t.toString()}).join(`
`)},Chessboard.prototype.current=function(){var t=this.stack.length;if(t)return this.stack[t-1]},Chessboard.prototype.put=function(t,n,e){if(this.data[t][n]==Chessboard.NONE){this.data[t][n]=e,this.stack.push({row:t,column:n,type:e});for(var o=0;o<this.count;o++)this.wins[t][n][o]&&(e==Chessboard.MAX?(this.maxWin[o].max++,this.minWin[o].max++):(this.minWin[o].min++,this.maxWin[o].min++));this.stack.length==this.row*this.column&&this.end()}return this},Chessboard.prototype.rollback=function(t){var n=[];t=t||1;for(var e=0;e<t;e++){var o=this.stack.pop();if(o){n.push(o);var r=o.row,l=o.column,f=o.type;this.data[r][l]=Chessboard.NONE;for(var s=0;s<this.count;s++)this.wins[r][l][s]&&(f==Chessboard.MAX?(this.maxWin[s].max--,this.minWin[s].max--):(this.minWin[s].min--,this.maxWin[s].min--))}}return this.is_ended=!1,n},Chessboard.prototype.getNearPoints=function(t){for(var n=[],e,o,r=-2;r<=2;r++)e=t.row+r,o=t.column+r,this.isValid(e,o)&&n.push({row:e,column:o}),e=t.row-r,o=t.column+r,this.isValid(e,o)&&n.push({row:e,column:o}),e=t.row,o=t.column-r,this.isValid(e,o)&&n.push({row:e,column:o}),e=t.row-r,o=t.column,this.isValid(e,o)&&n.push({row:e,column:o});return n},Chessboard.prototype.isValid=function(t,n){return t>=0&&t<this.row&&n>=0&&n<this.column&&this.data[t][n]==Chessboard.NONE},Chessboard.prototype.availableSteps=function(){var t=[],n=this.row,e=this.column,o=this.stack.length,r=Math.floor((n-1)/2),l=Math.floor((e-1)/2);if(!o||o==1&&this.data[r][l]==Chessboard.NONE)return t.push({row:r,column:l}),t;if(o==1){var f=r+(Math.random()<.5?-1:1),s=l+(Math.random()<.5?-1:1);return t.push({row:f,column:s}),t}else{var i={};return this.stack.forEach(function(a){var h=this.getNearPoints(a);h.forEach(function(u){var c=u.row,d=u.column;i[c+"#"+d]||(t.push(u),i[c+"#"+d]=!0)})}.bind(this)),t}},Chessboard.prototype.evaluate=function(){for(var o=r=0,t={5:0,4:0,3:0,2:0,1:0},n={5:0,4:0,3:0,2:0,1:0},e=0;e<this.count;e++){if(this.maxWin[e].max==5&&!this.maxWin[e].min)return Chessboard.MAX_VALUE;if(this.minWin[e].min==5&&!this.minWin[e].max)return Chessboard.MIN_VALUE;this.maxWin[e].max==4&&!this.maxWin[e].min&&t[4]++,this.minWin[e].min==4&&!this.minWin[e].max&&n[4]++,this.maxWin[e].max==3&&!this.maxWin[e].min&&t[3]++,this.minWin[e].min==3&&!this.minWin[e].max&&n[3]++,this.maxWin[e].max==2&&!this.maxWin[e].min&&t[2]++,this.minWin[e].min==2&&!this.minWin[e].max&&n[2]++,this.maxWin[e].max==1&&!this.maxWin[e].min&&t[1]++,this.minWin[e].min==1&&!this.minWin[e].max&&n[1]++}var o=t[4]*Chessboard.FOUR_W+t[3]*Chessboard.THREE_W+t[2]*Chessboard.TWO_W+t[1]*Chessboard.ONE_W,r=n[4]*Chessboard.FOUR_W+n[3]*Chessboard.THREE_W+n[2]*Chessboard.TWO_W+n[1]*Chessboard.ONE_W;return o-r},Chessboard.prototype.isMaxWin=function(){var t=this.evaluate();return t==Chessboard.MAX_VALUE},Chessboard.prototype.isMinWin=function(){var t=this.evaluate();return t==Chessboard.MIN_VALUE},Chessboard.prototype.end=function(){return this.is_ended=!0,this},Chessboard.prototype.isEnded=function(){return this.is_ended},Chessboard.prototype.max=function(t,n,e){var o,r,l=-1/0;if(n==0)return l=t.evaluate(),{w:l};var f=t.availableSteps();if(f.length){for(var s=0,i=f.length;s<i;s++){var a=f[s];if(t.put(a.row,a.column,Chessboard.MAX),t.isMaxWin()){l=Chessboard.MAX_VALUE,o=a.row,r=a.column,t.rollback();break}else{var h=Chessboard.prototype.min(t,n-1)||{w:t.evaluate()};if(t.rollback(),h.w>l&&(l=h.w,o=a.row,r=a.column),l>=e)break}}return{w:l,row:o,column:r}}},Chessboard.prototype.min=function(t,n,e){var o,r,l=1/0;if(n==0)return l=t.evaluate(),{w:l};var f=t.availableSteps();if(f.length){for(var s=0,i=f.length;s<i;s++){var a=f[s];if(t.put(a.row,a.column,Chessboard.MIN),t.isMinWin()){l=Chessboard.MIN_VALUE,o=a.row,r=a.column,t.rollback();break}else{var h=Chessboard.prototype.max(t,n-1,l)||{w:t.evaluate()};if(t.rollback(),h.w<l&&(l=h.w,o=a.row,r=a.column),l<=e)break}}return{w:l,row:o,column:r}}},Chessboard.NONE=0,Chessboard.MAX=1,Chessboard.MIN=2,Chessboard.FIVE_TYPE=1,Chessboard.FOUR_TYPE=3,Chessboard.THREE_TYPE=5,Chessboard.TWO_TYPE=7,Chessboard.MAX_VALUE=1e5,Chessboard.MIN_VALUE=-1e5,Chessboard.FOUR_W=5e3,Chessboard.THREE_W=1e3,Chessboard.TWO_W=200,Chessboard.ONE_W=10;let gobang=new Gobang;onmessage=async function(t){const{type:n,data:e}=t.data;let o;switch(n){case"init":gobang.init(e),gobang.autoPlay&&autoPlayWithOtherAI();break;case"maxGo":o=gobang.maxGo();break;case"minGo":o=gobang.minGo(...e);break;case"minRepent":o=gobang.minRepent();break;case"reStart":o=gobang.init({});break;case"test":o=gobang.test(e);break}senMessage(n,o)};const senMessage=(t,n)=>postMessage({type:t,data:n,gobang:JSON.stringify({...gobang,node:gobang.node,stack:gobang.stack,firstHand:gobang.firstHand,lastChessPosition:gobang.lastChessPosition,winnerPositions:gobang.winnerPositions,isDraw:gobang.isDraw,winner:gobang.winner,isFinal:gobang.isFinal})}),autoPlayWithOtherAI=async()=>{const t=new Chessboard(15,15),n=async()=>{if(gobang.isFinal)return;const{i:o,j:r}=gobang.maxGo();t.put(o,r,Chessboard.MIN),senMessage("autoPlay")},e=async()=>{if(gobang.isFinal)return;console.time("other AI");const{row:o,column:r}=Chessboard.prototype.max(t,2);console.timeEnd("other AI"),t.put(o,r,Chessboard.MAX),gobang.minGo(o,r),senMessage("autoPlay")};for(gobang.genLimit=40,gobang.seekDepth=4;gobang.autoPlay&&!gobang.isFinal;)await n(),await wait(50),await e(),await wait(50)}})();
