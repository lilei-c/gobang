var G=Object.defineProperty;var D=(t,e,n)=>e in t?G(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var j=(t,e,n)=>(D(t,typeof e!="symbol"?e+"":e,n),n);(function(){"use strict";const EMPTY=0,MAX=1,MIN=2,WALL=3,boardLength=15,boardCenter=7,chessModeBit={l1:1,d2:8,l2:64,l2x2:128,d3:512,l3:4096,d4:16384,l4:65536,l5:262144},getPointMode=t=>({l1:t&7,d2:(t&56)>>3,l2:(t&960)>>6,d3:(t&7680)>>9,l3:(t&12288)>>12,d4:(t&49152)>>14,l4:(t&196608)>>16,l5:(t&786432)>>18}),Score={l1:10,d2:10,d3:200,l2:150,l2x2:300,l3:200,d4:2e3,l4:5e3,l5:1e4,win:1e5},calcEvaPointScore=t=>{const{l5:e,l4:n,d4:o,l3:i,d3:c,l2:d,d2:s,l1:r}=t;let l=0;return e&&(l+=Score.l5*e),n&&(l+=Score.l4*n),o&&(l+=Score.d4*o),i&&(l+=Score.l3*i),c&&(l+=Score.d3*c),d&&(l+=Score.l2*d),s&&(l+=Score.d2*s),r&&(l+=Score.l1*r),l};console.warn("todo: 测试 countLine 是否正确");const countLine=(t,e,n)=>o=>{let i=1;for(let c=0;c<o.length;c++){const d=o[c];if(c<4)i<<=1,d===t?i+=1:(d===e||d===n)&&(i=1);else if(c===4)i<<=1,i+=1;else{if(d===e||d===n)break;i<<=1,d===t&&(i+=1)}}return i},generateAllModes=t=>{let e=[],n=2**(t+1);for(;n-- >0;)e.push("0b"+n.toString(2));return e},allModes=generateAllModes(11),isLive1=t=>/010/.test(t)&&t.length>5,isDead2=t=>/10{0,1}1/.test(t)&&t.length>=5,isLive2=t=>[/000110/,/001100/,/011000/,/001010/,/010100/].some(e=>e.test(t)),isLive2x2=t=>/0101010/.test(t),isDead3=t=>[/111/,/1011/,/1101/,/11001/,/10011/,/10101/].some(e=>e.test(t))&&t.length>=5,isLive3=t=>[/010110/,/011010/,/01110/,/1010101/].some(e=>e.test(t)),isDead4=t=>[/11110/,/01111/,/11011/,/11101/,/10111/].some(e=>e.test(t)),isLive4=t=>[/011110/,/1011101/,/11011011/,/111010111/].some(e=>e.test(t)),is5=t=>/1{5}/.test(t),stat={};allModes.forEach(t=>stat[t]=null);const serialPointMode=[],{l5:l5$1,l4:l4$1,d4:d4$1,l3:l3$1,d3:d3$1,l2:l2$1,l2x2:l2x2$1,d2:d2$1,l1:l1$1}=chessModeBit;allModes.forEach(t=>isLive1(t.slice(3))&&(stat[t]="l1")&&(serialPointMode[+t]=l1$1)),allModes.forEach(t=>isDead2(t.slice(3))&&(stat[t]="d2")&&(serialPointMode[+t]=d2$1)),allModes.forEach(t=>isLive2(t.slice(3))&&(stat[t]="l2")&&(serialPointMode[+t]=l2$1)),allModes.forEach(t=>isDead3(t.slice(3))&&(stat[t]="d3")&&(serialPointMode[+t]=d3$1)),allModes.forEach(t=>isLive2x2(t.slice(3))&&(stat[t]="l2x2")&&(serialPointMode[+t]=l2x2$1)),allModes.forEach(t=>isLive3(t.slice(3))&&(stat[t]="l3")&&(serialPointMode[+t]=l3$1)),allModes.forEach(t=>isDead4(t.slice(3))&&(stat[t]="d4")&&(serialPointMode[+t]=d4$1)),allModes.forEach(t=>isLive4(t.slice(3))&&(stat[t]="l4")&&(serialPointMode[+t]=l4$1)),allModes.forEach(t=>is5(t.slice(3))&&(stat[t]="l5")&&(serialPointMode[+t]=l5$1)),console.log("未构成棋型的组合, 这一部分已经验证",Object.keys(stat).filter(t=>!stat[t]).map(t=>t.slice(3))),console.warn("todo: 验证以下棋型是否正确"),Object.keys(Score).forEach(t=>{console.log(t,Object.keys(stat).filter(e=>stat[e]===t).map(e=>e.slice(3)))}),console.log({allModes,serialPointMode});const arrayN=(t,e=null)=>Array(t).fill(e),wait=t=>new Promise(e=>setTimeout(e,t));var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getAugmentedNamespace(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function o(){if(this instanceof o){var i=[null];i.push.apply(i,arguments);var c=Function.bind.apply(e,i);return new c}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(o){var i=Object.getOwnPropertyDescriptor(t,o);Object.defineProperty(n,o,i.get?i:{enumerable:!0,get:function(){return t[o]}})}),n}var aleaExports={},alea$1={get exports(){return aleaExports},set exports(t){aleaExports=t}};(function(t){(function(e,n,o){function i(r){var l=this,a=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=a(" "),l.s1=a(" "),l.s2=a(" "),l.s0-=a(r),l.s0<0&&(l.s0+=1),l.s1-=a(r),l.s1<0&&(l.s1+=1),l.s2-=a(r),l.s2<0&&(l.s2+=1),a=null}function c(r,l){return l.c=r.c,l.s0=r.s0,l.s1=r.s1,l.s2=r.s2,l}function d(r,l){var a=new i(r),u=l&&l.state,h=a.next;return h.int32=function(){return a.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,u&&(typeof u=="object"&&c(u,a),h.state=function(){return c(a,{})}),h}function s(){var r=4022871197,l=function(a){a=String(a);for(var u=0;u<a.length;u++){r+=a.charCodeAt(u);var h=.02519603282416938*r;r=h>>>0,h-=r,h*=r,r=h>>>0,h-=r,r+=h*4294967296}return(r>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=d:o&&o.amd?o(function(){return d}):this.alea=d})(commonjsGlobal,t,!1)})(alea$1);var xor128Exports={},xor128$1={get exports(){return xor128Exports},set exports(t){xor128Exports=t}};(function(t){(function(e,n,o){function i(s){var r=this,l="";r.x=0,r.y=0,r.z=0,r.w=0,r.next=function(){var u=r.x^r.x<<11;return r.x=r.y,r.y=r.z,r.z=r.w,r.w^=r.w>>>19^u^u>>>8},s===(s|0)?r.x=s:l+=s;for(var a=0;a<l.length+64;a++)r.x^=l.charCodeAt(a)|0,r.next()}function c(s,r){return r.x=s.x,r.y=s.y,r.z=s.z,r.w=s.w,r}function d(s,r){var l=new i(s),a=r&&r.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var h=l.next()>>>11,f=(l.next()>>>0)/4294967296,b=(h+f)/(1<<21);while(b===0);return b},u.int32=l.next,u.quick=u,a&&(typeof a=="object"&&c(a,l),u.state=function(){return c(l,{})}),u}n&&n.exports?n.exports=d:o&&o.amd?o(function(){return d}):this.xor128=d})(commonjsGlobal,t,!1)})(xor128$1);var xorwowExports={},xorwow$1={get exports(){return xorwowExports},set exports(t){xorwowExports=t}};(function(t){(function(e,n,o){function i(s){var r=this,l="";r.next=function(){var u=r.x^r.x>>>2;return r.x=r.y,r.y=r.z,r.z=r.w,r.w=r.v,(r.d=r.d+362437|0)+(r.v=r.v^r.v<<4^(u^u<<1))|0},r.x=0,r.y=0,r.z=0,r.w=0,r.v=0,s===(s|0)?r.x=s:l+=s;for(var a=0;a<l.length+64;a++)r.x^=l.charCodeAt(a)|0,a==l.length&&(r.d=r.x<<10^r.x>>>4),r.next()}function c(s,r){return r.x=s.x,r.y=s.y,r.z=s.z,r.w=s.w,r.v=s.v,r.d=s.d,r}function d(s,r){var l=new i(s),a=r&&r.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var h=l.next()>>>11,f=(l.next()>>>0)/4294967296,b=(h+f)/(1<<21);while(b===0);return b},u.int32=l.next,u.quick=u,a&&(typeof a=="object"&&c(a,l),u.state=function(){return c(l,{})}),u}n&&n.exports?n.exports=d:o&&o.amd?o(function(){return d}):this.xorwow=d})(commonjsGlobal,t,!1)})(xorwow$1);var xorshift7Exports={},xorshift7$1={get exports(){return xorshift7Exports},set exports(t){xorshift7Exports=t}};(function(t){(function(e,n,o){function i(s){var r=this;r.next=function(){var a=r.x,u=r.i,h,f;return h=a[u],h^=h>>>7,f=h^h<<24,h=a[u+1&7],f^=h^h>>>10,h=a[u+3&7],f^=h^h>>>3,h=a[u+4&7],f^=h^h<<7,h=a[u+7&7],h=h^h<<13,f^=h^h<<9,a[u]=f,r.i=u+1&7,f};function l(a,u){var h,f=[];if(u===(u|0))f[0]=u;else for(u=""+u,h=0;h<u.length;++h)f[h&7]=f[h&7]<<15^u.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],a.x=f,a.i=0,h=256;h>0;--h)a.next()}l(r,s)}function c(s,r){return r.x=s.x.slice(),r.i=s.i,r}function d(s,r){s==null&&(s=+new Date);var l=new i(s),a=r&&r.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var h=l.next()>>>11,f=(l.next()>>>0)/4294967296,b=(h+f)/(1<<21);while(b===0);return b},u.int32=l.next,u.quick=u,a&&(a.x&&c(a,l),u.state=function(){return c(l,{})}),u}n&&n.exports?n.exports=d:o&&o.amd?o(function(){return d}):this.xorshift7=d})(commonjsGlobal,t,!1)})(xorshift7$1);var xor4096Exports={},xor4096$1={get exports(){return xor4096Exports},set exports(t){xor4096Exports=t}};(function(t){(function(e,n,o){function i(s){var r=this;r.next=function(){var a=r.w,u=r.X,h=r.i,f,b;return r.w=a=a+1640531527|0,b=u[h+34&127],f=u[h=h+1&127],b^=b<<13,f^=f<<17,b^=b>>>15,f^=f>>>12,b=u[h]=b^f,r.i=h,b+(a^a>>>16)|0};function l(a,u){var h,f,b,y,w,P=[],N=128;for(u===(u|0)?(f=u,u=null):(u=u+"\0",f=0,N=Math.max(N,u.length)),b=0,y=-32;y<N;++y)u&&(f^=u.charCodeAt((y+32)%u.length)),y===0&&(w=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,y>=0&&(w=w+1640531527|0,h=P[y&127]^=f+w,b=h==0?b+1:0);for(b>=128&&(P[(u&&u.length||0)&127]=-1),b=127,y=4*128;y>0;--y)f=P[b+34&127],h=P[b=b+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,P[b]=f^h;a.w=w,a.X=P,a.i=b}l(r,s)}function c(s,r){return r.i=s.i,r.w=s.w,r.X=s.X.slice(),r}function d(s,r){s==null&&(s=+new Date);var l=new i(s),a=r&&r.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var h=l.next()>>>11,f=(l.next()>>>0)/4294967296,b=(h+f)/(1<<21);while(b===0);return b},u.int32=l.next,u.quick=u,a&&(a.X&&c(a,l),u.state=function(){return c(l,{})}),u}n&&n.exports?n.exports=d:o&&o.amd?o(function(){return d}):this.xor4096=d})(commonjsGlobal,t,!1)})(xor4096$1);var tycheiExports={},tychei$1={get exports(){return tycheiExports},set exports(t){tycheiExports=t}};(function(t){(function(e,n,o){function i(s){var r=this,l="";r.next=function(){var u=r.b,h=r.c,f=r.d,b=r.a;return u=u<<25^u>>>7^h,h=h-f|0,f=f<<24^f>>>8^b,b=b-u|0,r.b=u=u<<20^u>>>12^h,r.c=h=h-f|0,r.d=f<<16^h>>>16^b,r.a=b-u|0},r.a=0,r.b=0,r.c=-1640531527,r.d=1367130551,s===Math.floor(s)?(r.a=s/4294967296|0,r.b=s|0):l+=s;for(var a=0;a<l.length+20;a++)r.b^=l.charCodeAt(a)|0,r.next()}function c(s,r){return r.a=s.a,r.b=s.b,r.c=s.c,r.d=s.d,r}function d(s,r){var l=new i(s),a=r&&r.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var h=l.next()>>>11,f=(l.next()>>>0)/4294967296,b=(h+f)/(1<<21);while(b===0);return b},u.int32=l.next,u.quick=u,a&&(typeof a=="object"&&c(a,l),u.state=function(){return c(l,{})}),u}n&&n.exports?n.exports=d:o&&o.amd?o(function(){return d}):this.tychei=d})(commonjsGlobal,t,!1)})(tychei$1);var seedrandomExports={},seedrandom$1={get exports(){return seedrandomExports},set exports(t){seedrandomExports=t}},__viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze({__proto__:null,default:__viteBrowserExternal}),require$$0=getAugmentedNamespace(__viteBrowserExternal$1);(function(t){(function(e,n,o){var i=256,c=6,d=52,s="random",r=o.pow(i,c),l=o.pow(2,d),a=l*2,u=i-1,h;function f(p,x,M){var m=[];x=x==!0?{entropy:!0}:x||{};var v=P(w(x.entropy?[p,A(n)]:p??N(),3),m),g=new b(m),L=function(){for(var E=g.g(c),S=r,_=0;E<l;)E=(E+_)*i,S*=i,_=g.g(1);for(;E>=a;)E/=2,S/=2,_>>>=1;return(E+_)/S};return L.int32=function(){return g.g(4)|0},L.quick=function(){return g.g(4)/4294967296},L.double=L,P(A(g.S),n),(x.pass||M||function(E,S,_,k){return k&&(k.S&&y(k,g),E.state=function(){return y(g,{})}),_?(o[s]=E,S):E})(L,v,"global"in x?x.global:this==o,x.state)}function b(p){var x,M=p.length,m=this,v=0,g=m.i=m.j=0,L=m.S=[];for(M||(p=[M++]);v<i;)L[v]=v++;for(v=0;v<i;v++)L[v]=L[g=u&g+p[v%M]+(x=L[v])],L[g]=x;(m.g=function(E){for(var S,_=0,k=m.i,C=m.j,$=m.S;E--;)S=$[k=u&k+1],_=_*i+$[u&($[k]=$[C=u&C+S])+($[C]=S)];return m.i=k,m.j=C,_})(i)}function y(p,x){return x.i=p.i,x.j=p.j,x.S=p.S.slice(),x}function w(p,x){var M=[],m=typeof p,v;if(x&&m=="object")for(v in p)try{M.push(w(p[v],x-1))}catch{}return M.length?M:m=="string"?p:p+"\0"}function P(p,x){for(var M=p+"",m,v=0;v<M.length;)x[u&v]=u&(m^=x[u&v]*19)+M.charCodeAt(v++);return A(x)}function N(){try{var p;return h&&(p=h.randomBytes)?p=p(i):(p=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(p)),A(p)}catch{var x=e.navigator,M=x&&x.plugins;return[+new Date,e,M,e.screen,A(n)]}}function A(p){return String.fromCharCode.apply(0,p)}if(P(o.random(),n),t.exports){t.exports=f;try{h=require$$0}catch{}}else o["seed"+s]=f})(typeof self<"u"?self:commonjsGlobal,[],Math)})(seedrandom$1);var alea=aleaExports,xor128=xor128Exports,xorwow=xorwowExports,xorshift7=xorshift7Exports,xor4096=xor4096Exports,tychei=tycheiExports,sr=seedrandomExports;sr.alea=alea,sr.xor128=xor128,sr.xorwow=xorwow,sr.xorshift7=xorshift7,sr.xor4096=xor4096,sr.tychei=tychei;var seedrandom=sr;function _defineProperties(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,_toPropertyKey(o.key),o)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,i){return o.__proto__=i,o},_setPrototypeOf(t,e)}function _toPrimitive(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var o=n.call(t,e||"default");if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return typeof e=="symbol"?e:String(e)}var RNG=function(){function t(){}var e=t.prototype;return e._seed=function(o,i){if(o===(o||0))return o;for(var c=""+o,d=0,s=0;s<c.length;++s)d^=c.charCodeAt(s)|0;return d},t}(),RNGFunction=function(t){_inheritsLoose(e,t);function e(o,i){var c;return c=t.call(this)||this,c._rng=void 0,c.seed(o,i),c}var n=e.prototype;return n.next=function(){return this._rng()},n.seed=function(i,c){this._rng=i},n.clone=function(i,c){return new e(this._rng,c)},_createClass(e,[{key:"name",get:function(){return"function"}}]),e}(RNG),RNGFactory=function(){var t=[].slice.call(arguments),e=t,n=e[0],o=n===void 0?"default":n;switch(typeof o){case"object":if(o instanceof RNG)return o;break;case"function":return new RNGFunction(o);case"number":case"string":default:return new RNGFunction(seedrandom.apply(void 0,t))}throw new Error('invalid RNG "'+o+'"')},uniform=function(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=1),function(){return t.next()*(n-e)+e}};function numberValidator(t){return new NumberValidator(t)}var NumberValidator=function(e){var n=this;this.n=void 0,this.isInt=function(){if(Number.isInteger(n.n))return n;throw new Error("Expected number to be an integer, got "+n.n)},this.isPositive=function(){if(n.n>0)return n;throw new Error("Expected number to be positive, got "+n.n)},this.lessThan=function(o){if(n.n<o)return n;throw new Error("Expected number to be less than "+o+", got "+n.n)},this.greaterThanOrEqual=function(o){if(n.n>=o)return n;throw new Error("Expected number to be greater than or equal to "+o+", got "+n.n)},this.greaterThan=function(o){if(n.n>o)return n;throw new Error("Expected number to be greater than "+o+", got "+n.n)},this.n=e},uniformInt=function(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=1),n===void 0&&(n=e===void 0?1:e,e=0),numberValidator(e).isInt(),numberValidator(n).isInt(),function(){return Math.floor(t.next()*(n-e+1)+e)}},uniformBoolean=function(t){return function(){return t.next()>=.5}},normal=function(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=1),function(){var o,i,c;do o=t.next()*2-1,i=t.next()*2-1,c=o*o+i*i;while(!c||c>1);return e+n*i*Math.sqrt(-2*Math.log(c)/c)}},logNormal=function(t,e,n){e===void 0&&(e=0),n===void 0&&(n=1);var o=t.normal(e,n);return function(){return Math.exp(o())}},bernoulli=function(t,e){return e===void 0&&(e=.5),numberValidator(e).greaterThanOrEqual(0).lessThan(1),function(){return Math.floor(t.next()+e)}},binomial=function(t,e,n){return e===void 0&&(e=1),n===void 0&&(n=.5),numberValidator(e).isInt().isPositive(),numberValidator(n).greaterThanOrEqual(0).lessThan(1),function(){for(var o=0,i=0;o++<e;)t.next()<n&&i++;return i}},geometric=function(t,e){e===void 0&&(e=.5),numberValidator(e).greaterThan(0).lessThan(1);var n=1/Math.log(1-e);return function(){return Math.floor(1+Math.log(t.next())*n)}},logFactorialTable=[0,0,.6931471805599453,1.791759469228055,3.1780538303479458,4.787491742782046,6.579251212010101,8.525161361065415,10.60460290274525,12.801827480081469],logFactorial=function(e){return logFactorialTable[e]},logSqrt2PI=.9189385332046727,poisson=function(t,e){if(e===void 0&&(e=1),numberValidator(e).isPositive(),e<10){var n=Math.exp(-e);return function(){for(var r=n,l=0,a=t.next();a>r;)a=a-r,r=e*r/++l;return l}}else{var o=Math.sqrt(e),i=.931+2.53*o,c=-.059+.02483*i,d=1.1239+1.1328/(i-3.4),s=.9277-3.6224/(i-2);return function(){for(;;){var r=void 0,l=t.next();if(l<=.86*s)return r=l/s-.43,Math.floor((2*c/(.5-Math.abs(r))+i)*r+e+.445);l>=s?r=t.next()-.5:(r=l/s-.93,r=(r<0?-.5:.5)-r,l=t.next()*s);var a=.5-Math.abs(r);if(!(a<.013&&l>a)){var u=Math.floor((2*c/a+i)*r+e+.445);if(l=l*d/(c/(a*a)+i),u>=10){var h=(u+.5)*Math.log(e/u)-e-logSqrt2PI+u-(.08333333333333333-(.002777777777777778-1/(1260*u*u))/(u*u))/u;if(Math.log(l*o)<=h)return u}else if(u>=0){var f,b=(f=logFactorial(u))!=null?f:0;if(Math.log(l)<=u*Math.log(e)-e-b)return u}}}}}},exponential=function(t,e){return e===void 0&&(e=1),numberValidator(e).isPositive(),function(){return-Math.log(1-t.next())/e}},irwinHall=function(t,e){return e===void 0&&(e=1),numberValidator(e).isInt().greaterThanOrEqual(0),function(){for(var n=0,o=0;o<e;++o)n+=t.next();return n}},bates=function(t,e){e===void 0&&(e=1),numberValidator(e).isInt().isPositive();var n=t.irwinHall(e);return function(){return n()/e}},pareto=function(t,e){e===void 0&&(e=1),numberValidator(e).greaterThanOrEqual(0);var n=1/e;return function(){return 1/Math.pow(1-t.next(),n)}},RNGMathRandom=function(t){_inheritsLoose(e,t);function e(){return t.apply(this,arguments)||this}var n=e.prototype;return n.next=function(){return Math.random()},n.seed=function(i,c){},n.clone=function(){return new e},_createClass(e,[{key:"name",get:function(){return"default"}}]),e}(RNG),Random=function(){function t(n){var o=this;this._rng=void 0,this._patch=void 0,this._cache={},this.next=function(){return o._rng.next()},this.float=function(i,c){return o.uniform(i,c)()},this.int=function(i,c){return o.uniformInt(i,c)()},this.integer=function(i,c){return o.uniformInt(i,c)()},this.bool=function(){return o.uniformBoolean()()},this.boolean=function(){return o.uniformBoolean()()},this.uniform=function(i,c){return o._memoize("uniform",uniform,i,c)},this.uniformInt=function(i,c){return o._memoize("uniformInt",uniformInt,i,c)},this.uniformBoolean=function(){return o._memoize("uniformBoolean",uniformBoolean)},this.normal=function(i,c){return normal(o,i,c)},this.logNormal=function(i,c){return logNormal(o,i,c)},this.bernoulli=function(i){return bernoulli(o,i)},this.binomial=function(i,c){return binomial(o,i,c)},this.geometric=function(i){return geometric(o,i)},this.poisson=function(i){return poisson(o,i)},this.exponential=function(i){return exponential(o,i)},this.irwinHall=function(i){return irwinHall(o,i)},this.bates=function(i){return bates(o,i)},this.pareto=function(i){return pareto(o,i)},n&&n instanceof RNG?this.use(n):this.use(new RNGMathRandom),this._cache={}}var e=t.prototype;return e.clone=function(){var o=[].slice.call(arguments);return o.length?new t(RNGFactory.apply(void 0,o)):new t(this.rng.clone())},e.use=function(){this._rng=RNGFactory.apply(void 0,[].slice.call(arguments))},e.patch=function(){if(this._patch)throw new Error("Math.random already patched");this._patch=Math.random,Math.random=this.uniform()},e.unpatch=function(){this._patch&&(Math.random=this._patch,delete this._patch)},e.choice=function(o){if(!Array.isArray(o))throw new Error("Random.choice expected input to be an array, got "+typeof o);var i=o==null?void 0:o.length;if(i>0){var c=this.uniformInt(0,i-1)();return o[c]}else return},e._memoize=function(o,i){var c=[].slice.call(arguments,2),d=""+c.join(";"),s=this._cache[o];return(s===void 0||s.key!==d)&&(s={key:d,distribution:i.apply(void 0,[this].concat(c))},this._cache[o]=s),s.distribution},_createClass(t,[{key:"rng",get:function(){return this._rng}}]),t}(),random=new Random;class Zobrist{constructor({size:e}){this.max=arrayN(e).map(o=>arrayN(e).map(()=>random.int(0,1073741824))),this.min=arrayN(e).map(o=>arrayN(e).map(()=>random.int(0,1073741824))),this.code=random.int(0,1073741824),this.hash={}}go(e,n,o){this.code^=o?this.max[e][n]:this.min[e][n]}get(){return this.hash[this.code]}set(e){this.hash[this.code]=e}resetHash(){this.hash={}}}const{l1,d2,l2,l2x2,d3,l3,d4,l4,l5}=chessModeBit;function evaluate(t,e){const n=this.winner;if(n===1)return Score.win;if(n===2)return-Score.win;if(t)return 0;let o=0,i=0,c=0,d=0,s=0,r=0,l=0,a=0,u=0,h=0,f=0,b=0,y=0,w=0,P=0,N=0;const A=(g,L)=>{if(L<34)return;const E=serialPointMode[L];if(E)if(g===1)switch(E){case l1:return a++;case d2:return l++;case l2:return r++;case l2x2:return r+=2;case d3:return s++;case l3:return d++;case d4:return c++;case l4:return i++;case l5:return o++;default:return console.error("error")}else switch(E){case l1:return N++;case d2:return P++;case l2:return w++;case l2x2:return w+=2;case d3:return y++;case l3:return b++;case d4:return f++;case l4:return h++;case l5:return u++;default:return console.error("error")}},p=(g,L,E)=>{let S=1,_=0,k=!1;for(let C=0;C<15;C++){const $=E&3;if(E>>=2,$===L||$===3){A(g,S),S=1,k=!0;continue}else if($===0)if(_===0)_++,S<<=1;else{S<<=1,!(E&12)&&C!==14&&(S<<=1),A(g,S),S=4,!(E&12)&&C!==14&&(S<<=1),_=0,k=!0;continue}else _=0,k=!1,S<<=1,S+=1}k||A(g,S)};for(let g=0;g<this.node0.length;g++)p(1,2,this.node0[g]);for(let g=0;g<this.node1.length;g++)p(1,2,this.node1[g]);for(let g=0;g<this.node2.length;g++)p(1,2,this.node2[g]);for(let g=0;g<this.node3.length;g++)p(1,2,this.node3[g]);for(let g=0;g<this.node0.length;g++)p(2,1,this.node0[g]);for(let g=0;g<this.node1.length;g++)p(2,1,this.node1[g]);for(let g=0;g<this.node2.length;g++)p(2,1,this.node2[g]);for(let g=0;g<this.node3.length;g++)p(2,1,this.node3[g]);e&&(console.log({maxL1:a,maxD2:l,maxL2:r,maxD3:s,maxL3:d,maxD4:c,maxL4:i,maxL5:o}),console.log({minL1:N,minD2:P,minL2:w,minD3:y,minL3:b,minD4:f,minL4:h,minL5:u}));let x=0,M=0;if((this.seekDepth&1)===0){if(i||c)return Score.l5;if(h||f>2||b>2||b&f)return-Score.l5;d&&!h&&!f&&(x+=Score.l4)}else{if(h||f)return-Score.l5;if(i)return Score.l5;if(c>2||d>2||d&c)return-Score.l5;b&&!i&&!c&&(M+=Score.l4)}return x=Score.l5*o+Score.l4*i+Score.d4*c+Score.l3*d+Score.d3*s+Score.l2*r+Score.d2*l+Score.l1*l,M=Score.l5*u+Score.l4*h+Score.d4*f+Score.l3*b+Score.d3*y+Score.l2*w+Score.d2*P+Score.l1*P,x*this.attackFactor-M*this.defenseFactor}function genChilds(t,e,n){let o=[],i=[],c=[],d=[],s=[],r=[],l=[],a=[],u=[],h=[],f=[];for(let y=0;y<t.length;y++){const w=t[y],[P,N]=w;let A=0,p=0,x=getPointMode(this.maxPointsScore[P][N][0]);{const m=getPointMode(this.maxPointsScore[P][N][1]),v=getPointMode(this.maxPointsScore[P][N][2]),g=getPointMode(this.maxPointsScore[P][N][3]);x.l5+=m.l5+v.l5+g.l5,x.l4+=m.l4+v.l4+g.l4,x.d4+=m.d4+v.d4+g.d4,x.l3+=m.l3+v.l3+g.l3,x.d3+=m.d3+v.d3+g.d3,x.l2+=m.l2+v.l2+g.l2,x.d2+=m.d2+v.d2+g.d2,x.l1+=m.l1+v.l1+g.l1;const{l5:L,l4:E,d4:S,l3:_}=x;L?o.push(w):E?c.push(w):(_&&S&&u.push(w),_>1&&a.push(w),_&&l.push(w),S&&s.push(w)),A=calcEvaPointScore(x)}let M=getPointMode(this.minPointsScore[P][N][0]);{const m=getPointMode(this.minPointsScore[P][N][1]),v=getPointMode(this.minPointsScore[P][N][2]),g=getPointMode(this.minPointsScore[P][N][3]);M.l5+=m.l5+v.l5+g.l5,M.l4+=m.l4+v.l4+g.l4,M.d4+=m.d4+v.d4+g.d4,M.l3+=m.l3+v.l3+g.l3,M.d3+=m.d3+v.d3+g.d3,M.l2+=m.l2+v.l2+g.l2,M.d2+=m.d2+v.d2+g.d2,M.l1+=m.l1+v.l1+g.l1;const{l5:L,l4:E,d4:S,l3:_}=M;L?i.push(w):E?d.push(w):(_&&S&&h.push(w),S&&r.push(w)),p=calcEvaPointScore(M)}f.push({position:[P,N],score:A*this.attackFactor+p*this.defenseFactor})}let b;if(e){if(n)return o.length?o:i.length?[]:c.length?c:u.length||s.length?u.concat(s):d.length||r.length?[]:a.length?a:l.length?l:[];if(o.length)return o;if(i.length)return i;if(c.length)return c;if(d.length)return d;if(u.length)return u;if(h.length)return h}else{if(i.length)return i;if(o.length)return o;if(d.length)return d;if(c.length)return c;if(h.length)return h;if(u.length)return u}return b=f.sort((y,w)=>w.score-y.score).map(y=>y.position),b.length<=this.genLimit?b:b.slice(0,this.genLimit)}class Gobang{constructor(t){j(this,"genChilds",genChilds);this.init({...t})}init({firstHand:t,seekDepth:e,autoPlay:n,enableStats:o,attackFactor:i,defenseFactor:c}){this.totalChessPieces=15*15,this.initNode(),this.stack=[],this.zobrist=new Zobrist({size:15}),this.maxPointsScore=arrayN(15).map(d=>arrayN(15,[0,0,0,0])),this.minPointsScore=arrayN(15).map(d=>arrayN(15,[0,0,0,0])),this.stats={},this.enableStats=o!==void 0?o:!0,this.enableLog=!1,this.firstHand=t||2,this.genLimit=20,this.seekDepth=e||6,this.seekKillDepth=17,this.autoPlay=n,this.attackFactor=i||1,this.defenseFactor=c||2}isWall(t,e){return t<0||t>=15||e<0||e>=15}initNode(){this.node0=arrayN(15,0);const t=new ArrayBuffer(4*15);this.node1=new Int32Array(t);for(let e=0;e<=14;e++)this.node1[e]=0;this.node2=[];for(let e=0;e<15*2-1;e++){let n=0;for(let o=0;o<15;o++){const i=e-o;n<<=2,this.isWall(o,i)&&(n+=3)}this.node2[e]=n}this.node3=[];for(let e=0;e<15*2-1;e++){let n=0;for(let o=0;o<15;o++){const i=14+o-e;n<<=2,this.isWall(o,i)&&(n+=3)}this.node3[e]=n}}put(t,e,n){this.zobrist.go(t,e,n===1),this.stack.push([t,e]),this.node0[t]=this.node0[t]|n<<2*(14-e),this.node1[e]=this.node1[e]|n<<2*(14-t),this.node2[t+e]=this.node2[t+e]|n<<2*(14-t),this.node3[14+t-e]=this.node3[14+t-e]|n<<2*(14-t),this.updateFourLineScore(t,e)}rollback(t=1){if(!(this.stack.length<t))for(;t-- >0;){const[e,n]=this.stack.pop();this.zobrist.go(e,n,this.getChess(e,n)===1);const o=2*(14-n);this.node0[e]=(this.node0[e]|3<<o)^3<<o;const i=2*(14-e);this.node1[n]=(this.node1[n]|3<<i)^3<<i,this.node2[e+n]=(this.node2[e+n]|3<<i)^3<<i,this.node3[14+e-n]=(this.node3[14+e-n]|3<<i)^3<<i,this.updateFourLineScore(e,n)}}maxGo(){if(this.isFinal)return;this.zobrist.resetHash(),this.initStats();let t;this.stack.length>4&&(console.time("thinking kill"),t=this.minimax(this.seekKillDepth,!0),console.timeEnd("thinking kill")),(t==null?void 0:t.score)>=Score.win?console.warn("算杀成功 :)"):(console.time("thinking"),t=this.minimax(this.seekDepth),console.timeEnd("thinking")),console.log({score:t});const{i:e,j:n}=t;return this.put(e,n,1),this.logStats(),t}minGo(t,e){if(!this.isFinal)return this.isEmptyPosition(t,e)?(this.put(t,e,2),!0):!1}minRepent(){this.stack.length>=2&&this.rollback(2)}isEmptyPosition(t,e){return!this.isWall(t,e)&&this.getChess(t,e)===0}getNearPositions(t){const e=[],[o,i]=t;for(let c=-2;c<=2;c++)for(let d=-2;d<=2;d++)this.isEmptyPosition(c+o,d+i)&&e.push([c+o,d+i]);return e}getAllOptimalNextStep(){if(this.stack.length===0)return[[7,7]];if(this.stack.length===1){if(this.isEmptyPosition(7,7))return[[7,7]];const e=7+(Math.random()>.5?1:-1),n=7+(Math.random()>.5?1:-1);return[[e,n]]}let t=[];for(let e=0;e<15;e++)for(let n=0;n<15;n++)this.getChess(e,n)===0&&this.haveNeighbor(e,n)&&t.push([e,n]);return t}haveNeighbor(t,e){for(let o=-2;o<=2;o++)if(!(o+t<0||o+t>=15))for(let i=-2;i<=2;i++){if(i+e<0||i+e>=15||o===0&&i===0)continue;if(this.getChess(o+t,e+i)!==0)return!0}return!1}getChess(t,e){return this.node0[t]>>2*(14-e)&3}minimax(t,e,n=-1/0,o=1/0,i=!0){if(this.isFinal||t===0)return{score:evaluate.call(this,e),depth:t};const c=this.genChilds(this.getAllOptimalNextStep(),i,e);if(!(c!=null&&c.length))return{score:0};if(i){let d=-1/0,s=c[0];for(const a of c){const[u,h]=a;this.put(u,h,1),this.enableStats&&this.stats.abCut.eva++;let f=this.zobrist.get();if(f===void 0?(f=this.minimax(t-1,e,n,o,!i).score,this.zobrist.set(f),this.enableStats&&this.stats.zobrist.miss++):this.enableStats&&this.stats.zobrist.hit++,this.rollback(),f>d&&(d=f,s=a),n=Math.max(n,d),o<=n){this.enableStats&&this.stats.abCut.cut++;break}}const[r,l]=s;return{score:d,i:r,j:l}}else{let d=1/0,s=c[0];for(const a of c){const[u,h]=a;this.put(u,h,2),this.enableStats&&this.stats.abCut.eva++;let f=this.zobrist.get();if(f===void 0?(f=this.minimax(t-1,e,n,o,!i).score,this.zobrist.set(f),this.enableStats&&this.stats.zobrist.miss++):this.enableStats&&this.stats.zobrist.hit++,this.rollback(),f<d&&(d=f,s=a),o=Math.min(o,d),o<=n){this.enableStats&&this.stats.abCut.cut++;break}}const[r,l]=s;return{score:d,i:r,j:l}}}getChessInFourDirection(t,e,n){let o=[],i=[],c=[],d=[];if(n===void 0||n===0){const s=this.node0[t],r=e>=4?s>>2*(18-e)&3:3,l=e>=3?s>>2*(17-e)&3:3,a=e>=2?s>>2*(16-e)&3:3,u=e>=1?s>>2*(15-e)&3:3,h=s>>2*(14-e)&3,f=e<=13?s>>2*(13-e)&3:3,b=e<=12?s>>2*(12-e)&3:3,y=e<=11?s>>2*(11-e)&3:3,w=e<=10?s>>2*(10-e)&3:3;if(o=[r,l,a,u,h,f,b,y,w],n===0)return o}if(n===void 0||n===1){const s=this.node1[e],r=t>=4?s>>2*(18-t)&3:3,l=t>=3?s>>2*(17-t)&3:3,a=t>=2?s>>2*(16-t)&3:3,u=t>=1?s>>2*(15-t)&3:3,h=s>>2*(14-t)&3,f=t<=13?s>>2*(13-t)&3:3,b=t<=12?s>>2*(12-t)&3:3,y=t<=11?s>>2*(11-t)&3:3,w=t<=10?s>>2*(10-t)&3:3;if(i=[r,l,a,u,h,f,b,y,w],n===1)return i}if(n===void 0||n===2){const s=this.node2[t+e],r=t>=4?s>>2*(18-t)&3:3,l=t>=3?s>>2*(17-t)&3:3,a=t>=2?s>>2*(16-t)&3:3,u=t>=1?s>>2*(15-t)&3:3,h=s>>2*(14-t)&3,f=t<=13?s>>2*(13-t)&3:3,b=t<=12?s>>2*(12-t)&3:3,y=t<=11?s>>2*(11-t)&3:3,w=t<=10?s>>2*(10-t)&3:3;if(c=[r,l,a,u,h,f,b,y,w],n===2)return c}if(n===void 0||n===3){const s=this.node3[14+t-e],r=t>=4?s>>2*(18-t)&3:3,l=t>=3?s>>2*(17-t)&3:3,a=t>=2?s>>2*(16-t)&3:3,u=t>=1?s>>2*(15-t)&3:3,h=s>>2*(14-t)&3,f=t<=13?s>>2*(13-t)&3:3,b=t<=12?s>>2*(12-t)&3:3,y=t<=11?s>>2*(11-t)&3:3,w=t<=10?s>>2*(10-t)&3:3;if(d=[r,l,a,u,h,f,b,y,w],n===3)return d}return[o,i,c,d]}getPositionsInFourDirection(t,e){let n=[],o=[],i=[],c=[];const d=t-4>0?t-4:0,s=t+4<15-1?t+4:15-1,r=e-4>0?e-4:0,l=e+4<15-1?e+4:15-1;for(let a=r;a<=l;a++)n.push([t,a]);for(let a=d;a<=s;a++)o.push([a,e]);for(let a=4;a>0;a--)t-a>=d&&e+a<=l&&i.push([t-a,e+a]);i.push([t,e]);for(let a=1;a<=4;a++)t+a<=s&&e-a>=r&&i.push([t+a,e-a]);for(let a=4;a>0;a--)t-a>=d&&e-a>=r&&c.push([t-a,e-a]);c.push([t,e]);for(let a=1;a<=4;a++)t+a<=s&&e+a<=l&&c.push([t+a,e+a]);return[n,o,i,c]}updateFourLineScore(t,e){const n=this.getPositionsInFourDirection(t,e);for(let o=0;o<4;o++){const i=n[o];for(let c=0;c<i.length;c++){const d=i[c];this.updatePointScore(d,o)}}}updatePointScore(t,e){const[n,o]=t;this.getChess(n,o)!==0?(this.maxPointsScore[n][o]=[0,0,0,0],this.minPointsScore[n][o]=[0,0,0,0]):(this.maxPointsScore[n][o][e]=this.evaPoint(n,o,1,e),this.minPointsScore[n][o][e]=this.evaPoint(n,o,2,e))}evaPoint(t,e,n,o){const i=this.getChessInFourDirection(t,e,o),s=countLine(n===1?1:2,n===1?2:1,3);let r=0;const l=s(i),a=serialPointMode[l];return r+=a||0,r}saveStack(){console.log(JSON.stringify(this.stack))}restoreStack(t){let e=this.firstHand,n=e===1?2:1;for(var o=0;o<t.length;o++){const[i,c]=t[o];this.put(i,c,o&1?n:e)}}test(data){console.log(eval(data))}get winner(){if(this.stack.length<7)return null;const[t,e]=this.stack[this.stack.length-1],n=this.getChess(t,e),o=this.getChessInFourDirection(t,e);for(let i=0;i<4;i++){let c=0;const d=o[i];for(let s=0;s<d.length;s++)if(d[s]===n?c++:c=0,c===5)return n}return null}get winnerPositions(){if(!this.winner)return null;const[t,e]=this.stack[this.stack.length-1],n=this.getChess(t,e),o=this.getPositionsInFourDirection(t,e);for(let i=0;i<4;i++){const c=o[i];let d=0,s=[];for(let r=0;r<c.length;r++){const[l,a]=c[r];if(this.getChess(l,a)===n?(d++,s.push([l,a])):(d=0,s=[]),d===5)return s}}return null}get isFinal(){return!!this.winner||this.isBoardFull}get isBoardFull(){return this.stack.length===this.totalChessPieces}get lastChessPosition(){return this.stack.length?this.stack[this.stack.length-1]:null}get isDraw(){return this.isBoardFull&&!this.winner}get node(){return this.node0.map(t=>{let e=[];for(let n=0;n<15;n++)e.push((t&3<<2*n)>>2*n);return e.reverse()})}printNode(){console.log(this.node0.map(t=>t.toString(2))),console.log(this.node1.map(t=>t.toString(2))),console.log(this.node2.map(t=>t.toString(2))),console.log(this.node3.map(t=>t.toString(2)))}initStats(){this.stats={abCut:{all:this.genLimit**this.seekDepth,eva:0,cut:0,toString(){const{all:t,eva:e,cut:n}=this.stats.abCut,o=t-e;return`AB剪枝 最大节点总数:${t} 理论最少评估${t**.5>>0} 实际评估:${e} 剪去:${n}/${o}`}},zobrist:{miss:0,hit:0,toString(){const{hit:t,miss:e}=this.stats.zobrist;return`zobrist 评估节点数:${this.stats.abCut.eva} hit:${t} miss:${e}`}}}}logStats(){this.enableStats&&Object.keys(this.stats).forEach(t=>{console.log(this.stats[t].toString.call(this))})}}j(Gobang,"MAX",1),j(Gobang,"MIN",2),j(Gobang,"EMPTY",0),j(Gobang,"WALL",3);const gobang=new Gobang;onmessage=async function(t){const{type:e,data:n}=t.data;let o;switch(e){case"init":gobang.init(n),gobang.autoPlay&&autoPlayWithSelf();break;case"maxGo":o=gobang.maxGo();break;case"minGo":o=gobang.minGo(...n);break;case"minRepent":o=gobang.minRepent();break;case"test":o=gobang.test(n),console.log({res:o});break}senMessage(e,o)};const senMessage=(t,e)=>postMessage({type:t,data:e,gobang:JSON.stringify({...gobang,node:gobang.node,stack:gobang.stack,firstHand:gobang.firstHand,lastChessPosition:gobang.lastChessPosition,winnerPositions:gobang.winnerPositions,isDraw:gobang.isDraw,winner:gobang.winner,isFinal:gobang.isFinal})}),autoPlayWithSelf=async()=>{const t=new Gobang({firstHand:Gobang.MIN,seekDepth:2,defenseFactor:4});gobang.genLimit=40,gobang.seekDepth=4,t.genLimit=40,t.seekDepth=4;const e=async()=>{const{i:o,j:i}=gobang.maxGo();t.minGo(o,i),senMessage("autoPlay")},n=async()=>{const{i:o,j:i}=t.maxGo();gobang.minGo(o,i),senMessage("autoPlay")};for(;gobang.autoPlay;)await e(),await wait(500),await n(),await wait(500)}})();
